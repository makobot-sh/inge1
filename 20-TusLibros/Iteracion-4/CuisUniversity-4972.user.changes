

----QUIT----(13 November 2021 20:18:32) CuisUniversity-4972.image priorSource: 14896235!

----STARTUP---- (13 November 2021 20:18:33) as /Users/hernan/Documents/Cuis/5.0-64Bits/Cuis-University-Installer/CuisUniversity-4972.image!


----QUIT----(13 November 2021 20:18:33) CuisUniversity-4972.image priorSource: 18974023!

----STARTUP---- (15 November 2021 19:27:09) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 19:27:43'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 19:27:43'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 19:27:44'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 19:27:44'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Morphic\Morphic-Misc1\Morphic-Misc1.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Morphic\Morphic-Widgets-Extras.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Features\Compression.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Features\Sound.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\Packages\System\Network-Kernel.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\it4\WebClient.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\it4\WordsClientDemo.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\it4\StringsServicesServer.st----!

----SNAPSHOT----(15 November 2021 19:46:20) CuisUniversity-4972.image priorSource: 18974255!

----STARTUP---- (15 November 2021 19:46:36) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


StringsServicesRestInterface listeningOn: 8080.!

|server|!

server := StringsServicesRestInterface listeningOn: 8080.!

server startListening.!

server startListening.!

server stopListening.!

server stopListening. !

server destroy.!

server destroy. !

server destroy. !

----SNAPSHOT----(15 November 2021 19:57:03) CuisUniversity-4972.image priorSource: 20470678!

server destroy. !

----SNAPSHOT----(15 November 2021 19:57:14) CuisUniversity-4972.image priorSource: 20471153!

----STARTUP---- (15 November 2021 19:57:37) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


|server|!

server := StringsServicesRestInterface listeningOn: 8080.!

server startListening.!

server startListening.!

server stopListening.!

server stopListening.!

server destroy.!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\it4\TusLibros-80.st----!

----SNAPSHOT----(15 November 2021 20:17:18) CuisUniversity-4972.image priorSource: 20471266!

server := WordsClientWindow open.!

server := WordsClientWindow allInstances .!

server := WordsClientWindow allInstances .!

|server window|!

server := StringsServicesRestInterface listeningOn: 8080.!

server startListening.!

window := WordsClientWindow open.!

window destroy!

server destroy !

Object subclass: #TusLibrosServer
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 20:39:44'!
Object subclass: #TusLibrosServer
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #TusLibrosServerTest category: 'TusLibros-Tests' stamp: 'MP 11/15/2021 20:40:30'!
TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!TusLibrosServerTest methodsFor: 'no messages' stamp: 'MP 11/15/2021 20:48:07'!
test01

	|server|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	WebRequest new initializeFromUrl: 'http://localhost:8080/'! !

----SNAPSHOT----(15 November 2021 20:50:55) CuisUniversity-4972.image priorSource: 20524931!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 20:50:57' prior: 50973092!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebRequest new initializeFromUrl: 'http://localhost:8080/'.
	req ! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:00:13' prior: 50973103!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebRequest new initializeFromUrl: 'http://localhost:8080/ping'.
	req ! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:02:24' prior: 50973112!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebClient httpGet: 'http://localhost:8080/ping'.
	req send! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:02:55' prior: 50973121!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebClient httpGet: 'http://localhost:8080/ping'.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:03:49' prior: 50973130!
test01

	|server req client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	req _ client httpGet: 'http://localhost:8080/ping'.
	
	client close.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:10:31' prior: 50973139!
test01

	|server req client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	req _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: req = 0.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:10:43' prior: 50973149!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = 0.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:09' prior: 50973161!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = '0|000'.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:14' prior: 50973173!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = '0|0000'.! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:11:16'!
ERROR!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:58'!
listeningOn: aSmallInteger 
	self shouldBeImplemented.! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:12:12'!
ERROR!
!TusLibrosServer class methodsFor: 'error handling' stamp: 'MP 11/15/2021 21:12:19' overrides: 16881409!
error: aString 
	self shouldBeImplemented.! !

!methodRemoval: TusLibrosServer class #error: stamp: 'MP 11/15/2021 21:12:40'!
error: aString 
	self shouldBeImplemented.!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:12:47' prior: 50973199!
listeningOn: aPort
	! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:13:08' prior: 50973216!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber.! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:17:53'!
ERROR!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:17:53'!
ERROR!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:18:04'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:18:04'!
initializeWith: aPortNumber 
	self shouldBeImplemented.
	portNumber := aPortNumber.! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:22:46'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:22:49'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:22:41' prior: 50973239!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:22:58'!
ERROR!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:22:59'!
ERROR!

Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:23:43'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:23:48'!
ERROR!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:23:48'!
ERROR!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:03' prior: 50973261!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:24:04'!
ERROR!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:24:04'!
ERROR!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:40'!
startListening
	
	webServer startListener.

	^'Listening on port: ', port asString.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:59'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', port asString! !

!methodRemoval: TusLibrosServer #startListening stamp: 'MP 11/15/2021 21:25:07'!
startListening
	
	webServer startListener.

	^'Listening on port: ', port asString.
	!

!methodRemoval: TusLibrosServer #stopListening stamp: 'MP 11/15/2021 21:25:09'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', port asString!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:25:18' prior: 50973296!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:25:34'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:26:28' prior: 50973185!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: resp = '0|0000'.
	! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:26:30'!
ERROR!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:26:38' prior: 50973354!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: resp = '0|0000'.
	! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:26:39'!
FAILURE!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:27:11' prior: 50973369!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:27:21' prior: 50973336!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('o|0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:27:23' prior: 50973396!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0|0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:27:24'!
FAILURE!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:27:24'!
FAILURE!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:27:43' prior: 50973384!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !

----STARTUP---- (15 November 2021 21:30:08) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 20:50:57' prior: 50973092!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebRequest new initializeFromUrl: 'http://localhost:8080/'.
	req ! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:00:13' prior: 50973445!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebRequest new initializeFromUrl: 'http://localhost:8080/ping'.
	req ! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:02:24' prior: 50973454!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebClient httpGet: 'http://localhost:8080/ping'.
	req send! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:02:55' prior: 50973463!
test01

	|server req|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	req _ WebClient httpGet: 'http://localhost:8080/ping'.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:03:49' prior: 50973472!
test01

	|server req client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	req _ client httpGet: 'http://localhost:8080/ping'.
	
	client close.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:10:31' prior: 50973481!
test01

	|server req client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	req _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: req = 0.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:10:43' prior: 50973491!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = 0.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:09' prior: 50973503!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = '0|000'.! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:14' prior: 50973515!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	self assert: resp = '0|0000'.! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:11:58'!
listeningOn: aSmallInteger 
	self shouldBeImplemented.! !
!TusLibrosServer class methodsFor: 'error handling' stamp: 'MP 11/15/2021 21:12:19' overrides: 16881409!
error: aString 
	self shouldBeImplemented.! !

!methodRemoval: TusLibrosServer class #error: stamp: 'MP 11/15/2021 21:30:19'!
error: aString 
	self shouldBeImplemented.!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:12:47' prior: 50973539!
listeningOn: aPort
	! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:13:08' prior: 50973554!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber.! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:30:19'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:18:04'!
initializeWith: aPortNumber 
	self shouldBeImplemented.
	portNumber := aPortNumber.! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:30:19'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:30:19'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'portNumber port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:22:41' prior: 50973572!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:30:20'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/15/2021 21:30:20'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:03' prior: 50973594!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:40'!
startListening
	
	webServer startListener.

	^'Listening on port: ', port asString.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:24:59'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', port asString! !

!methodRemoval: TusLibrosServer #startListening stamp: 'MP 11/15/2021 21:30:20'!
startListening
	
	webServer startListener.

	^'Listening on port: ', port asString.
	!

!methodRemoval: TusLibrosServer #stopListening stamp: 'MP 11/15/2021 21:30:20'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', port asString!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:25:18' prior: 50973622!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:25:34'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:26:28' prior: 50973527!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	server startListening.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: resp = '0|0000'.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:26:38' prior: 50973675!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: resp = '0|0000'.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:27:11' prior: 50973688!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:27:21' prior: 50973657!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('o|0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:27:23' prior: 50973712!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[.
		request send200Response: ('0|0000')
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:27:43' prior: 50973700!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !

----SNAPSHOT----(15 November 2021 21:30:47) CuisUniversity-4972.image priorSource: 20526361!

----STARTUP---- (15 November 2021 21:31:44) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


|server client resp|!

server _ StringsServicesRestInterface listeningOn: 8080.!

server startListening.!

client _ WebClient new.!

resp _ client httpGet: 'http://localhost:8080/quote'.!

client close.!

server destroy.!

resp.!

resp.!

resp content.!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:36:13' prior: 50973726!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[
		request send200Response: ('0|0000').
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:37:34' prior: 50973766!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:37:50' prior: 50973780!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: anError messageText ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:38:22' prior: 50973794!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: anError messageText ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:38:24'!
PASSED!

----SNAPSHOT----(15 November 2021 21:38:31) CuisUniversity-4972.image priorSource: 20547221!

----STARTUP---- (15 November 2021 21:39:06) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:39:28' prior: 50973559!
listeningOn: aPortNumber

	^self basic new initializeWith: aPortNumber.! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:39:35' prior: 50973831!
listeningOn: aPortNumber

	^self basicNew initializeWith: aPortNumber.! !

----SNAPSHOT----(15 November 2021 21:39:37) CuisUniversity-4972.image priorSource: 20549521!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:39:40'!
PASSED!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:40:12' prior: 50973740!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0001' equals: resp content.
	! !

----SNAPSHOT----(15 November 2021 21:40:36) CuisUniversity-4972.image priorSource: 20550121!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:40:38'!
FAILURE!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/15/2021 21:40:39'!
FAILURE!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/15/2021 21:40:46' prior: 50973849!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !

----SNAPSHOT----(15 November 2021 21:40:49) CuisUniversity-4972.image priorSource: 20550709!

----STARTUP---- (15 November 2021 21:41:24) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:43:17' prior: 50973808!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',anError messageText ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:43:23' prior: 50973887!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

----SNAPSHOT----(15 November 2021 21:48:59) CuisUniversity-4972.image priorSource: 20551349!

----STARTUP---- (17 November 2021 15:28:31) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:29:20' prior: 50973869!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	self halt.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !

----STARTUP---- (17 November 2021 15:30:08) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:30:24' prior: 50973869!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self halt.
	self assert: '0|0000' equals: resp content.
	! !

self content!

----STARTUP---- (17 November 2021 15:31:07) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


	self halt.!

	self halt.!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:31:21' prior: 50973869!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	self halt.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !

self content.!

self content.!

self content.!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:32:22' prior: 50973954!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw'.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp content.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:33:24' prior: 50973968!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/17/2021 15:33:38'!
PASSED!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/17/2021 15:33:38'!
PASSED!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/17/2021 15:33:42'!
PASSED!

!testRun: #TusLibrosServerTest #test01 stamp: 'MP 11/17/2021 15:33:42'!
PASSED!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:35:40'!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !

!methodRemoval: TusLibrosServerTest #test01 stamp: 'MP 11/17/2021 15:35:40'!
test01

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=cliente&password=psw') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:40:22'!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:40:46' prior: 50974002!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=password') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:44:14' prior: 50974026!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	
	
	server _ TusLibrosServer listeningOn: 8080 toInterface: self mockInterface.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:44:21' prior: 50974054!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	self setup.
	
	server _ TusLibrosServer listeningOn: 8080 toInterface: self mockInterface.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:46:09' prior: 50974069!
test02CreateCartForInvalidCredentials

	|server resp client interface|
	
	server _ TusLibrosServer listeningOn: 8080 toInterface: self mockInterface.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:46:16' prior: 50974084!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 toInterface: self mockInterface.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !

!classDefinition: #TusLibrosServerTest category: 'TusLibros-Tests' stamp: 'MP 11/17/2021 15:46:53'!
TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory clock'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #TusLibrosServerTest category: 'TusLibros-Tests' stamp: 'MP 11/17/2021 15:46:55'!
TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:46:51' overrides: 16927572!
setUp
	
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:47:47'!
validUser

	^'validUser'! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:47:55'!
avalidUserPassword

	^'validUserPassword'! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:48:07'!
avalidUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:48:17'!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself! !

!methodRemoval: TusLibrosServerTest #avalidUsersAndPasswords stamp: 'MP 11/17/2021 15:48:17'!
avalidUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself!
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:48:21'!
validUserPassword

	^'validUserPassword'! !

!methodRemoval: TusLibrosServerTest #avalidUserPassword stamp: 'MP 11/17/2021 15:48:21'!
avalidUserPassword

	^'validUserPassword'!
!TusLibrosServerTest methodsFor: 'setup' stamp: 'MP 11/17/2021 15:48:58'!
createSalesBook

	^OrderedCollection new! !
!TusLibrosServerTest methodsFor: 'setup' stamp: 'MP 11/17/2021 15:49:07'!
merchantProcessor

	^self! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 15:49:51' prior: 50974099!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:50:48'!
initializeWith: aPortNumber communicateWith: aSystemFacade  
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:50:48' prior: 50973837!
listeningOn: aPortNumber

	^self basicNew initializeWith: aPortNumber communicateWith: systemFacade.! !

!methodRemoval: TusLibrosServer #initializeWith: stamp: 'MP 11/17/2021 15:50:48'!
initializeWith: aPortNumber 
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:51:34'!
initializeWith: aPortNumber   
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:51:34' prior: 50974218!
listeningOn: aPortNumber

	^self basicNew initializeWith: aPortNumber .! !

!methodRemoval: TusLibrosServer #initializeWith:communicateWith: stamp: 'MP 11/17/2021 15:51:34'!
initializeWith: aPortNumber communicateWith: aSystemFacade  
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:52:04'!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber .! !

!methodRemoval: TusLibrosServer class #listeningOn: stamp: 'MP 11/17/2021 15:52:04'!
listeningOn: aPortNumber

	^self basicNew initializeWith: aPortNumber .!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 15:52:33' prior: 50974040!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade .
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=password') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 15:52:34' prior: 50974283!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=password') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:53:32'!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:53:33' prior: 50974271!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber and: systemFacade .! !

!methodRemoval: TusLibrosServer #initializeWith: stamp: 'MP 11/17/2021 15:53:33'!
initializeWith: aPortNumber   
	
	port := aPortNumber.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:53:46' prior: 50974326!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber and: aSystemFacade .! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'MP 11/17/2021 15:54:07'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:54:06' prior: 50974311!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
		request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:56:53' prior: 50974363!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
			systemFacade does: user authenticatesWith: password.
			request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:56:59' prior: 50974378!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			systemFacade does: user authenticatesWith: psw.
			request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 15:57:06'!
PASSED!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 15:57:07'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 15:57:07'!
PASSED!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 15:57:16' prior: 50974189!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=invalidPassword') content.
	
	client close.
	server destroy.
	self assert: '1|INVALID_PASSWORD' equals: resp.
	! !

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 15:57:17'!
FAILURE!
!TusLibrosServer class methodsFor: 'error handling' stamp: 'MP 11/17/2021 15:58:49'!
invalidUserOrPasswordErrorDescription
	^ 'INVALID_USERNAME_OR_PASSWORD'! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 15:59:36' prior: 50974399!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			systemFacade does: user authenticatesWith: psw.
			request send200Response: '0|0000'.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:03:05' prior: 50974453!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw. 
			request send200Response: '0|',cartId.
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:03:07'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:03:07'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:03:16'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:03:55' prior: 50974473!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw. 
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:03:56'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:03:56'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:04:02'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:11:48' prior: 50974505!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			self halt. 
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

			self halt. !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:12:14'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:12:22' prior: 50974537!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:12:24'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:14:09' prior: 50974563!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			self halt.
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:14:14'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:14:23'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:17:01' prior: 50974588!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			self halt.
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:17:05'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:17:05'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:17:08'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:17:34' prior: 50974617!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:19:28' prior: 50974655!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription) ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:21:09' prior: 50974682!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
			request send400Response: '1|',(anError messageText) ]].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:22:06' prior: 50974709!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )] ifFalse: [
			request send400Response: '1|',(anError messageText) ]
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:22:08'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:22:08'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:22:10'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:22:29' prior: 50974737!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = TusLibrosSystemFacade invalidUserOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:22:31'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:22:31'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:22:33'!
FAILURE!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:i | i destroy].!

TusLibrosServer allInstances .!

TusLibrosServer allInstances .!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:i | i delete ].!

TusLibrosServer allInstances.!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:26:40'!
FAILURE!

TusLibrosServer allInstances.!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 16:27:14' prior: 50974297!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=password') content.
	
	client close.
	server destroy.
	server delete.
	self assert: '0|0000' equals: resp.
	! !

TusLibrosServer allInstances do: [:i | i delete ].!

TusLibrosServer allInstances do: [:i | i delete ].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:i | i delete ].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:i | i delete].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances.!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:30:34' prior: 50974776!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:31:09' prior: 50974874!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )] 
				ifFalse: [request send400Response: '1|',anError].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:31:10'!
ERROR!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/17/2021 16:31:11'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:31:13'!
ERROR!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/17/2021 16:31:21' prior: 50974836!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=client&password=password') content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!

TusLibrosServer allInstances do: [:i | i delete].!

TusLibrosServer allInstances.!

WebServer allInstances.!

WebServer allInstances do: [:i | i destroy].!

WebServer allInstances.!

WebServer allInstances do: [:i | i delete].!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:33:08'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:34:04' prior: 50974899!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription )] .
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:34:08'!
FAILURE!

----SNAPSHOT----(17 November 2021 16:34:12) CuisUniversity-4972.image priorSource: 20552423!

TusLibrosServer allInstances do: [:i | i delete].!

WebServer allInstances.!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:34:28'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:35:23' prior: 50974965!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] .
		]
	].
	
	webServer startListener.
! !

WebServer allInstances.!

WebServer allInstances do: [:i | i destroy].!

WebServer allInstances.!

WebServer allInstances.!

WebServer allInstances.!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:36:52' prior: 50975003!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifFalse: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] .
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/17/2021 16:37:13' prior: 50975033!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifFalse: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] .
			request send200Response: '0|0000' asString .
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:37:15'!
FAILURE!

----SNAPSHOT----(17 November 2021 16:37:42) CuisUniversity-4972.image priorSource: 20586959!

----STARTUP---- (17 November 2021 16:37:56) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/17/2021 16:38:18'!
FAILURE!

WebServer allInstances.!

WebServer allInstances.!

TusLibrosServer allInstances.!

WebServer allInstances do: [:i | i stopListening ].!

----SNAPSHOT----(17 November 2021 16:45:13) CuisUniversity-4972.image priorSource: 20589983!

----STARTUP---- (18 November 2021 17:40:49) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


TusLibrosServer allInstances.!

WebServer allInstances. !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:43:52' prior: 50974936!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ) content.
	
	client close.
	server destroy.
	self assert: '0|0000' equals: resp.
	! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:44:39' prior: 50974429!
test02CreateCartForInvalidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword,'BAD') content.
	
	client close.
	server destroy.
	self assert: '1|INVALID_PASSWORD' equals: resp.
	! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:46:34'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:47:27'!
FAILURE!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:47:35' prior: 50975110!
test01CreateCartForValidCredentials

	|server resp client|
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ) content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: resp.
	! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:47:36'!
PASSED!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:47:36'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:47:36'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:47:36'!
FAILURE!

self content!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:49:47' prior: 50975147!
test01CreateCartForValidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respText.
	! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:49:53'!
PASSED!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 17:49:53'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:49:53'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:49:53'!
FAILURE!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:50:45' prior: 50975125!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword,'BAD').
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|INVALID_PASSWORD' equals: respText.
	! !

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:50:48'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 17:53:14' prior: 50975058!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifFalse: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] .
			request send400Response: 'Error' asString .
		]
	].
	
	webServer startListener.
! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/18/2021 17:53:50'!
invalidPassword

	^'invalidPassword'! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:54:04' prior: 50975206!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|INVALID_PASSWORD' equals: respText.
	! !

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 17:54:05'!
FAILURE!

TusLibrosServer allInstances.!

TusLibrosServer allInstances.!

TusLibrosServer allInstances.!

TusLibrosServer allInstances.!

----SNAPSHOT----(18 November 2021 17:56:11) CuisUniversity-4972.image priorSource: 20590431!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 17:59:39' prior: 50975226!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifFalse: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] .
			request send400Response: 'Error'.
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:01:44' prior: 50975285!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:01:56'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:01:57'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:01:57'!
FAILURE!

----SNAPSHOT----(18 November 2021 18:02:17) CuisUniversity-4972.image priorSource: 20596175!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:02:24' prior: 50975312!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			self halt.
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:03:11'!
ERROR!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:03:56'!
FAILURE!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:04:37'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:05:22'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:06:42'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:07:25'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:07:44' prior: 50975353!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			self halt.
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade signalInvalidUserAndOrPassword) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !

----SNAPSHOT----(18 November 2021 18:08:14) CuisUniversity-4972.image priorSource: 20598367!

----STARTUP---- (18 November 2021 18:09:37) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:10:17'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:10:41'!
FAILURE!

TusLibrosServer allInstances.!

----STARTUP---- (18 November 2021 18:11:27) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:12:15'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:12:30'!
FAILURE!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:13:03'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:13:48'!
ERROR!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:14:16'!
FAILURE!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:15:01' prior: 50975402!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			self halt.
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !

TusLibrosServer allInstances do: [:instance | instance destroy].!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:15:13'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:15:15'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:15:17'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:15:17'!
PASSED!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:15:27' prior: 50975469!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:16:59'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:17:30'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:17:44'!
FAILURE!

self content!

TusLibrosServer allInstances do: [:instance | instance destroy].!

TusLibrosServer allInstances.!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:20:44' prior: 50975514!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText capitalized 	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:15' prior: 50975557!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText capitalized 	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:20' prior: 50975586!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:27' prior: 50975615!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

----STARTUP---- (18 November 2021 18:28:57) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!

!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:15:01' prior: 50975402!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			self halt.
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:15:27' prior: 50975674!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: 'Unknown error: ', anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:20:44' prior: 50975703!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send400Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText capitalized 	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:15' prior: 50975732!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText capitalized 	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:20' prior: 50975761!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send400Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:28:27' prior: 50975790!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			self halt.
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:29:30' prior: 50975818!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

TusLibrosServer allInstances do: [:instance | instance destroy].!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:29:39'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:29:39'!
FAILURE!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:29:39'!
FAILURE!
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 18:30:20' prior: 50975258!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|',TusLibrosServer invalidUserOrPasswordErrorDescription = respText.
	! !

TusLibrosServer allInstances do: [:instance | instance destroy].!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'MP 11/18/2021 18:30:35'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/18/2021 18:30:35'!
PASSED!

----SNAPSHOT----(18 November 2021 18:30:38) CuisUniversity-4972.image priorSource: 20600939!

----SNAPSHOT----(18 November 2021 18:50:55) CuisUniversity-4972.image priorSource: 20616351!

----SNAPSHOT----(18 November 2021 21:42:02) CuisUniversity-4972.image priorSource: 20616445!

----STARTUP---- (19 November 2021 11:36:09) as C:\Users\ferra\Desktop\windows64\windows64\CuisUniversity-4972.image!


----End fileIn of \Users\ferra\Desktop\TusLibros-Model.st----!

----End fileIn of \Users\ferra\Desktop\TusLibros-Tests.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/19/2021 11:37:17'!
PASSED!

!testRun: #TusLibrosServerTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosServerTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/19/2021 11:37:18'!
PASSED!

!classRenamed: #TusLibrosServer as: #TusLibrosRestInterface stamp: 'AF 11/19/2021 11:45:30'!
Smalltalk renameClassNamed: #TusLibrosServer as: #TusLibrosRestInterface!
!TusLibrosRestInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:45:30' prior: 50972561!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:45:30' prior: 50973169!
test01CreateCartForValidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respText.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:45:30' prior: 50973184!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|',TusLibrosRestInterface invalidUserOrPasswordErrorDescription = respText.
	! !

!classRenamed: #TusLibrosServerTest as: #TusLibrosRestInterfaceTest stamp: 'AF 11/19/2021 11:47:43'!
Smalltalk renameClassNamed: #TusLibrosServerTest as: #TusLibrosRestInterfaceTest!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 11:47:55'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 11:47:55'!
PASSED!
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:52:17' prior: 50972597!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber.! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:52:26'!
listeningOn: aPortNumber  

	^self basicNew initializeWith: aPortNumber.! !

!methodRemoval: TusLibrosRestInterface class #listeningOn:communicateWith: stamp: 'AF 11/19/2021 11:52:26'!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber.!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 11:55:22' prior: 50973921!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: Dictionary new
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: Clock new.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 11:55:30'!
initializeWith: aPortNumber     
	
	port := aPortNumber.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: Dictionary new
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: Clock new.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

!methodRemoval: TusLibrosRestInterface #initializeWith:and: stamp: 'AF 11/19/2021 11:55:30'!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: Dictionary new
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: Clock new.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 11:56:41' prior: 50974051!
initializeWith: aPortNumber     
	
	port := aPortNumber.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: Dictionary new
		registeringOn: OrderedCollection  new
		debitingThrought: self merchantProcessor
		measuringTimeWith: Clock new.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 12:00:34' prior: 50974119!
initializeWith: aPortNumber     
	
	port := aPortNumber.
	"systemFacade := aSystemFacade."
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 12:01:17'!
initializeWith: aPortNumber and: aSystemFacade      
	
	port := aPortNumber.
	"systemFacade := aSystemFacade."
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 12:01:17' prior: 50974004!
listeningOn: aPortNumber  

	^self basicNew initializeWith: aPortNumber and: systemFacade.! !

!methodRemoval: TusLibrosRestInterface #initializeWith: stamp: 'AF 11/19/2021 12:01:17'!
initializeWith: aPortNumber     
	
	port := aPortNumber.
	"systemFacade := aSystemFacade."
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
!
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 12:02:18'!
listeningOn: aPortNumber with: aSystemFacade   

	^self basicNew initializeWith: aPortNumber and: systemFacade.! !

!methodRemoval: TusLibrosRestInterface class #listeningOn: stamp: 'AF 11/19/2021 12:02:18'!
listeningOn: aPortNumber  

	^self basicNew initializeWith: aPortNumber and: systemFacade.!
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 12:02:26' prior: 50974242!
listeningOn: aPortNumber with: aSystemFacade   

	^self basicNew initializeWith: aPortNumber and: aSystemFacade.! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 12:02:54' prior: 50974180!
initializeWith: aPortNumber and: aSystemFacade      
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterfaceTest methodsFor: 'setup' stamp: 'AF 11/19/2021 12:11:03' prior: 50973155 overrides: 16927572!
setUp
	
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := Clock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosRestInterface class methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 12:11:59'!
listeningOn: aPortNumber communicateWith: aSystemFacade   

	^self basicNew initializeWith: aPortNumber and: aSystemFacade.! !

!methodRemoval: TusLibrosRestInterface class #listeningOn:with: stamp: 'AF 11/19/2021 12:11:59'!
listeningOn: aPortNumber with: aSystemFacade   

	^self basicNew initializeWith: aPortNumber and: aSystemFacade.!
!TusLibrosRestInterfaceTest methodsFor: 'setup' stamp: 'AF 11/19/2021 12:12:17' prior: 50974291 overrides: 16927572!
setUp
	
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 12:12:18'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 12:12:18'!
PASSED!
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:14:28'!
test02

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|2' equals: respText.
	! !
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:15:47'!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|2' equals: respText.
	! !

!methodRemoval: TusLibrosRestInterfaceTest #test02 stamp: 'AF 11/19/2021 12:15:47'!
test02

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|2' equals: respText.
	!

!testRun: #TusLibrosRestInterfaceTest #test03 stamp: 'AF 11/19/2021 12:16:18'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 12:16:18'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 12:16:18'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test03 stamp: 'AF 11/19/2021 12:16:18'!
PASSED!
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:18:52' prior: 50974361!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	
	client close.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	
	
	server destroy.
	self assert: '0|2' equals: respText.
	! !

!testRun: #TusLibrosRestInterfaceTest #test03 stamp: 'AF 11/19/2021 12:18:56'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 12:18:56'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 12:18:56'!
PASSED!

!testRun: #TusLibrosRestInterfaceTest #test03 stamp: 'AF 11/19/2021 12:18:56'!
PASSED!
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:22:25' prior: 50974411!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	
	server destroy.
	self assert: '0|2' equals: respText.
	! !
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:26:23' prior: 50974444!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	
	resp _ client httpGet: 'http://localhost:8080/addToCart?cartId=',1,'&bookIsbn='.
	respText _ resp content.
	
	client close.
	
	server destroy.
	self assert: '0|2' equals: respText.
	! !
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:43:43' prior: 50974459!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	
	resp _ client httpGet: 'http://localhost:8080/addToCart?cartId=',1,'&bookIsbn=',testObjectsFactory itemSellByTheStore,'&bookQuantity=1' .
	respText _ resp content.
	
	client close.
	
	server destroy.
	self assert: '0|2' equals: respText.
	! !
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 12:44:13' prior: 50974477!
test03

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword.
	
	resp _ client httpGet: 'http://localhost:8080/addToCart?cartId=',1,'&bookIsbn=',testObjectsFactory itemSellByTheStore,'&bookQuantity=1' .
	respText _ resp content.
	
	client close.
	
	server destroy.
	self assert: '0|OK' equals: respText.
	! !

!testRun: #TusLibrosRestInterfaceTest #test03 stamp: 'AF 11/19/2021 12:44:14'!
ERROR!
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 12:56:39' prior: 50974262!
initializeWith: aPortNumber and: aSystemFacade      
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response|
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response).
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 12:59:13' prior: 50974518!
initializeWith: aPortNumber and: aSystemFacade      
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response|
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response).
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: ((Dictionary new) add: 'status' -> 1; 
														    add: 'errorDescription' -> (TusLibrosRestInterface invalidUserOrPasswordErrorDescription);
														    yourself)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 13:25:23' prior: 50973949!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp content).
	
	client close.
	server destroy.
	respExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId').! !

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:25:37'!
ERROR!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:25:37'!
ERROR!
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 13:31:36' prior: 50974584!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp contentStream).
	
	client close.
	server destroy.
	respExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId').! !

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:31:39'!
ERROR!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:31:39'!
ERROR!
!TusLibrosRestInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 13:47:18' prior: 50974615!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp content) readStream.
	
	client close.
	server destroy.
	respExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId').! !

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:48:02'!
ERROR!

!testRun: #TusLibrosRestInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:48:02'!
ERROR!

WebServer allInstances !

WebServer allInstancesDo: [:i | i destroy]!


WebServer allInstancesDo: [:i | i connections]!

WebServer allInstancesDo: [:i | i connections] !

WebServer allInstancesDo: [:i | i connections]!

WebServer allInstancesDo: [:i | i connections]!

WebServer allInstancesDo: [:i | i connections]!

----STARTUP---- (19 November 2021 13:52:32) as C:\Users\ferra\Desktop\windows64\windows64\CuisUniversity-4972.image!


!classDefinition: #Cart category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:34'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #Cart category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:34'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!Cart methodsFor: 'error messages' stamp: 'HernanWilkinson 6/21/2013 23:59'!
invalidItemErrorMessage

	^self class invalidItemErrorMessage ! !
!Cart methodsFor: 'error messages' stamp: 'HernanWilkinson 6/22/2013 00:00'!
invalidQuantityErrorMessage

	^self class invalidQuantityErrorMessage ! !
!Cart methodsFor: 'assertions' stamp: 'HernanWilkinson 6/22/2013 14:17'!
assertIsValidItem: anItem

	(catalog includesKey: anItem) ifFalse: [ self signalInvalidItem ]! !
!Cart methodsFor: 'assertions' stamp: 'HernanWilkinson 6/22/2013 14:18'!
assertIsValidQuantity: aQuantity

	aQuantity strictlyPositive ifFalse: [self signalInvalidQuantity ]! !
!Cart methodsFor: 'content' stamp: 'HernanWilkinson 6/22/2013 12:17'!
catalog

	^ catalog! !
!Cart methodsFor: 'content' stamp: 'HernanWilkinson 6/22/2013 12:30'!
content

	^items copy! !
!Cart methodsFor: 'content' stamp: 'HernanWilkinson 6/23/2013 12:10'!
itemsAndQuantitiesDo: aBlock

	^ items contents keysAndValuesDo: [ :anItem :aQuantity | aBlock value: anItem value: aQuantity ]! !
!Cart methodsFor: 'content' stamp: 'HernanWilkinson 6/17/2013 17:45'!
occurrencesOf: anItem

	^items occurrencesOf: anItem  ! !
!Cart methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:29'!
initializeAcceptingItemsOf: aCatalog

	catalog := aCatalog.
	items := Bag new.! !
!Cart methodsFor: 'error signal' stamp: 'HernanWilkinson 6/22/2013 14:18'!
signalInvalidItem

	self error: self invalidItemErrorMessage! !
!Cart methodsFor: 'error signal' stamp: 'HernanWilkinson 6/22/2013 14:19'!
signalInvalidQuantity

	self error: self invalidQuantityErrorMessage ! !
!Cart methodsFor: 'testing' stamp: 'HernanWilkinson 6/17/2013 17:44'!
includes: anItem

	^items includes: anItem ! !
!Cart methodsFor: 'testing' stamp: 'HernanWilkinson 6/17/2013 17:44'!
isEmpty

	^items isEmpty ! !
!Cart methodsFor: 'adding' stamp: 'HernanWilkinson 6/17/2013 17:44'!
add: anItem

	^ self add: 1 of: anItem ! !
!Cart methodsFor: 'adding' stamp: 'HernanWilkinson 6/22/2013 12:31'!
add: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	items add: anItem withOccurrences: aQuantity ! !

!classDefinition: 'Cart class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:34'!
Cart class
	instanceVariableNames: ''!

!classDefinition: 'Cart class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:34'!
Cart class
	instanceVariableNames: ''!
!Cart class methodsFor: 'error messages' stamp: 'HernanWilkinson 6/21/2013 23:59'!
invalidItemErrorMessage

	^'Item is not in catalog'! !
!Cart class methodsFor: 'error messages' stamp: 'HernanWilkinson 6/22/2013 00:00'!
invalidQuantityErrorMessage

	^'Invalid number of items'! !
!Cart class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/17/2013 17:48'!
acceptingItemsOf: aCatalog

	^self new initializeAcceptingItemsOf: aCatalog ! !

!classDefinition: #CartSession category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #CartSession
	instanceVariableNames: 'owner cart lastUsedTime systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #CartSession category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #CartSession
	instanceVariableNames: 'owner cart lastUsedTime systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!CartSession methodsFor: 'time/expiration' stamp: 'HernanWilkinson 6/17/2015 20:34'!
assertIsNotExpirtedAt: aTime

	(self isExpiredAt: aTime) ifTrue: [ self signalCartSessionExpired ]! !
!CartSession methodsFor: 'time/expiration' stamp: 'HernanWilkinson 6/17/2015 20:36'!
isExpiredAt: aTime

	^ (lastUsedTime + systemFacade sessionDuration) < aTime! !
!CartSession methodsFor: 'time/expiration' stamp: 'HernanWilkinson 6/17/2015 20:36'!
now

	^systemFacade now! !
!CartSession methodsFor: 'time/expiration' stamp: 'HernanWilkinson 6/17/2015 20:37'!
today

	^systemFacade today! !
!CartSession methodsFor: 'session management' stamp: 'HernanWilkinson 6/17/2015 20:35'!
do: aBlock

	| now |

	now := self now.
	self assertIsNotExpirtedAt: now.

	^ [ aBlock value: self ] ensure: [ lastUsedTime := now  ]! !
!CartSession methodsFor: 'initialization' stamp: 'HernanWilkinson 6/17/2015 20:36'!
initializeOwnedBy: aCustomer with: aCart on: aSystemFacade

	owner := aCustomer.
	cart := aCart.
	systemFacade := aSystemFacade.
	lastUsedTime := self now.! !
!CartSession methodsFor: 'error signal' stamp: 'HernanWilkinson 6/17/2015 20:37'!
signalCartSessionExpired

	self error: systemFacade sessionHasExpiredErrorDescription ! !
!CartSession methodsFor: 'cart' stamp: 'HernanWilkinson 6/17/2015 20:34'!
addToCart: anAmount of: aBook

	^cart add: anAmount of: aBook! !
!CartSession methodsFor: 'cart' stamp: 'HernanWilkinson 6/17/2015 20:35'!
cartContent

	^cart content! !
!CartSession methodsFor: 'cart' stamp: 'HernanWilkinson 6/17/2015 20:35'!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !

!classDefinition: 'CartSession class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
CartSession class
	instanceVariableNames: ''!

!classDefinition: 'CartSession class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
CartSession class
	instanceVariableNames: ''!
!CartSession class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/17/2015 20:37'!
ownedBy: aCustomer with: aCart on: aSystemFacade

	^self new initializeOwnedBy: aCustomer with: aCart on: aSystemFacade! !

!classDefinition: #Cashier category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard owner ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #Cashier category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard owner ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/22/2013 12:17'!
createLineItemOf: anItem quantity: aQuantity

	^LineItem of: anItem quantity: aQuantity total: (self totalOf: anItem quantity: aQuantity) ! !
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/22/2013 12:25'!
createSale

	^ Sale doneBy: owner certifiedWith: ticket
! !
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/22/2013 12:28'!
createTicket

	| lineItems |

	lineItems := OrderedCollection new.
	cart itemsAndQuantitiesDo: [ :anItem :aQuantity |
		lineItems add: (self createLineItemOf: anItem quantity: aQuantity)].

	ticket := Ticket of: lineItems
	! !
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/22/2013 12:20'!
debitTotal

	merchantProcessor debit: ticket total from: creditCard.
	! !
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/17/2013 19:06'!
registerSale

	salesBook add: self createSale! !
!Cashier methodsFor: 'checkout - private' stamp: 'HernanWilkinson 6/22/2013 12:17'!
totalOf: anItem quantity: aQuantity

	^(cart catalog at: anItem) * aQuantity  ! !
!Cashier methodsFor: 'checkout' stamp: 'HernanWilkinson 6/22/2013 12:28'!
checkOut

	self createTicket.
	self debitTotal.
	self registerSale.

	^ ticket ! !
!Cashier methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:02'!
initializeToCheckout: aCart ownedBy: anOwner charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook

	cart := aCart.
	owner := anOwner.
	creditCard := aCreditCard.
	merchantProcessor := aMerchantProcessor.
	salesBook := aSalesBook! !

!classDefinition: 'Cashier class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Cashier class
	instanceVariableNames: ''!

!classDefinition: 'Cashier class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Cashier class
	instanceVariableNames: ''!
!Cashier class methodsFor: 'assertions' stamp: 'HernanWilkinson 6/22/2013 14:22'!
assertIsNotEmpty: aCart

	aCart isEmpty ifTrue: [self signalCartCanNotBeEmpty ]! !
!Cashier class methodsFor: 'assertions' stamp: 'HernanWilkinson 6/22/2013 14:22'!
assertIsNotExpired: aCreditCard on: aDate

	(aCreditCard isExpiredOn: aDate) ifTrue: [self signalCanNotChargeAnExpiredCreditCard]! !
!Cashier class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 12:00'!
toCheckout: aCart ownedBy: anOwner charging: aCreditCard throught: aMerchantProcessor on: aDate registeringOn: aSalesBook

	self assertIsNotEmpty: aCart.
	self assertIsNotExpired: aCreditCard on: aDate.

	^self new initializeToCheckout: aCart ownedBy: anOwner charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook! !
!Cashier class methodsFor: 'error messages' stamp: 'HernanWilkinson 6/17/2013 18:21'!
canNotChargeAnExpiredCreditCardErrorMessage

	^'Can not charge an expired credit card'! !
!Cashier class methodsFor: 'error messages' stamp: 'HernanWilkinson 6/17/2013 17:56'!
cartCanNotBeEmptyErrorMessage

	^'Can not check out an empty cart'! !
!Cashier class methodsFor: 'error messages' stamp: 'HernanWilkinson 6/17/2013 19:02'!
creditCardHasNoCreditErrorMessage

	^'Credit card has no credit'! !
!Cashier class methodsFor: 'error signal' stamp: 'HernanWilkinson 6/22/2013 14:22'!
signalCanNotChargeAnExpiredCreditCard

	 self error: self canNotChargeAnExpiredCreditCardErrorMessage ! !
!Cashier class methodsFor: 'error signal' stamp: 'HernanWilkinson 6/22/2013 14:22'!
signalCartCanNotBeEmpty

	self error: self cartCanNotBeEmptyErrorMessage! !

!classDefinition: #Clock category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Clock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #Clock category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Clock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!Clock methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 14:23'!
now

	self subclassResponsibility ! !
!Clock methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 14:23'!
today

	self subclassResponsibility ! !

!classDefinition: #CreditCard category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #CreditCard category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!CreditCard methodsFor: 'testing' stamp: 'HernanWilkinson 6/17/2013 18:39'!
isExpiredOn: aDate

	^expiration start < (Month month: aDate monthIndex year: aDate yearNumber) start ! !
!CreditCard methodsFor: 'initialization' stamp: 'HernanWilkinson 6/17/2013 18:38'!
initializeExpiringOn: aMonth

	expiration := aMonth ! !

!classDefinition: 'CreditCard class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
CreditCard class
	instanceVariableNames: ''!

!classDefinition: 'CreditCard class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
CreditCard class
	instanceVariableNames: ''!
!CreditCard class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/17/2013 18:38'!
expiringOn: aMonth

	^self new initializeExpiringOn: aMonth! !

!classDefinition: #LineItem category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #LineItem
	instanceVariableNames: 'item quantity total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #LineItem category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #LineItem
	instanceVariableNames: 'item quantity total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!LineItem methodsFor: 'accessing' stamp: 'HernanWilkinson 6/22/2013 12:33'!
item

	^ item! !
!LineItem methodsFor: 'accessing' stamp: 'HernanWilkinson 6/22/2013 12:21'!
total

	^ total! !
!LineItem methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:18'!
initializeOf: anItem quantity: aQuantity total: aTotal

	item := anItem.
	quantity := aQuantity.
	total := aTotal

! !

!classDefinition: 'LineItem class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
LineItem class
	instanceVariableNames: ''!

!classDefinition: 'LineItem class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
LineItem class
	instanceVariableNames: ''!
!LineItem class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 12:18'!
of: anItem quantity: aQuantity total: aTotal

	^self new initializeOf: anItem quantity: aQuantity total: aTotal

! !

!classDefinition: #MerchantProcessor category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #MerchantProcessor category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!MerchantProcessor methodsFor: 'debit' stamp: 'HernanWilkinson 6/22/2013 14:31'!
README

	"Aunque nadie subclasifica esta clase, esta para definir el protocolo que se espera que todo MerchantProcessor sepa responder - Hernan"! !
!MerchantProcessor methodsFor: 'debit' stamp: 'HernanWilkinson 6/22/2013 14:30'!
debit: anAmount from: aCreditCard

	self subclassResponsibility ! !

!classDefinition: #Sale category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Sale
	instanceVariableNames: 'customer ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #Sale category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Object subclass: #Sale
	instanceVariableNames: 'customer ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!Sale methodsFor: 'testing' stamp: 'HernanWilkinson 6/22/2013 12:06'!
wasDoneBy: aCustomer

	^customer = aCustomer ! !
!Sale methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:26'!
initializeDoneBy: aCustomer certifiedWith: aTicket

	customer := aCustomer.
	ticket := aTicket ! !
!Sale methodsFor: 'total' stamp: 'HernanWilkinson 6/22/2013 12:26'!
total

	^ ticket total! !
!Sale methodsFor: 'line items' stamp: 'HernanWilkinson 6/22/2013 12:33'!
lineItemsDo: aBlock

	^ticket lineItemsDo: aBlock ! !

!classDefinition: 'Sale class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Sale class
	instanceVariableNames: ''!

!classDefinition: 'Sale class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:35'!
Sale class
	instanceVariableNames: ''!
!Sale class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 12:25'!
doneBy: aCustomer certifiedWith: aTicket

	^self new initializeDoneBy: aCustomer certifiedWith: aTicket ! !

!classDefinition: #Ticket category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #Ticket
	instanceVariableNames: 'lineItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #Ticket category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #Ticket
	instanceVariableNames: 'lineItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!Ticket methodsFor: 'total' stamp: 'HernanWilkinson 6/17/2015 20:39'!
total

	^lineItems sum: [ :aLineItem | aLineItem total]! !
!Ticket methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:20'!
initializeOf: aCollectionOfLineItems

	lineItems := aCollectionOfLineItems ! !
!Ticket methodsFor: 'line items' stamp: 'HernanWilkinson 6/22/2013 12:33'!
lineItemsDo: aBlock

	^lineItems do: aBlock ! !

!classDefinition: 'Ticket class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Ticket class
	instanceVariableNames: ''!

!classDefinition: 'Ticket class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Ticket class
	instanceVariableNames: ''!
!Ticket class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 12:20'!
of: aCollectionOfLineItems

	^self new initializeOf: aCollectionOfLineItems ! !

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosServer category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #TusLibrosServer
	instanceVariableNames: 'port webServer systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/15/2021 21:25:34'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosServer methodsFor: 'initialization' stamp: 'MP 11/18/2021 18:29:30'!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosServer invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

!classDefinition: 'TusLibrosServer class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
TusLibrosServer class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosServer class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
TusLibrosServer class
	instanceVariableNames: ''!
!TusLibrosServer class methodsFor: 'as yet unclassified' stamp: 'MP 11/17/2021 15:53:46'!
listeningOn: aPortNumber communicateWith: aSystemFacade 

	^self basicNew initializeWith: aPortNumber and: aSystemFacade .! !
!TusLibrosServer class methodsFor: 'error handling' stamp: 'MP 11/17/2021 15:58:49'!
invalidUserOrPasswordErrorDescription
	^ 'INVALID_USERNAME_OR_PASSWORD'! !

!classDefinition: #TusLibrosSystemFacade category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #TusLibrosSystemFacade
	instanceVariableNames: 'validUsersAndPasswords catalog lastId merchantProcessor salesBook clock cartSessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosSystemFacade category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
Object subclass: #TusLibrosSystemFacade
	instanceVariableNames: 'validUsersAndPasswords catalog lastId merchantProcessor salesBook clock cartSessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/22/2013 11:24'!
canNotChargeAnExpiredCreditCardErrorMessage

	^Cashier canNotChargeAnExpiredCreditCardErrorMessage ! !
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/22/2013 11:17'!
cartCanNotBeEmptyErrorMessage

	^Cashier cartCanNotBeEmptyErrorMessage ! !
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/21/2013 23:27'!
invalidCartIdErrorDescription

	^'Invalid cart id'! !
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/21/2013 23:59'!
invalidItemErrorMessage

	^Cart invalidItemErrorMessage ! !
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/21/2013 23:03'!
invalidUserAndOrPasswordErrorDescription

	^'Invalid user and/or password'! !
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'HernanWilkinson 6/22/2013 13:07'!
sessionHasExpiredErrorDescription

	^'Can not use the cart after ', self sessionDuration minutes printString , ' minutes of inactivity'! !
!TusLibrosSystemFacade methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 13:02'!
now

	^clock now! !
!TusLibrosSystemFacade methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 12:49'!
today

	^clock today! !
!TusLibrosSystemFacade methodsFor: 'authentication' stamp: 'HernanWilkinson 6/23/2013 12:18'!
does: aUser authenticatesWith: aPassword

	"Recordar que esto es solo un ejemplo. No se deben guardar passwords en un sistema de verdad sino un
	hash o similar - Hernan"

	| storedPassword |

	storedPassword := validUsersAndPasswords at: aUser ifAbsent: [ ^false ].
	^aPassword = storedPassword ! !
!TusLibrosSystemFacade methodsFor: 'authentication' stamp: 'HernanWilkinson 6/23/2013 12:18'!
if: aUser authenticatesWith: aPassword do: aBlock

	^ (self does: aUser authenticatesWith: aPassword)
		ifTrue: aBlock
		ifFalse: [ self signalInvalidUserAndOrPassword ].
	! !
!TusLibrosSystemFacade methodsFor: 'error signal' stamp: 'HernanWilkinson 6/21/2013 23:27'!
signalInvalidCartId

	self error: self invalidCartIdErrorDescription ! !
!TusLibrosSystemFacade methodsFor: 'error signal' stamp: 'HernanWilkinson 6/21/2013 23:02'!
signalInvalidUserAndOrPassword

	self error: self invalidUserAndOrPasswordErrorDescription! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'HernanWilkinson 6/21/2013 23:32'!
generateCartId

	"Recuerden que esto es un ejemplo, por lo que voy a generar ids numericos consecutivos, pero en una
	implementacion real no deberian se numeros consecutivos ni nada que genere problemas de seguridad - Hernan"

	lastId := lastId + 1.
	^lastId! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'HernanWilkinson 6/22/2013 13:02'!
sessionDuration

	^30 minutes! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'HernanWilkinson 6/17/2015 20:50'!
withCartSessionIdentifiedAs: aCartId do: aBlock

	| cartSession |

	cartSession := cartSessions at: aCartId ifAbsent: [self signalInvalidCartId ].
	^cartSession do: aBlock
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HAW 11/26/2018 20:18:41'!
add: anAmount of: aBook toCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession addToCart: anAmount of: aBook ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HernanWilkinson 6/17/2015 20:47'!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HernanWilkinson 6/17/2015 20:52'!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self..
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HernanWilkinson 6/17/2015 20:48'!
listCartIdentifiedAs: aCartId

	^ self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession cartContent ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HAW 11/26/2018 20:33:49'!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'checkout support' stamp: 'HernanWilkinson 6/17/2015 20:49'!
merchantProcessor

	^ merchantProcessor! !
!TusLibrosSystemFacade methodsFor: 'checkout support' stamp: 'HernanWilkinson 6/17/2015 20:50'!
salesBook

	^ salesBook! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'HernanWilkinson 6/17/2015 20:56'!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'HernanWilkinson 6/17/2015 20:55'!
salesDoneBy: aUser

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	^ salesBook select: [ :aSale | aSale wasDoneBy: aUser ]! !
!TusLibrosSystemFacade methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 14:17'!
initializeAuthenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	validUsersAndPasswords := aValidUsersAndPasswords.
	catalog := aCatalog.
	salesBook := aSalesBook.
	merchantProcessor := aMerchantProcessor.
	clock := aClock.

	cartSessions := Dictionary new.
	lastId := 0.! !

!classDefinition: 'TusLibrosSystemFacade class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
TusLibrosSystemFacade class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosSystemFacade class' category: 'TusLibros-Model' stamp: 'AF 11/19/2021 13:52:36'!
TusLibrosSystemFacade class
	instanceVariableNames: ''!
!TusLibrosSystemFacade class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 14:17'!
authenticatingWith: aValidUsersAndPasswords
	acceptingItemsOf: aCatalog
	registeringOn: aSalesBook
	debitingThrought: aMerchantProcessor
	measuringTimeWith: aClock

	^self new
		initializeAuthenticatingWith: aValidUsersAndPasswords
		acceptingItemsOf: aCatalog
		registeringOn: aSalesBook
		debitingThrought: aMerchantProcessor
		measuringTimeWith: aClock! !

!classDefinition: #CartTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:36'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #CartTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:36'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:10'!
test01NewCartsAreCreatedEmpty

	self assert: testObjectsFactory createCart isEmpty! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:10'!
test02CanNotAddItemsThatDoNotBelongToStore

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [ cart add: testObjectsFactory itemNotSellByTheStore ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidItemErrorMessage.
			self assert: cart isEmpty ]! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:10'!
test03AfterAddingAnItemTheCartIsNotEmptyAnymore

	| cart |

	cart := testObjectsFactory createCart.

	cart add: testObjectsFactory itemSellByTheStore.
	self deny: cart isEmpty ! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:10'!
test04CanNotAddNonPositiveNumberOfItems

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart add: 0 of: testObjectsFactory itemSellByTheStore ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidQuantityErrorMessage.
			self assert: cart isEmpty ]! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:10'!
test05CanNotAddMoreThanOneItemNotSellByTheStore

	| cart |

	cart := testObjectsFactory createCart.

	self
		should: [cart add: 2 of: testObjectsFactory itemNotSellByTheStore  ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = cart invalidItemErrorMessage.
			self assert: cart isEmpty ]! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:11'!
test06CartRemembersAddedItems

	| cart |

	cart := testObjectsFactory createCart.

	cart add: testObjectsFactory itemSellByTheStore.
	self assert: (cart includes: testObjectsFactory itemSellByTheStore)! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:11'!
test07CartDoesNotHoldNotAddedItems

	| cart |

	cart := testObjectsFactory createCart.

	self deny: (cart includes: testObjectsFactory itemSellByTheStore)! !
!CartTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/17/2013 18:11'!
test08CartRemembersTheNumberOfAddedItems

	| cart |

	cart := testObjectsFactory createCart.

	cart add: 2 of: testObjectsFactory itemSellByTheStore.
	self assert: (cart occurrencesOf: testObjectsFactory itemSellByTheStore) = 2! !
!CartTest methodsFor: 'setup' stamp: 'HernanWilkinson 6/17/2013 18:09' overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.! !

!classDefinition: #CashierTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:36'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #CashierTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:37'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:00'!
test01CanNotCheckoutAnEmptyCart

	| salesBook |

	salesBook := OrderedCollection new.
	self
		should: [ Cashier
			toCheckout: testObjectsFactory createCart
			ownedBy: testObjectsFactory customer
			charging: testObjectsFactory notExpiredCreditCard
			throught: self
			on: testObjectsFactory today
			registeringOn:  salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier cartCanNotBeEmptyErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:22'!
test02CalculatedTotalIsCorrect

	| cart cashier |

	cart := testObjectsFactory createCart.
	cart add: 2 of: testObjectsFactory itemSellByTheStore.

	cashier :=  Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: testObjectsFactory notExpiredCreditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: OrderedCollection new.

	self assert: cashier checkOut total = (testObjectsFactory itemSellByTheStorePrice * 2)! !
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:01'!
test03CanNotCheckoutWithAnExpiredCreditCart

	| cart salesBook |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	salesBook := OrderedCollection new.

	self
		should: [ Cashier
				toCheckout: cart
				ownedBy: testObjectsFactory customer
				charging: testObjectsFactory expiredCreditCard
				throught: self
				on: testObjectsFactory today
				registeringOn: salesBook ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier canNotChargeAnExpiredCreditCardErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:23'!
test04CheckoutRegistersASale

	| cart cashier salesBook total |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	salesBook := OrderedCollection new.

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: testObjectsFactory notExpiredCreditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	total := cashier checkOut total.

	self assert: salesBook size = 1.
	self assert: salesBook first total = total.! !
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:22'!
test05CashierChargesCreditCardUsingMerchantProcessor

	| cart cashier salesBook total creditCard debitedAmout debitedCreditCard  |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	debitBehavior := [ :anAmount :aCreditCard |
		debitedAmout := anAmount.
		debitedCreditCard := aCreditCard ].
	total := cashier checkOut total.

	self assert: debitedCreditCard = creditCard.
	self assert: debitedAmout = total.! !
!CashierTest methodsFor: 'tests' stamp: 'HernanWilkinson 6/22/2013 12:02'!
test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit

	| cart cashier salesBook creditCard |

	cart := testObjectsFactory createCart.
	cart add: testObjectsFactory itemSellByTheStore.
	creditCard := testObjectsFactory notExpiredCreditCard.
	salesBook := OrderedCollection new.
 	debitBehavior := [ :anAmount :aCreditCard | self error: Cashier creditCardHasNoCreditErrorMessage].

	cashier:= Cashier
		toCheckout: cart
		ownedBy: testObjectsFactory customer
		charging: creditCard
		throught: self
		on: testObjectsFactory today
		registeringOn: salesBook.

	self
		should: [cashier checkOut ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText = Cashier creditCardHasNoCreditErrorMessage.
			self assert: salesBook isEmpty ]! !
!CashierTest methodsFor: 'setup' stamp: 'HernanWilkinson 6/17/2013 19:03' overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	debitBehavior := [ :anAmount :aCreditCard | ]! !
!CashierTest methodsFor: 'merchant processor protocol' stamp: 'HernanWilkinson 6/17/2013 19:02'!
debit: anAmount from: aCreditCard

	^debitBehavior value: anAmount value: aCreditCard ! !

!classDefinition: #TusLibrosServerTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:37'!
TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #TusLibrosServerTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:37'!
TestCase subclass: #TusLibrosServerTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/18/2021 17:53:50'!
invalidPassword

	^'invalidPassword'! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:47:47'!
validUser

	^'validUser'! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:48:21'!
validUserPassword

	^'validUserPassword'! !
!TusLibrosServerTest methodsFor: 'test objects' stamp: 'MP 11/17/2021 15:48:17'!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself! !
!TusLibrosServerTest methodsFor: 'setup' stamp: 'MP 11/17/2021 15:48:58'!
createSalesBook

	^OrderedCollection new! !
!TusLibrosServerTest methodsFor: 'setup' stamp: 'MP 11/17/2021 15:49:07'!
merchantProcessor

	^self! !
!TusLibrosServerTest methodsFor: 'setup' stamp: 'MP 11/17/2021 15:46:51' overrides: 16927572!
setUp
	
	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 17:49:47'!
test01CreateCartForValidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respText.
	! !
!TusLibrosServerTest methodsFor: 'tests' stamp: 'MP 11/18/2021 18:30:20'!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosServer listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|',TusLibrosServer invalidUserOrPasswordErrorDescription = respText.
	! !

!classDefinition: #TusLibrosSystemFacadeTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:37'!
TestCase subclass: #TusLibrosSystemFacadeTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #TusLibrosSystemFacadeTest category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:37'!
TestCase subclass: #TusLibrosSystemFacadeTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'HAW 6/19/2018 11:41:46'!
test04CanAddItemsToACreatedCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.

	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self assert: ((systemFacade listCartIdentifiedAs: cartId) occurrencesOf: self validBook) equals: 1
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'HAW 11/26/2018 18:03:02'!
test05CanNotAddItemToNotCreatedCart

	self
		should: [systemFacade add: 1 of: self validBook toCartIdentifiedAs: self invalidCartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'HAW 11/26/2018 18:03:17'!
test06CanNotAddItemNotSellByTheStore

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade add: 1 of: self invalidBook toCartIdentifiedAs: cartId ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidItemErrorMessage.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - add to cart' stamp: 'HAW 11/26/2018 18:03:58'!
test17CanNotAddToCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self revertTime: systemFacade sessionDuration.
			self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty ]
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'HAW 11/26/2018 18:07:48'!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: (testObjectsFactory itemSellByTheStorePrice * 2).
	self assert: (purchases at: self anotherValidBook) equals: testObjectsFactory anotherItemSellByTheStorePrice.! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'HAW 11/26/2018 18:10:29'!
test15CanNotListPurchasesOfInvalidCustomer

	self
		should: [systemFacade listPurchasesOf: self invalidUser authenticatingWith: self validUserPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'HAW 11/26/2018 18:10:45'!
test16CanNotListPurchasesOfValidCustomerWithInvalidPassword

	self
		should: [systemFacade listPurchasesOf: self validUser authenticatingWith: self invalidPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - create cart' stamp: 'HAW 6/19/2018 11:40:51'!
test01CanCreateCartWithValidUserAndPassword

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - create cart' stamp: 'HAW 11/26/2018 18:02:23'!
test02CanNotCreateCartWithInvalidUser

	self
		should: [ systemFacade createCartFor: self invalidUser authenticatedWith: self validUserPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - create cart' stamp: 'HAW 11/26/2018 18:02:33'!
test03CanNotCreateCartWithInvalidPassword

	self
		should: [ systemFacade createCartFor: self validUser authenticatedWith: self invalidPassword ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidUserAndOrPasswordErrorDescription ]! !
!TusLibrosSystemFacadeTest methodsFor: 'merchant processor protocol' stamp: 'HernanWilkinson 6/22/2013 11:48'!
debit: anAmount from: aCreditCard
! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'HernanWilkinson 6/22/2013 11:42'!
createSalesBook

	^OrderedCollection new! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'HernanWilkinson 6/22/2013 11:47'!
merchantProcessor

	^self! !
!TusLibrosSystemFacadeTest methodsFor: 'setup' stamp: 'HernanWilkinson 6/17/2015 20:53' overrides: 16927572!
setUp

	testObjectsFactory := StoreTestObjectsFactory new.
	clock := ManualClock now: testObjectsFactory today.
	systemFacade := TusLibrosSystemFacade
		authenticatingWith: self validUsersAndPasswords
		acceptingItemsOf: testObjectsFactory defaultCatalog
		registeringOn: self createSalesBook
		debitingThrought: self merchantProcessor
		measuringTimeWith: clock
! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/22/2013 00:15'!
anotherValidBook

	^testObjectsFactory anotherItemSellByTheStore ! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 23:49'!
invalidBook

	^testObjectsFactory itemNotSellByTheStore ! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 23:25'!
invalidCartId

	"Devuelvo nil porque seguro que siempre sera un id invalido, no importa que sea el id - Hernan"
	^nil! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 23:06'!
invalidPassword

	^'invalidPassword'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 22:30'!
invalidUser

	^'invalidUser'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 23:50'!
validBook

	^testObjectsFactory itemSellByTheStore ! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 22:27'!
validUser

	^'validUser'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 22:28'!
validUserPassword

	^'validUserPassword'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'HernanWilkinson 6/21/2013 22:43'!
validUsersAndPasswords

	^Dictionary new
		at: self validUser put: self validUserPassword;
		yourself! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'HAW 6/19/2018 11:45:13'!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'HAW 11/26/2018 18:05:20'!
test11CanNotCheckoutANotCreatedCart

	self
		should: [systemFacade
			checkOutCartIdentifiedAs: self invalidCartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]

		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'HAW 11/26/2018 18:06:07'!
test12CanNotCheckoutAnEmptyCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade cartCanNotBeEmptyErrorMessage.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]

		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'HAW 11/26/2018 18:07:02'!
test13CanNotCheckoutWithAnExpiredCreditCard

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory expiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade canNotChargeAnExpiredCreditCardErrorMessage.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]

		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'HAW 11/26/2018 18:07:15'!
test19CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			self assert: (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) isEmpty ]


	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'HernanWilkinson 6/17/2015 20:53'!
test07ListCartOfAnEmptyCartReturnsAnEmptyBag

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self assert: (systemFacade listCartIdentifiedAs: cartId) isEmpty
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'HAW 11/26/2018 18:04:15'!
test08CanNotListCartOfInvalidCartId

	self
		should: [systemFacade listCartIdentifiedAs: self invalidCartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade invalidCartIdErrorDescription ]
	! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'HAW 11/26/2018 18:04:32'!
test09ListCartReturnsTheRightNumberOfItems

	| cartId cartContent |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 2 of: self anotherValidBook toCartIdentifiedAs: cartId.
	cartContent := systemFacade listCartIdentifiedAs: cartId.

	self assert: (cartContent occurrencesOf: self validBook) equals: 1.
	self assert: (cartContent occurrencesOf: self anotherValidBook) equals: 2
! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - list cart' stamp: 'HAW 11/26/2018 18:04:42'!
test18CanNotListCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self
		should: [systemFacade listCartIdentifiedAs: cartId]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription ].

! !
!TusLibrosSystemFacadeTest methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 12:53'!
advanceTime: aDuration

	clock advanceTime: aDuration ! !
!TusLibrosSystemFacadeTest methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 13:07'!
revertTime: aDuration

	clock revertTime: aDuration ! !

!classDefinition: #ManualClock category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
Clock subclass: #ManualClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #ManualClock category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
Clock subclass: #ManualClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!ManualClock methodsFor: 'time change' stamp: 'HernanWilkinson 6/22/2013 12:54'!
advanceTime: aDuration

	now := now + aDuration ! !
!ManualClock methodsFor: 'time change' stamp: 'HernanWilkinson 6/22/2013 13:08'!
revertTime: aDuration

	now := now + aDuration negated ! !
!ManualClock methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 12:56' overrides: 50975047!
now

	^ now! !
!ManualClock methodsFor: 'time' stamp: 'HernanWilkinson 6/22/2013 12:53' overrides: 50975051!
today

	^now date! !
!ManualClock methodsFor: 'initialization' stamp: 'HernanWilkinson 6/22/2013 12:52'!
initializeNow: aTime

	now := aTime ! !

!classDefinition: 'ManualClock class' category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
ManualClock class
	instanceVariableNames: ''!

!classDefinition: 'ManualClock class' category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
ManualClock class
	instanceVariableNames: ''!
!ManualClock class methodsFor: 'instance creation' stamp: 'HernanWilkinson 6/22/2013 12:52'!
now: aTime

	^self new initializeNow: aTime ! !

!classDefinition: #StoreTestObjectsFactory category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #StoreTestObjectsFactory category: 'TusLibros-Tests' stamp: 'AF 11/19/2021 13:52:38'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'HernanWilkinson 6/22/2013 00:16'!
anotherItemSellByTheStore

	^'anotherValidBook'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'HernanWilkinson 6/22/2013 00:16'!
anotherItemSellByTheStorePrice

	^15! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'HernanWilkinson 6/17/2013 18:08'!
itemNotSellByTheStore

	^'invalidBook'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'HernanWilkinson 6/17/2013 18:08'!
itemSellByTheStore

	^ 'validBook'! !
!StoreTestObjectsFactory methodsFor: 'items' stamp: 'HernanWilkinson 6/17/2013 18:08'!
itemSellByTheStorePrice

	^10! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'HernanWilkinson 6/17/2013 18:08'!
createCart

	^Cart acceptingItemsOf: self defaultCatalog! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'HernanWilkinson 6/22/2013 00:16'!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HernanWilkinson 6/22/2013 11:24'!
expiredCreditCard

	^CreditCard expiringOn: self expiredMonthOfYear ! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HernanWilkinson 6/22/2013 11:24'!
expiredMonthOfYear

	^ Month month: today monthIndex year: today yearNumber - 1! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HernanWilkinson 6/22/2013 11:06'!
notExpiredCreditCard

	^CreditCard expiringOn: self notExpiredMonthOfYear! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HAW 6/19/2018 11:45:30'!
notExpiredCreditCardNumber

	^ '1111222233334444' ! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HAW 6/19/2018 11:45:48'!
notExpiredCreditCardOwner

	^'Juan Perez'! !
!StoreTestObjectsFactory methodsFor: 'credit card' stamp: 'HernanWilkinson 6/22/2013 11:06'!
notExpiredMonthOfYear

	^ Month month: today monthIndex year: today yearNumber + 1! !
!StoreTestObjectsFactory methodsFor: 'initialization' stamp: 'HernanWilkinson 6/17/2013 18:37' overrides: 16896425!
initialize

	today := DateAndTime now! !
!StoreTestObjectsFactory methodsFor: 'date' stamp: 'HernanWilkinson 6/17/2013 18:37'!
today

	^ today! !
!StoreTestObjectsFactory methodsFor: 'customer' stamp: 'HernanWilkinson 6/22/2013 12:02'!
customer

	^'aCustomer'! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:45:30' prior: 50975899!
test01CreateCartForValidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respText.
	! !
!TusLibrosServerTest methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 11:45:30' prior: 50975914!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|',TusLibrosRestInterface invalidUserOrPasswordErrorDescription = respText.
	! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:53:19'!
PASSED!

!classRenamed: #TusLibrosServer as: #TusLibrosRestAPIInterface stamp: 'AF 11/19/2021 13:54:53'!
Smalltalk renameClassNamed: #TusLibrosServer as: #TusLibrosRestAPIInterface!
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 13:54:53' prior: 50975279!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			request send200Response: '0|',cartId asString .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestAPIInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

!classRenamed: #TusLibrosServerTest as: #TusLibrosRestAPIInterfaceTest stamp: 'AF 11/19/2021 13:55:14'!
Smalltalk renameClassNamed: #TusLibrosServerTest as: #TusLibrosRestAPIInterfaceTest!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 13:55:22' prior: 50976532!
test01CreateCartForValidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respText.
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 13:56:15' prior: 50976548!
test02CreateCartForInvalidCredentials

	|server resp client respText |
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respText _ resp content.
	
	client close.
	server destroy.
	self assert: '1|',TusLibrosRestAPIInterface invalidUserOrPasswordErrorDescription = respText.
	! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/19/2021 13:56:38'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/19/2021 13:56:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 13:56:44'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 13:56:44'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:02:45' prior: 50976643!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(TusLibrosRestAPIInterface invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:03:11' prior: 50976677!
test01CreateCartForValidCredentials

	|server resp client respDecoded |
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ resp content.
	
	client close.
	server destroy.
	self assert: '0|1' equals: respDecoded.
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:03:47' prior: 50976875!
test01CreateCartForValidCredentials

	|server resp client respDecoded |
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	
	self assert: '0|1' equals: respDecoded.
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:04:19' prior: 50976892!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	self assert: '0|1' equals: respDecoded.
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:05:08' prior: 50976910!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status') .
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 14:05:13'!
PASSED!

----SNAPSHOT----(19 November 2021 14:24:21) CuisUniversity-4972.image priorSource: 20491248!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:32:09' prior: 50976693!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (TusLibrosSystemFacade invalidUserOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:32:43'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:32:43'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:33:52' prior: 50976962!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	! !

!methodRemoval: TusLibrosRestAPIInterface class #invalidUserOrPasswordErrorDescription stamp: 'AF 11/19/2021 14:36:12'!
invalidUserOrPasswordErrorDescription
	^ 'INVALID_USERNAME_OR_PASSWORD'!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:39:13' prior: 50976843!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(systemFacade invalidUserOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:40:33' prior: 50976994!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ WebUtils jsonDecode: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:41:34' prior: 50977024!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: '1|',(systemFacade invalidUserAndOrPasswordErrorDescription)] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 14:41:41'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:41:41'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:41:41'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:42:29' prior: 50977055!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:42:53' prior: 50976931!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status') .
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 14:43:37' prior: 50977122!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ WebUtils jsonMapFrom: (resp content) readStream.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'errorDescription') equals: (respDecoded at: 'errorDescription').
	! !

----SNAPSHOT----(19 November 2021 14:43:44) CuisUniversity-4972.image priorSource: 20649843!

TusLibrosRestAPIInterface allInstances!

WebServer allInstances!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 14:45:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:45:56'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:45:56'!
ERROR!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:49:53' prior: 50977079!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
																			 add: 'errorDescription' -> systemFacade invalidUserAndOrPasswordErrorDescription;
																			 yourself))] 
				ifFalse: [request send500Response: anError messageText	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:51:04' prior: 50977215!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
																			 add: 'errorDescription' -> systemFacade invalidUserAndOrPasswordErrorDescription;
																			 yourself))] 
				ifFalse: [request send500Response: (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
																			 add: 'errorDescription' -> anError messageText;
																			 yourself))	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:51:48' prior: 50977251!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
																			 add: 'errorDescription' -> anError messageText;
																			 yourself))] 
				ifFalse: [request send500Response: (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
																			 add: 'errorDescription' -> anError messageText;
																			 yourself))	].
		]
	].
	
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 14:53:15' prior: 50977291!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:53:20'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:53:20'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:54:40'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 14:54:46'!
FAILURE!

WebServer allInstances!

TusLibrosRestAPIInterface allInstances!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance connections ].!

WebServer allInstancesDo: [:anInstance | anInstance connections].!

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface allInstances.!

WebServer allInstances!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 15:01:55'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:05:26'!
decodeJsonMapFrom: resp

	^ WebUtils jsonMapFrom: (resp content) readStream! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:05:26' prior: 50977146!
test01CreateCartForValidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ self decodeJsonMapFrom: resp.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status') .
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:05:26' prior: 50977171!
test02CreateCartForInvalidCredentials

	|server resp client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	resp _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ self decodeJsonMapFrom: resp.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'errorDescription') equals: (respDecoded at: 'errorDescription').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:01' prior: 50977402!
test01CreateCartForValidCredentials

	|server response client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	respDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status') .
	self assert: (respExpected at: 'cartId') equals: (respDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:12' prior: 50977452!
test01CreateCartForValidCredentials

	|server response client responseDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	respExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (respExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (respExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:18' prior: 50977476!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:26' prior: 50977426!
test02CreateCartForInvalidCredentials

	|server response client respDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	respDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (respDecoded at: 'status').
	self assert: (respExpected at: 'errorDescription') equals: (respDecoded at: 'errorDescription').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:32' prior: 50977526!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded respExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	respExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (respExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (respExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:06:38' prior: 50977553!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:09:17' prior: 50977580!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 15:09:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 15:09:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 15:09:19'!
PASSED!

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

WebServer allInstancesDo: [:anInstance | anInstance connections].!

----SNAPSHOT----(19 November 2021 15:10:18) CuisUniversity-4972.image priorSource: 20657486!

WebServer allInstancesDo: [:anInstance | anInstance connections].!
!WebServer methodsFor: 'accessing' stamp: 'AF 11/19/2021 15:11:13' prior: 50958083!
connections
	"The active connection processes. Can only be examined after aquiring
	the WebServer's mutex."

	^connections! !
!WebServer methodsFor: 'accessing' stamp: 'AF 11/19/2021 15:11:22' prior: 50958103!
errorHandler: aBlock
	"The user-supplied error handler. If present the handler takes two arguments:
		* The error being caught by WebServer
		* The request the error occurred in.
	The user-supplied error handler can do whatever it wants, including calling
	WebServer's #handleError:request: method which is the default."

	errorHandler := aBlock.! !
!WebServer methodsFor: 'accessing' stamp: 'AF 11/19/2021 15:11:26' prior: 50958117!
listenerInterface
	"Returns the listener interface for the server"

	^interface! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:17:23'!
test03

	|server client cartId response responseDecoded responseExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:17:28'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:18:05' prior: 50977685!
test03

	|server client cartId response responseDecoded responseExpected|
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

WebServer allInstancesDo: [:anInstance | anInstance connections].
!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:18:25'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:21:50' prior: 50977330!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:23:16' prior: 50977756!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

----SNAPSHOT----(19 November 2021 15:24:01) CuisUniversity-4972.image priorSource: 20672048!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:27:09' prior: 50977816!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:27:13'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:27:13'!
ERROR!
!WebServer methodsFor: 'initialize' stamp: 'AF 11/19/2021 15:29:39' prior: 50958029!
destroy
	"Destroys the receiver"

	self stopListener.
	self destroyConnections.
	listenerSocket ifNotNil:[listenerSocket destroy].

	"De-register the WebServer"
	(self class forUrl: self siteUrl ifAbsent:[self]) == self 
		ifTrue:[self class removeUrl: siteUrl]

! !

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:30:05'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:30:05'!
ERROR!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:32:21' prior: 50975274!
destroy
	
	webServer ifNotNil:[webServer destroy].
	webServer _ nil.! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:35:06' prior: 50977968!
destroy
	
	webServer ifNotNil:[webServer destroy].! !

TusLibrosRestAPIInterface allInstances.!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:35:46'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:37:25'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:37:48'!
ERROR!

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:39:35' prior: 50977881!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			self halt.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:39:40'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:39:40'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:39:57'!
ERROR!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:40:49' prior: 50977993!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			self halt.
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:40:54'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:40:54'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

----STARTUP---- (19 November 2021 15:41:33) as C:\Users\ferra\Desktop\windows64\windows64\CuisUniversity-4972.image!

!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:42:01' prior: 50977816!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
						
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			self halt.
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

TusLibrosRestAPIInterface allInstances.!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:43:23'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:43:32'!
ERROR!

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:46:14'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:46:27'!
ERROR!

----STARTUP---- (19 November 2021 15:50:49) as C:\Users\ferra\Desktop\windows64\windows64\CuisUniversity-4972.image!


TusLibrosRestAPIInterface allInstances.!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:51:28' prior: 50975274!
destroy
	
	webServer ifNotNil:[webServer destroy].
	systemFacade _ nil.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 15:51:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 15:51:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:51:34'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:51:34'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:52:28'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:52:28'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:52:46' prior: 50978229!
destroy
	
	webServer ifNotNil:[webServer destroy].
! !

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 15:54:49' prior: 50977816!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
			self Halt.			
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:54:54'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 15:54:54'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 15:58:26' prior: 50977501!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:00:17'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:00:31'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:00:31'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:00:42' prior: 50978335!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	

	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:00:44'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:01:01'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:01:01'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstances.!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:01:31'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:01:31'!
ERROR!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 16:02:17' prior: 50978267!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:02:48'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:02:48'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:03:13'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:03:15'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:03:17'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:03:17'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:03:44' prior: 50977717!
test03

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:04:04' prior: 50978374!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:04:06'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:04:06'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:40'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:04:50' prior: 50977608!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:04:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:04:52'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:04:52'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:55'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:04:57'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:05:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:05:00'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:05:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:05:00'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstances. !

TusLibrosRestAPIInterface allInstances. !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:06:20'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:06:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:06:24'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:06:24'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 16:07:35' prior: 50978424!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 16:07:48' prior: 50978697!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] 
				ifFalse: [request send500Response: response	].
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:07:58'!
PASSED!

----SNAPSHOT----(19 November 2021 16:08:06) CuisUniversity-4972.image priorSource: 20679235!

TusLibrosRestAPIInterface allInstances. !

TusLibrosRestAPIInterface allInstances. !

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:08:45'!
PASSED!

TusLibrosRestAPIInterface allInstances. !

----SNAPSHOT----(19 November 2021 16:09:04) CuisUniversity-4972.image priorSource: 20709518!

TusLibrosRestAPIInterface allInstances. !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:31:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:31:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:31:21'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 16:35:34' prior: 50978759!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] .
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			(anError messageText = systemFacade invalidUserAndOrPasswordErrorDescription ) 
				ifTrue: [request send200Response: response] .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 16:36:40' prior: 50978849!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 16:36:42'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 16:36:42'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 16:36:42'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:44:16'!
test04

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:45:04' prior: 50978971!
test04

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 16:45:06'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:51:27' prior: 50979003!
test04

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 16:55:08' prior: 50979040!
test04

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore .
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

WebUtils jsonEncode: ((Bag new) add: 'hola'; yourself).!

WebUtils jsonMap: ((Bag new) add: 'hola'; yourself) on: (WriteStream on:'').!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 17:09:48' prior: 50979072!
test04

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 17:10:56' prior: 50979111!
test04

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

|book|
book _ 'hola'.
Dictionary new add: book -> 1.!


|book|
book _ 'hola'.
Dictionary new add: book -> 1; at: book.!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 17:13:59'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:15:44' prior: 50978908!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId response |
			cartId := (request fields at:'cartId').	
			
			systemFacade listCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].
	webServer startListener.
! !

----End fileIn of C:\Users\ferra\Desktop\windows64\windows64\Packages\TerseGuide.pck.st----!

----SNAPSHOT----(19 November 2021 17:18:17) CuisUniversity-4972.image priorSource: 20709832!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:24:00' prior: 50979194!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ Dictionary new.
			cartContents do:[:aBook | cartContentsDictionary add: aBook -> (cartContents occurrencesOf: aBook)] .
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].
	webServer startListener.
! !

----SNAPSHOT----(19 November 2021 17:24:37) CuisUniversity-4972.image priorSource: 20817249!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 17:24:45'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 17:26:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 17:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 17:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 17:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 17:26:38'!
PASSED!

----SNAPSHOT----(19 November 2021 17:26:53) CuisUniversity-4972.image priorSource: 20819892!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/19/2021 17:38:45'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/19/2021 17:38:45'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:42:46'!
errorResponseBasedOn: anError

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:42:46' prior: 50982194!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ Dictionary new.
			cartContents do:[:aBook | cartContentsDictionary add: aBook -> (cartContents occurrencesOf: aBook)] .
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:42:46' prior: 50982438!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ Dictionary new.
			cartContents do:[:aBook | cartContentsDictionary add: aBook -> (cartContents occurrencesOf: aBook)] .
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
													     add: 'errorDescription' -> anError messageText;
													     yourself).
			request send200Response: response .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:42:47' prior: 50982514!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response.
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ Dictionary new.
			cartContents do:[:aBook | cartContentsDictionary add: aBook -> (cartContents occurrencesOf: aBook)] .
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			|response|
			response _ self errorResponseBasedOn: anError.
			request send200Response: response .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:44:46' prior: 50982586!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ Dictionary new.
			cartContents do:[:aBook | cartContentsDictionary add: aBook -> (cartContents occurrencesOf: aBook)] .
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:47:22'!
xxxxx: aBag

	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:48:37' prior: 50982719!
xxxxx: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)] ! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:48:50' prior: 50982723!
xxxxx: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary .! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:50:55' prior: 50982732!
xxxxx: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:51:38' prior: 50982654!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self xxxxx: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:52:01'!
convertToDictionary: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 17:52:01' prior: 50982752!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #xxxxx: stamp: 'AF 11/19/2021 17:52:01'!
xxxxx: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.!

----SNAPSHOT----(19 November 2021 17:56:32) CuisUniversity-4972.image priorSource: 20820592!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:58:32' prior: 50982825!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := (WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)).
			request send200Response: response.
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:59:10' prior: 50982428!
errorResponseBasedOn: anError

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
									   add: 'errorDescription' -> anError messageText;
									   yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 17:59:42' prior: 50982899!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself).
			request send200Response: response.
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:00:58'!
responseForCreateCart: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:00:58' prior: 50982971!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId response |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
			
			response := self responseForCreateCart: cartId.
			request send200Response: response.
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:01:38' prior: 50983041!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
						
			request send200Response: (self responseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:02:32'!
jsonResponseForCreateCart: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 18:02:32' prior: 50983102!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self errorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self errorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #responseForCreateCart: stamp: 'AF 11/19/2021 18:02:32'!
responseForCreateCart: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:02:52'!
jsonErrorResponseBasedOn: anError

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
									   add: 'errorDescription' -> anError messageText;
									   yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 18:02:52' prior: 50983169!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user psw cartId |
			user := (request fields at:'clientId').
			psw := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: psw.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #errorResponseBasedOn: stamp: 'AF 11/19/2021 18:02:52'!
errorResponseBasedOn: anError

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
									   add: 'errorDescription' -> anError messageText;
									   yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:03:28' prior: 50983245!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := (Dictionary new) add: 'status' -> 0; yourself.
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:04:25' prior: 50983314!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; yourself).
			request send200Response: response .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:04:37' prior: 50983375!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; yourself).
			request send200Response: response .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:05:09'!
jsonResponseForAddToCart

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:05:09' prior: 50983436!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId response |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.
			
			response := self jsonResponseForAddToCart.
			request send200Response: response .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:05:29' prior: 50983503!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself.
			
			request send200Response: (WebUtils jsonEncode: response) .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:05:59' prior: 50983562!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself).
			
			request send200Response: response .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:06:30'!
jsonResponseForListCart: cartContentsDictionary

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:06:30' prior: 50983620!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary response |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			response := self jsonResponseForListCart: cartContentsDictionary.
			
			request send200Response: response .
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:06:51' prior: 50983687!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.
			
			
			
			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:06:59' prior: 50983743!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 
			request send200Response: (self jsonErrorResponseBasedOn: anError).
		]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |
			request send200Response: (self jsonErrorResponseBasedOn: anError) .
		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 18:07:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 18:07:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 18:07:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 18:07:00'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:08:08' prior: 50983798!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 18:08:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 18:08:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 18:08:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 18:08:33'!
PASSED!

----SNAPSHOT----(19 November 2021 18:08:37) CuisUniversity-4972.image priorSource: 20839827!

----SNAPSHOT----(19 November 2021 18:16:03) CuisUniversity-4972.image priorSource: 20873026!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:21:33'!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId,'&ccn=').
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:25:34' prior: 50983939!
test05

	|server client cartId book creditCard response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	creditCard _ testObjectsFactory notExpiredCreditCard .
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId,'&ccn=', creditCard number, '&cced=', testObjectsFactory notExpiredMonthOfYear, '&cco=', testObjectsFactory notExpiredCreditCardOwner ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:34:29' prior: 50983978!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId,'&ccn=', testObjectsFactory notExpiredCreditCardNumber , '&cced=', testObjectsFactory notExpiredMonthOfYear, '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:37:16' prior: 50984023!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:37:53' prior: 50984067!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:49:27' prior: 50984113!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:49:31' prior: 50984159!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 18:49:35'!
ERROR!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:54:30' prior: 50983866!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonResponseForAddToCart.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'ccn') .	
			cardOwner := (request fields at:'ccn') .	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:54:56'!
jsonSuccessfulResponse

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/19/2021 18:54:56' prior: 50984245!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'ccn') .	
			cardOwner := (request fields at:'ccn') .	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForAddToCart stamp: 'AF 11/19/2021 18:54:56'!
jsonResponseForAddToCart

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 18:56:48' prior: 50984326!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'ccn') .	
			cardOwner := (request fields at:'ccn') .	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 18:58:07' prior: 50984202!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear asString,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:03:20' prior: 50984481!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

(Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber) asString!

((Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber) asString) asMonth!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:09:45' prior: 50984521!
test05

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', testObjectsFactory notExpiredMonthOfYear asString,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:10:20' prior: 50984407!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:10:22'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:10:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:10:22'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:10:22'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:10:22'!
ERROR!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:10:57'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:10:58'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:10:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:11:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:11:02'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:11:02'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:11:22'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:11:22'!
FAILURE!

self content!

self contents!

self content!

TusLibrosRestAPIInterface allInstances. 
TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].
!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:15:21' prior: 50984606!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			self halt.
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:15:27'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:15:27'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].
!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:26'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:26'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:38'!
PASSED!

----SNAPSHOT----(19 November 2021 19:16:48) CuisUniversity-4972.image priorSource: 20873120!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:52'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:52'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:16:55'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:17:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:17:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:17:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:17:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:04'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:04'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:17:18'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:17:18'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:17:18'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:17:18'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:18'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:18'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:17:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:17:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:17:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:17:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:22'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:22'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:17:34'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:19:29' prior: 50984729!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			self halt.
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:19:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:19:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:19:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:19:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:19:30'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:19:30'!
FAILURE!

----SNAPSHOT----(19 November 2021 19:19:39) CuisUniversity-4972.image priorSource: 20901412!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:22:05' prior: 50984898!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/19/2021 19:22:36' prior: 50975463!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self halt.

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:22:40'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:22:40'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:22:40'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:22:40'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:22:40'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:22:40'!
FAILURE!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/19/2021 19:22:56' prior: 50985070!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/19/2021 19:23:15'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/19/2021 19:23:15'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/19/2021 19:23:15'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/19/2021 19:23:15'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:23:15'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:23:15'!
FAILURE!

----SNAPSHOT----(19 November 2021 19:23:21) CuisUniversity-4972.image priorSource: 20906892!

TusLibrosRestAPIInterface allInstances. 
TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!

----SNAPSHOT----(19 November 2021 19:24:53) CuisUniversity-4972.image priorSource: 20911499!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:25:07' prior: 50984995!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			self halt.
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:25:14'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:25:14'!
FAILURE!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:47:55' prior: 50984566!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName, '%20',testObjectsFactory notExpiredMonthOfYear yearNumber.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:48:38' prior: 50985237!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:48:53'!
ERROR!

TusLibrosRestAPIInterface allInstances. 
TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].
!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:49:14' prior: 50985282!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber asString.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

----STARTUP---- (19 November 2021 19:50:15) as C:\Users\ferra\Desktop\windows64\windows64\CuisUniversity-4972.image!

!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:25:07' prior: 50984995!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn') .	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco') .	
			
			self halt.
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:47:55' prior: 50984566!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName, '%20',testObjectsFactory notExpiredMonthOfYear yearNumber.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:48:38' prior: 50985458!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:49:14' prior: 50985503!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber asString.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 19:51:01' prior: 50985383!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			self halt.
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:54:06' prior: 50985548!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber asString.
	
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', testObjectsFactory notExpiredCreditCardOwner).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/19/2021 19:59:00' prior: 50985668!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ testObjectsFactory notExpiredMonthOfYear monthName,'%20',testObjectsFactory notExpiredMonthOfYear yearNumber asString.
	
	creditCardOwnerHttpEncoded _ 'Juan%20Perez'.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 19:59:55'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 20:00:11'!
ERROR!

TusLibrosRestAPIInterface allInstances. 
TusLibrosRestAPIInterface allInstancesDo: [:anInstance | anInstance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/19/2021 20:00:40' prior: 50985593!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	webServer startListener.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 20:01:03'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 20:01:03'!
FAILURE!
!TusLibrosRestAPIInterfaceTest methodsFor: 'setup' stamp: 'AF 11/19/2021 20:02:30'!
debit: anAmount from: aCreditCard
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/19/2021 20:02:38'!
PASSED!

----SNAPSHOT----(19 November 2021 20:02:45) CuisUniversity-4972.image priorSource: 20912034!

----SNAPSHOT----(19 November 2021 20:02:52) CuisUniversity-4972.image priorSource: 20934592!

----SNAPSHOT----(19 November 2021 20:03:36) CuisUniversity-4972.image priorSource: 20934686!

----STARTUP---- (20 November 2021 15:42:12) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


----End fileIn of D:\001.Maca\2c2021\inge1\qa3\TusLibros-Model.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qa3\TusLibros-Tests.st----!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'MP 11/20/2021 15:44:59'!
PASSED!

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface do: [:instance | instance destroy].!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!

----SNAPSHOT----(20 November 2021 15:45:41) CuisUniversity-4972.image priorSource: 21019572!

|x| !

|x| 
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = ' ' ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPutAll: a]].
!

'Nov 2021' do: [:a | a = ' ' ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].!

sep _ Character space!

'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].!

|x sep| 
sep _ Character space.
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].
!

'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].!

|x sep| 
sep _ Character space.
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].
x.!

|x sep| 
sep _ Character space.
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].
x asString.!

x _ WriteStream on: OrderedCollection new.!

x print: String.!

x contents.!

|x sep| 
sep _ Character space.
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].
x contents.!

x print.!

String streamContents: x.!

String streamContents: [x].!

x originalContents.!

|x sep| 
sep _ Character space.
x _ WriteStream on: OrderedCollection new.
'Nov 2021' do: [:a | a = sep ifTrue: [x nextPutAll: '%20'] ifFalse: [x nextPut: a]].
x originalContents.!

x contents.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'nil' stamp: 'MP 11/20/2021 16:10:06'!
correctlyEncodeSpacesForUrlRequestParameter: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 16:10:28'!
encodeSpacesForUrl: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #correctlyEncodeSpacesForUrlRequestParameter: stamp: 'MP 11/20/2021 16:11:16'!
correctlyEncodeSpacesForUrlRequestParameter: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:15:05' prior: 50989899!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'MP 11/20/2021 16:15:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'MP 11/20/2021 16:15:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/20/2021 16:15:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'MP 11/20/2021 16:15:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'MP 11/20/2021 16:15:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'MP 11/20/2021 16:15:34'!
PASSED!

----SNAPSHOT----(20 November 2021 16:15:37) CuisUniversity-4972.image priorSource: 21085111!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:16:41'!
test06listPurhcases

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:18:49' prior: 50990700!
test06listPurhcases

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:19:12' prior: 50990748!
test06listPurhcases

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	responseExpected _ 'u'.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:26:57' prior: 50990795!
test06listPurhcases

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice ) equals: (response)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:27:26' prior: 50990842!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice ) equals: (responseDecoded)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:27:42' prior: 50990891!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice ) equals: (responseDecoded at: self validBook)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:27:57' prior: 50990940!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice ) equals: (responseDecoded at: book)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:30:52' prior: 50990989!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: (responseDecoded at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:30:53'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:31:20'!
FAILURE!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:32:06' prior: 50991038!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'list') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:32:07'!
ERROR!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'MP 11/20/2021 16:34:16' prior: 50989082!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'MP 11/20/2021 16:34:50' prior: 50991149!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'MP 11/20/2021 16:35:22'!
jsonResponseForListPurchases: purchasesDictionary

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'list' -> purchasesDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'MP 11/20/2021 16:35:48' prior: 50991326!
jsonResponseForListPurchases: purchasesDictionary

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'purchases' -> purchasesDictionary ; yourself)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:35:52' prior: 50991094!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.
	responseDecoded _ self decodeJsonMapFrom: response.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:36:00'!
ERROR!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!

----SNAPSHOT----(20 November 2021 16:44:48) CuisUniversity-4972.image priorSource: 21089463!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:44:56'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 16:45:36' prior: 50991344!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

TusLibrosRestAPIInterface allInstances.!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!

----SNAPSHOT----(20 November 2021 16:45:52) CuisUniversity-4972.image priorSource: 21111926!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:45:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'MP 11/20/2021 16:45:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'MP 11/20/2021 16:45:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'MP 11/20/2021 16:45:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'MP 11/20/2021 16:45:55'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'MP 11/20/2021 16:45:55'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'MP 11/20/2021 16:45:55'!
PASSED!

----SNAPSHOT----(20 November 2021 16:47:16) CuisUniversity-4972.image priorSource: 21113914!

|server|
server _ StringsServicesRestInterface listeningOn: 8080.
WordsClientWindow open.!

server destroy.!

TusLibrosRestAPIInterface allInstances do: [:instance | instance destroy].!

StringsServicesRestInterface allInstances do: [:i | i destroy]!

Object subclass: #LoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:03:07'!
Object subclass: #LoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!WordsClientWindow methodsFor: 'GUI building' stamp: 'MP 11/20/2021 17:07:23' prior: 50970977!
build1stColumn2ndRow
	| firstColumnLayoutMorphOfSecondRow |
	
	wordsListMorph := PluggableListMorph model: self model listGetter: #words indexGetter: #wordsListIndex indexSetter: #wordsListIndex:.
	wordsListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Results');
	addMorph: wordsListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.
	! !

|server|
server _ StringsServicesRestInterface listeningOn: 8080.
WordsClientWindow open.!

server destroy.!

StringsServicesRestInterface allInstances do: [:i | i destroy]!
!LoginWindow class methodsFor: 'nil' stamp: 'MP 11/20/2021 17:34:15'!
open
	
	^self new initializeWith: 'TusLibros login window'.! !

Panel subclass: #LoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:35:09'!
Panel subclass: #LoginWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Object subclass: #LoginWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #LoginWindowModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:35:47'!
Object subclass: #LoginWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow methodsFor: 'nil' stamp: 'MP 11/20/2021 17:38:47'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #loginButtonPressed send: #authenticate to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:39:07' overrides: 50929028!
defaultExtent

	^ 1035@485
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:39:52' overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 17:45:40'!
startTestServerAndGraphicInterface

	|server client cartId |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 17:45:59' prior: 50991600!
startTestServerAndGraphicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.! !

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:50:43'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:50:38'!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:51:04' prior: 50991590 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	"addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow."! !

!classDefinition: #LoginWindowModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:51:55'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindowModel methodsFor: 'nil' stamp: 'MP 11/20/2021 17:51:54'!
username
	^ username.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:52:27'!
username: aUsername
	username _ aUsername.
	^ true.
	! !

!classDefinition: #LoginWindowModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:53:40'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:53:35' overrides: 16896425!
initialize

	username := ''.
	password := '' "Dont do this at home kids".! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:54:35' prior: 50991625!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:55:06' prior: 50991689!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:55:19' prior: 50991710!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open. !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:55:29' prior: 50991732!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:56:14'!
build2ndRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 17:56:29'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:56:28' prior: 50991776!
build2ndRow
	| firstRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:56:36' prior: 50991806!
build2ndRow
	| firstRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:56:49'!
password
	^ password.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:57:15'!
password: aPassword
	password _ aPassword.
	^ true.
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 17:58:00' prior: 50991647 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.
	"addMorph: self build3rdRow;
	addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:00:05'!
build3rdRow
	| sendRequestButtonMorph thirdRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
 	addMorph: sendRequestButtonMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:00:13' prior: 50991828!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !

!classDefinition: #LoginWindowModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 18:02:38'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username password response'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:02:37'!
authenticate
	|client|
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	client close.! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:02:58'!
response
	^ response.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:03:31' prior: 50991915!
authenticate
	|client|
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	client close.
	
	self triggerEvent: #hola! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:04:56' prior: 50991928!
authenticate
	|client|
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:05:19' prior: 50991569!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:05:39'!
login
! !

LoginWindow open. !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:06:02' prior: 50991860 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:06:20' prior: 50991969 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:06:30' prior: 50991980 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 100;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:06:45' prior: 50991991 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:07:07' prior: 50991754!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:07:13' prior: 50992013!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:07:49' prior: 50992035!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 . 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:07:58' prior: 50992057!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:10:30' prior: 50992002 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:11:40' prior: 50992101 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	minimumExtent;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:12:51' prior: 50992112 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	extent: #minimumExtent;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:13:00' prior: 50992124 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	minimumExtent;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:13:13' prior: 50992136 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	morphExtent: self minimumExtent;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:13:38' prior: 50992147 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:13:55' prior: 50992079!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:14:06' prior: 50991885!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:14:11' prior: 50991870!
build3rdRow
	| sendRequestButtonMorph thirdRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: sendRequestButtonMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:14:41' prior: 50992159 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	"addMorph: self build4rdRow."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:15:18' prior: 50991949!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self minimumExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:15:38' prior: 50992244!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent .
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:15:38' prior: 50992260!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:16:20' prior: 50992215!
build3rdRow
	| errorMessageMorph thirdRowLayoutMorph |
	
	errorMessageMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:16:45' prior: 50992292!
build3rdRow
	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:16:50'!
build4rdRow
	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:16:56' prior: 50992322!
build4rdRow
	| errorMessageMorph thirdRowLayoutMorph |
	
	errorMessageMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'login'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 18:20:48'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph a'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:20:46' prior: 50992337!
build4rdRow
	| thirdRowLayoutMorph |
	
	a := LabelMorph contents: ''.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: a.
	
	^thirdRowLayoutMorph.! !

!classDefinition: #LoginWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 18:20:56'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:20:56' prior: 50992361!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:22:37' prior: 50991964!
login
	errorMessageMorph contents: self model response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'MP 11/20/2021 18:25:32' prior: 50989804!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:25:46' prior: 50991938!
authenticate
	|client notDecodedResponse|
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	response _ (WebUtils jsonMapFrom: (response content) readStream).
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:25:56' prior: 50992426!
authenticate
	|client notDecodedResponse|
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	response _ (WebUtils jsonMapFrom: (notDecodedResponse content) readStream).
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:26:01' prior: 50992440!
authenticate
	|client notDecodedResponse|
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	response _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:26:27' prior: 50992232 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !

LoginWindow open.!

test startTestServerAndGraphicInterface.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:28:09' prior: 50991609!
startTestServerAndGraphicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !

|server test|
test _ TusLibrosRestAPIInterfaceTest new.
server _ test startTestServerAndGraphicInterface.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:29:31' prior: 50991854!
password: aPassword
	password _ aPassword asString.
	^ true.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:29:38' prior: 50991668!
username: aUsername
	username _ aUsername asString.
	^ true.
	! !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:32:45' prior: 50992454!
authenticate
	|client notDecodedResponse|
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	response _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream asString.
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:33:25' prior: 50992507!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorMessage'.
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:34:02' prior: 50992521!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription'.
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:34:53' prior: 50992381!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	color: #red;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:34:58' prior: 50992553!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:35:14' prior: 50992566!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''; color: #red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:36:05' prior: 50992578!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''; color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:37:14' prior: 50992591!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''; color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:38:23' prior: 50992605!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: ''.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:40:17' prior: 50992619!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: FontFamily defaultFamilyName emphasis: 'bold'.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:40:45' prior: 50992633!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: FontFamily defaultFamilyName emphasis: AbstractFont boldCode.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:42:24' prior: 50992648!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: Preferences standardMenuFont emphasis: AbstractFont boldCode.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:43:14' prior: 50992537!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:43:20' prior: 50992680!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [response _ ''].
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:43:30' prior: 50992696!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:43:35' prior: 50992713!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [].
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:43:43' prior: 50992729!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:44:10' prior: 50992745!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [response _ 'Authentication successful'].
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:45:31' prior: 50992761!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:47:36' prior: 50992779!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	self halt.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!

[''] value.!

[test _ ''.] value.!

[test _ 'hola'.] value. !

test2 _ [test _ 'hola'.] value.!

test2 = test.!

test2 _ [test _ 'hola'. 'chau'] value.!

test2 _ [test _ 'hola'. test2 _ 'chau'] value.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:51:25' prior: 50992796!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	response _ respDict at: 'errorDescription' ifAbsent: [''].
	client close.
	
	self triggerEvent: #authenticationResponse! !

[] value.!

----SNAPSHOT----(20 November 2021 18:53:45) CuisUniversity-4972.image priorSource: 21114731!

----SNAPSHOT----(20 November 2021 18:53:49) CuisUniversity-4972.image priorSource: 21157919!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 18:59:51' prior: 50991682 overrides: 16896425!
initialize

	username := ''.
	password := '' "Dont do this at home kids".! !

Panel subclass: #CatalogWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 19:09:11'!
Panel subclass: #CatalogWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!LoginWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:10:19' prior: 50991541!
open
	
	^self new initializeWith: 'TusLibros - login'.! !
!CatalogWindow class methodsFor: 'no messages' stamp: 'MP 11/20/2021 19:10:21'!
open
	
	^self new initializeWith: 'TusLibros - shop'.! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 19:15:38'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'nil' stamp: 'MP 11/20/2021 19:15:27'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:15:48' prior: 50992878!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:16:11' overrides: 50929028!
defaultExtent

	^ 1035@900
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:17:15' prior: 50992307!
build3rdRow
	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'Create Cart'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !

----SNAPSHOT----(20 November 2021 19:34:55) CuisUniversity-4972.image priorSource: 21158013!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:36:27' overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 19:38:56'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'username'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:38:53'!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:39:55'!
openWithUser: aUsername and: aPassword
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:40:10'!
initializeWith: aTitle and: aUsername and: aPassword

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: CatalogWindow #initializeWith: stamp: 'MP 11/20/2021 19:40:15'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 19:40:41'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:40:37' prior: 50992968!
initializeWith: aTitle and: aUsername and: aPassword
	
	username _ aUsername.
	password _ aPassword.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:42:01'!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	username _ aUsername.
	password _ aPassword.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow class methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:42:01' prior: 50992961!
openWithUser: aUsername and: aPassword
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: cartId.! !

!methodRemoval: CatalogWindow #initializeWith:and:and: stamp: 'MP 11/20/2021 19:42:01'!
initializeWith: aTitle and: aUsername and: aPassword
	
	username _ aUsername.
	password _ aPassword.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!

!methodRemoval: CatalogWindow class #open stamp: 'MP 11/20/2021 19:42:18'!
open
	
	^self new initializeWith: 'TusLibros - shop'.!
!CatalogWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:42:38'!
openWithUser: aUsername and: aPassword and: cartId 
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: cartId.! !

!methodRemoval: CatalogWindow class #openWithUser:and: stamp: 'MP 11/20/2021 19:42:38'!
openWithUser: aUsername and: aPassword
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: cartId.!
!CatalogWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:42:47' prior: 50993073!
openWithUser: aUsername and: aPassword and: aCartID 
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: aCartID.! !
!CatalogWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:43:07'!
openWithUser: aUsername andPass: aPassword andCart: aCartID 
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: aCartID.! !

!methodRemoval: CatalogWindow class #openWithUser:and:and: stamp: 'MP 11/20/2021 19:43:07'!
openWithUser: aUsername and: aPassword and: aCartID 
	
	^self basicNew initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: aCartID.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:45:50' prior: 50992820!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = '0' 
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:46:54' prior: 50993112!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = '0' 
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId. 
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:46:56' prior: 50993132!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = '0' 
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:53:14' prior: 50992948!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:54:21' prior: 50992932 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self buildShopHeader.
	"addMorph: self buildShopBody."! !

TusLibrosRestAPIInterface allInstances !

LoginWindow open.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:56:08' prior: 50993154!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !

LoginWindow open.!
!CatalogWindow class methodsFor: 'instance creation' stamp: 'MP 11/20/2021 19:57:41' prior: 50993096!
openWithUser: aUsername andPass: aPassword andCart: aCartID 
	
	^self new initializeWith: 'TusLibros - shop' and: aUsername and: aPassword and: aCartID.! !

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:58:33' prior: 50992910 overrides: 50929028!
defaultExtent

	^ 1035@485
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:59:19' prior: 50993197 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: self buildShopHeader.
	"addMorph: self buildShopBody."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 19:59:31' prior: 50993245 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader.
	"addMorph: self buildShopBody."! !

LoginWindow open.!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 20:00:52) CuisUniversity-4972.image priorSource: 21160886!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:01:11' prior: 50993255 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:01:42'!
buildShopBody
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:02:01' prior: 50993280!
buildShopBody
	| firstRowLayoutMorph catalogMorph |
		
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: catalogMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:02:32' prior: 50993300!
buildShopBody
	| firstRowLayoutMorph catalogMorph buildCartListMorph buildCatalogMorph cartListMorph |
		
	catalogMorph := buildCatalogMorph.
	cartListMorph := buildCartListMorph.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: catalogMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:03:10' prior: 50993320!
buildShopBody
	| firstRowLayoutMorph catalogMorph buildCartListMorph buildCatalogMorph cartListMorph |
		
	catalogMorph := buildCatalogMorph.
	cartListMorph := buildCartListMorph.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: catalogMorph;
	addMorph: cartListMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:03:28' prior: 50993337!
buildShopBody
	| bodyLayoutMorph catalogMorph buildCartListMorph buildCatalogMorph cartListMorph |
		
	catalogMorph := buildCatalogMorph.
	cartListMorph := buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: catalogMorph;
	addMorph: cartListMorph.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:03:40'!
buildCatalogMorph! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:03:54' prior: 50993353!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	cartListMorph := self buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: catalogMorph;
	addMorph: cartListMorph.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:04:14'!
buildCartListMorph
	^ self shouldBeImplemented.! !

----SNAPSHOT----(20 November 2021 20:09:34) CuisUniversity-4972.image priorSource: 21171719!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:16:41' prior: 50993368!
buildCatalogMorph
	
	| catalogMorph p |
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:16:46' prior: 50993394!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:17:25' prior: 50993402!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:17:45' prior: 50993372!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	cartListMorph := self buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:18:14' prior: 50993436!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self minimumExtent;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:19:07' prior: 50993410!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Results');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:22:37' prior: 50993473!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:23:36'!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| catalogMorph itemMorph p |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:23:51' prior: 50993486!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:24:05' prior: 50993499!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| catalogMorph itemMorph p |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:24:19' prior: 50993528!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:25:15' prior: 50993543!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents: aBookName);
	addMorph: (LabelMorph contents: anISBN).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:25:30' prior: 50993556!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0; 
	axisEdgeWeight: 0.0;
	addMorph: (LabelMorph contents: aBookName);
	addMorph: (LabelMorph contents: anISBN).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:26:10' prior: 50993514!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (LabelMorph contents:'Results').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:26:41' prior: 50993587!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader);
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:27:35'!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (LabelMorph contents:'Book name');
	addMorph: (LabelMorph contents:'ISBN').
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:27:51' prior: 50993623!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: (LabelMorph contents:'Book name');
	addMorph: (LabelMorph contents:'ISBN').
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:29:17' prior: 50993456!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.66) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:29:54' prior: 50993176!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.30) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:31:41' prior: 50993670!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.30) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:32:10' prior: 50993605!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: (self buildCatalogListHeader);
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:32:48' prior: 50993716!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader);
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p morphExtent: self defaultExtent;
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:33:06' prior: 50993738!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader);
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:33:21' prior: 50993757!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader);
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:34:06' prior: 50993780!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	
	catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN');
	addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:34:16' prior: 50993803!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	
	catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:34:51' prior: 50993824!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	
	catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:35:39' prior: 50993840!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	[catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').] timesRepeat: 20.
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:39:50' prior: 50993856!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 20:40:11) CuisUniversity-4972.image priorSource: 21175666!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:40:58' prior: 50993573!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (LabelMorph contents: aBookName);
	addMorph: (LabelMorph contents: anISBN).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:41:01' prior: 50993897!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: (LabelMorph contents: aBookName);
	addMorph: (LabelMorph contents: anISBN).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:48:42' prior: 50993637!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.25)@(super morphExtent y) );
	addMorph: (LabelMorph contents:'ISBN').
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:48:49' prior: 50993923!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.25)@(super morphExtent y) );
	addMorph: (LabelMorph contents:'ISBN').
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:49:02' prior: 50993936!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.25)@(super morphExtent y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.25)@(super morphExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:49:22' prior: 50993949!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.5)@(super morphExtent y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.5)@(super morphExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:49:48' prior: 50993967!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (self morphExtentInOwner x*0.5)@(self morphExtentInOwner y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.5)@(super morphExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:50:10' prior: 50993985!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.1)@(super morphExtent y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.1)@(super morphExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:50:19' prior: 50994003!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:50:39' prior: 50993875!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.66);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:50:45' prior: 50994039!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:51:01' prior: 50993694!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.2) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:51:09' prior: 50994076!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:51:26' prior: 50994100!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.2) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow allInstances!

CatalogWindow allInstances do: [:i | i close ]!

CatalogWindow allInstances do: [:i | i delete ]!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 20:52:19) CuisUniversity-4972.image priorSource: 21191775!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:52:23' prior: 50994124!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.2) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:52:31' prior: 50994155!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.2) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:52:53' prior: 50993651!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.80) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:53:05' prior: 50994201!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 1) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:53:17' prior: 50994220!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.66) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:53:29' prior: 50994238!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.66) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:53:51' prior: 50994059!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.80);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:54:04' prior: 50994254!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.80) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:54:20' prior: 50994270!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:54:33' prior: 50994290!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.60) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:54:41' prior: 50994179!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:55:57' prior: 50994345!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:56:31' prior: 50994329!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.60) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:57:14' prior: 50993271 overrides: 50928932!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:57:29' prior: 50994394!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.60) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:57:40' prior: 50994369!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:58:13' prior: 50994441!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.0) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:58:25' prior: 50994466!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.6) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:58:32' prior: 50994491!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'test1');
	addMorph: (LabelMorph contents: 'test2').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

----SNAPSHOT----(20 November 2021 20:58:34) CuisUniversity-4972.image priorSource: 21200021!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 20:59:00' prior: 50994425!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:00:17' prior: 50994516!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:01:03' prior: 50993909!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y) ).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:02:42' prior: 50994309!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').
	
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:02:55' prior: 50994607!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 5; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:03:09' prior: 50994021!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:03:13' prior: 50994646!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:03:18' prior: 50994589!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y) ).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:03:21' prior: 50994676!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 25; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) ).

	^ itemMorph.! !

----SNAPSHOT----(20 November 2021 21:03:26) CuisUniversity-4972.image priorSource: 21212389!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:04:11' prior: 50994661!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@self minimumExtent y);
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:04:42' prior: 50994714!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(self minimumExtent y));
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(self minimumExtent y) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:04:44' prior: 50994732!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(self minimumExtent y) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(self minimumExtent y) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:04:58' prior: 50994747!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:05:07' prior: 50994629!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:05:35' prior: 50994780!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:05:57' prior: 50994799!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogListHeader).].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:06:03' prior: 50994819!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:06:25' prior: 50994692!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.1) ).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:06:42' prior: 50994855!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.01) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.01) ).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:06:57' prior: 50994874!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:aBookName) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.05) );
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.05) ).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:07:06' prior: 50994765!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:07:48' prior: 50994909!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:08:54' prior: 50994927!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: Preferences bigFonts) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:09:58' prior: 50994942!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: Preferences standardFonts ) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:10:26' prior: 50994966!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: Preferences defaultFont22 ) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !

----SNAPSHOT----(20 November 2021 21:10:32) CuisUniversity-4972.image priorSource: 21217804!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:10:56' prior: 50994985!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: Preferences standardFonts ) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:13:39' prior: 50995010!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: FontFamily defaultFamilyName ) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:14:59' prior: 50995029!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: FontFamily defaultFamilyName ) morphWidth: (super morphExtent x*0.2) );
	addMorph: ((LabelMorph contents:'ISBN') morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.06) ).
	^ catalogMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:15:20' prior: 50992664!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: FontFamily defaultFamilyName emphasis: AbstractFont boldCode.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:15:30' prior: 50995046!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: FontFamily defaultFamilyName ) morphWidth: (super morphExtent x*0.2) );
	addMorph: ((LabelMorph contents:'ISBN') morphWidth: (super morphExtent x*0.2)  ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:20:13'!
buildCatalogListItem: aName
	
	| catalogMorph |
	
	catalogMorph := LabelMorph contents: aName font: FontFamily defaultFamilyName.
	catalogMorph morphWidth: (catalogMorph morphExtentInOwner x*0.2).! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:20:19' prior: 50995092!
buildCatalogListItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyName.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.2).! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:20:24' prior: 50995102!
buildCatalogListItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyName.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.2).
	^ itemMorph! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:21:14'!
buildCatalogTableItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyName.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.2).
	^ itemMorph! !

!methodRemoval: CatalogWindow #buildCatalogListItem: stamp: 'MP 11/20/2021 21:21:14'!
buildCatalogListItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyName.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.2).
	^ itemMorph!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:21:42' prior: 50994893!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName);
	addMorph: ((LabelMorph contents:anISBN) morphExtent: (super morphExtent x*0.2)@(super morphExtent y*0.05) ).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:23:05' prior: 50995078!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: ((LabelMorph contents:'Book name' font: FontFamily defaultFamilyAndPointSize ) morphWidth: (super morphExtent x*0.2) );
	addMorph: ((LabelMorph contents:'ISBN') morphWidth: (super morphExtent x*0.2)  ).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:23:12' prior: 50995120!
buildCatalogTableItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.2).
	^ itemMorph! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:23:14' prior: 50995062!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: FontFamily defaultFamilyAndPointSize emphasis: AbstractFont boldCode.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 21:23:23) CuisUniversity-4972.image priorSource: 21227195!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:23:40' prior: 50995138!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName);
	addMorph: (self buildCatalogTableItem: anISBN).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:24:22' prior: 50995154!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name');
	addMorph: (self buildCatalogTableItem: 'ISBN').
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:24:42' prior: 50995169!
buildCatalogTableItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:25:02' prior: 50995228!
buildCatalogTableItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.25).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:26:16' prior: 50994838!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtentInOwner;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:26:42' prior: 50995252!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtentInOwner;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: catalogMorph morphExtentInOwner;
	"p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);"
	scroller: catalogMorph.
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:27:06' prior: 50995273!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtentInOwner;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	^ p.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:27:31' prior: 50995296!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtentInOwner;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:29:49'!
buildCatalogTableItem: aName ownerWidth: aWidth 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.25).
	^ itemMorph! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:29:49' prior: 50995214!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerWidth: item morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerWidth: item morphExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:29:49' prior: 50995200!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerWidth: item morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerWidth: item morphExtent).

	^ itemMorph.! !

!methodRemoval: CatalogWindow #buildCatalogTableItem: stamp: 'MP 11/20/2021 21:29:49'!
buildCatalogTableItem: aName
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (itemMorph morphExtentInOwner x*0.25).
	^ itemMorph!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:30:06' prior: 50995358!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerWidth: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerWidth: itemMorph morphExtent).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:30:17' prior: 50995345!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerWidth: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerWidth: catalogMorph morphExtent).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:30:37' prior: 50995334!
buildCatalogTableItem: aName ownerWidth: aWidth 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (aWidth *0.25).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:31:00'!
buildCatalogTableItem: aName ownerExtent: aWidth 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (aWidth *0.25).
	^ itemMorph! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:31:00' prior: 50995381!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:31:00' prior: 50995395!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: catalogMorph morphExtent).
	^ catalogMorph.! !

!methodRemoval: CatalogWindow #buildCatalogTableItem:ownerWidth: stamp: 'MP 11/20/2021 21:31:00'!
buildCatalogTableItem: aName ownerWidth: aWidth 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (aWidth *0.25).
	^ itemMorph!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:31:06' prior: 50995423!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.25).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 21:32:09) CuisUniversity-4972.image priorSource: 21233472!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:32:50' prior: 50995314!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN').].
	
	^ p.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:33:25'!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:33:25' prior: 50995485!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: morphExtent).].
	
	^ p.! !

!methodRemoval: CatalogWindow #buildCatalogItemMorphWithName:withISBN: stamp: 'MP 11/20/2021 21:33:25'!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	^ itemMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:33:33' prior: 50995518!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: p morphExtent).].
	
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:34:13' prior: 50995503!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphExtent: anExtent; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:34:32' prior: 50995573!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:35:13'!
buildCatalogListHeader: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: catalogMorph morphExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:35:13' prior: 50995551!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeader: morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: p morphExtent).].
	
	^ p.! !

!methodRemoval: CatalogWindow #buildCatalogListHeader stamp: 'MP 11/20/2021 21:35:13'!
buildCatalogListHeader
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: catalogMorph morphExtent).
	^ catalogMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:35:25'!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: catalogMorph morphExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 21:35:25' prior: 50995620!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: p morphExtent).].
	
	^ p.! !

!methodRemoval: CatalogWindow #buildCatalogListHeader: stamp: 'MP 11/20/2021 21:35:25'!
buildCatalogListHeader: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: catalogMorph morphExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: catalogMorph morphExtent).
	^ catalogMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:35:36' prior: 50995652!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: anExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:35:55' prior: 50995667!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: p morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: p morphExtent).].
	
	^ p.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 21:36:00) CuisUniversity-4972.image priorSource: 21242603!

----STARTUP---- (20 November 2021 22:02:08) as D:\001.Maca\2c2021\inge1\qa3\CuisUniversity-4972.image!


CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:17:50'!
buildCounterMorph
! !

|s|
s _ String new.
s setValue: '90'.
s value.!

!classDefinition: #ItemCounter category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 22:25:34'!
Object subclass: #ItemCounter
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 22:25:28' prior: 50995470!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph string |
	
	string _ String new.  
	itemMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:. 
	itemMorph morphWidth: (anExtent x *0.25).
	^ itemMorph! !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 22:25:43' prior: 50995757!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:. 
	itemMorph morphWidth: (anExtent x *0.25).
	^ itemMorph! !

!classDefinition: #ItemCounter category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 22:26:08'!
Object subclass: #ItemCounter
	instanceVariableNames: 'value'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!ItemCounter methodsFor: 'no messages' stamp: 'MP 11/20/2021 22:26:07' overrides: 16896425!
initialize
	value _ 0! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:26:15' overrides: 16881508!
value
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:30:29'!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num. 
	] onError: [^ value].
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:31:15' prior: 50995794!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num. 
	] on: Error do: [^ value].
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:31:26' prior: 50995801!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num. 
	] on: Error do: [].
	^ value.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:32:53' prior: 50995744!
buildCounterMorph
	| numberInputMorph |
	numberInputMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:.
	 ! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:34:33' prior: 50995815!
buildCounterMorph
	| numberInputMorph counterMorph |
	
	numberInputMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@50.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:34:40' prior: 50995823!
buildCounterMorph
	| numberInputMorph counterMorph |
	
	numberInputMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@50.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:34:41' prior: 50995836!
buildCounterMorph
	| numberInputMorph counterMorph |
	
	numberInputMorph := TextModelMorph textProvider: ItemCounter new textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@50.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:36:49' prior: 50995850!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounter new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@50.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 50@25. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 50@25.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:37:14'!
valueUp
	value _ value +1.
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:37:20'!
valueDown
	value _ value -1.
	^ value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 21:31:06' prior: 50995768!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.25).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'catalog' stamp: 'MP 11/20/2021 22:39:13' prior: 50995588!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:47:15' prior: 50995786 overrides: 16896425!
initialize
	value _ '0'! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:47:30' prior: 50995891!
valueDown
	value _ value asNumber asInteger -1.
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:47:39' prior: 50995941!
valueDown
	value _ (value asNumber asInteger -1) asString.
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:47:48' prior: 50995887!
valueUp
	value _ (value asNumber asInteger -1) asString..
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:47:49' prior: 50995952!
valueUp
	value _ (value asNumber asInteger -1) asString.
	^ value.! !
!ItemCounter methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:48:00' prior: 50995808!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
	] on: Error do: [].
	^ value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

!classRenamed: #ItemCounter as: #ItemCounterModel stamp: 'MP 11/20/2021 22:48:24'!
Smalltalk renameClassNamed: #ItemCounter as: #ItemCounterModel!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:48:24' prior: 50995864!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@50.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 50@25. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 50@25.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:48:48' prior: 50995979!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:49:36' prior: 50996003!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20; axisEdgeWeight: 0.5.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:50:24' prior: 50996029!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:50:38' prior: 50996056!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: 'hola'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'chau'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:50:49' prior: 50996080!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:51:04' prior: 50996106!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowUp;
	addMorph: arrowDown.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:51:27' prior: 50996130!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowUp;
	addMorph: arrowDown.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:52:28' prior: 50996157!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowUp;
	addMorph: arrowDown.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:52:35' prior: 50996182!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:56:13' prior: 50995964!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
		self triggerEvent: #updateCounter.
	] on: Error do: [].
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:56:25' prior: 50996244!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
		self triggerEvent: #updateCounter with: self.
	] on: Error do: [].
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:56:48' prior: 50995946!
valueDown
	value _ (value asNumber asInteger -1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 22:56:52' prior: 50995958!
valueUp
	value _ (value asNumber asInteger -1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:57:42' prior: 50996212!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter to: self.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:58:14' prior: 50996276!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 22:59:26' prior: 50996307!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter to: self with: numberInputMorph.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:03:07' prior: 50996338!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter to: self with: (OrderedCollection new with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:03:27' prior: 50996370!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self with: (OrderedCollection new with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:03:53'!
updateCounter: aTextMorph and: aCounter
	^ aTextMorph text: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 23:04:15) CuisUniversity-4972.image priorSource: 21250693!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:04:26' prior: 50996403!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self with: (OrderedCollection with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:06:27' prior: 50996447!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self with: (OrderedCollection with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:08:57' prior: 50996483!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph |
	
	counter _ ItemCounterModel new.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self withArguments: (Array with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 23:12:22'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'username password counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:12:19' prior: 50996516!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self withArguments: (Array with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!ItemCounterModel class methodsFor: 'no messages' stamp: 'MP 11/20/2021 23:12:48'!
newWith: counterId
	^ self new initializeWith: counterId.! !

!classDefinition: #ItemCounterModel category: 'TusLibros-Graphics' stamp: 'MP 11/20/2021 23:13:04'!
Object subclass: #ItemCounterModel
	instanceVariableNames: 'value id'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 23:13:03'!
initializeWith: counterId
	value _ '0'.
	id _ counterId.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:14:03' prior: 50996560!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self withArguments: (Array with: numberInputMorph with: counter).
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 23:14:22' prior: 50993025!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	username _ aUsername.
	password _ aPassword.
	counters _ OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:14:50' prior: 50996613!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:and: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:15:12' prior: 50996669!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:15:30'!
updateCounter: aCounter
	^ counters at: aCounter .! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 23:15:50'!
id
	^ id! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:16:08' prior: 50996737!
updateCounter: aCounter
	^ counters at: aCounter id .! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:16:13' prior: 50996703!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:16:31' prior: 50996746!
updateCounter: aCounter
	^ (counters at: aCounter id) text: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'MP 11/20/2021 23:17:28' prior: 50996269!
valueUp
	value _ (value asNumber asInteger +1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:19:22' prior: 50996785!
updateCounter: aCounter
	^ (counters at: aCounter id) update: #ActualContents.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:27:39' prior: 50996801!
updateCounter: aCounter
	^ (counters at: aCounter id) contents: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:30:50' prior: 50996809!
updateCounter: aCounter
	^ (counters at: aCounter id) editLabel: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:31:39' prior: 50996817!
updateCounter: aCounter

	^ (counters at: aCounter id) editLabel: aCounter value.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:32:17' prior: 50996751!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: '^'.
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: 'v'.
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:32:36' prior: 50996826!
updateCounter: aCounter

	^ (counters at: aCounter id) innerTextMorph contents: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:33:55' prior: 50996866!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromContents.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:34:50' prior: 50996875!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromTextComposition .! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:35:03' prior: 50996889!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromContents.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:35:14' prior: 50996900!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	self halt.
	^ (counters at: aCounter id) innerTextMorph updateFromContents.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:35:46' prior: 50996911!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:36:12' prior: 50996922!
updateCounter: aCounter

	^ (counters at: aCounter id) innerTextMorph contents: aCounter value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:36:36' prior: 50996932!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromContents .
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 23:36:50) CuisUniversity-4972.image priorSource: 21273379!

!methodRemoval: CatalogWindow #updateCounter:and: stamp: 'MP 11/20/2021 23:38:40'!
updateCounter: aTextMorph and: aCounter
	^ aTextMorph text: aCounter value.!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:38:48' prior: 50996941!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromTextComposition.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:40:51' prior: 50996960!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph textComposition: aCounter value.
	^ (counters at: aCounter id) innerTextMorph updateFromTextComposition .
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'MP 11/20/2021 23:41:29' prior: 50996971!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition .
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: '1' !

----SNAPSHOT----(20 November 2021 23:43:16) CuisUniversity-4972.image priorSource: 21289625!

----STARTUP---- (26 November 2021 19:08:22) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Model.st----!

----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Tests.st----!

----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Graphics.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/26/2021 19:08:54'!
PASSED!

----SNAPSHOT----(26 November 2021 19:08:58) CuisUniversity-4972.image priorSource: 20682207!
!TusLibrosRestAPIInterfaceTest methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:14:56' prior: 50979514!
startTestServerAndGraphicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !

LoginWindow open!

CatalogWindow open!

CatalogWindow openWithUser: 'validUser' andPass: 'validUserPassword' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:27:34' prior: 50980197!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: Character arrowUp .
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: Character arrowDown .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:34:37' prior: 50980777!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp ).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:34:58' prior: 50980816!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:13' prior: 50980519!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
		self triggerEvent: #updateCounter with: self.
	] on: Error do: [].
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:28' prior: 50980505 overrides: 16896425!
initialize

	value _ '0'! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:34' prior: 50980509!
initializeWith: counterId
	value _ '0'.
	id _ counterId.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:35' prior: 50980909!
initializeWith: counterId

	value _ '0'.
	id _ counterId.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:42' prior: 50980501!
id

	^ id! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:50' prior: 50980515 overrides: 16881508!
value

	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:41:56' prior: 50980895!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
		self triggerEvent: #updateCounter with: self.
	] on: Error do: [].
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:42:01' prior: 50980535!
valueUp

	value _ (value asNumber asInteger +1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:42:06' prior: 50980528!
valueDown
	value _ (value asNumber asInteger -1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:42:07' prior: 50980946!
valueDown

	value _ (value asNumber asInteger -1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:03' prior: 50980299!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	username _ aUsername.
	password _ aPassword.
	counters _ OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:11' prior: 50980295 overrides: 50965689!
defaultExtent

	^ 1035@485
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:17' prior: 50980271!
buildShopHeader
	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:19' prior: 50980985!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:24' prior: 50980255!
buildShopBody
	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:31' prior: 50981031!
buildShopBody

	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:49' prior: 50980246 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 25;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:43:54' prior: 50980241!
buildCartListMorph

	^ self shouldBeImplemented.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:45:06' prior: 50980855!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:45:44' prior: 50980232!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^ (counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition .
	! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/26/2021 19:46:01' prior: 50981114!
updateCounter: aCounter

	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition .
	! !

'1' asInteger!

'1' - '1'!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:53:34' prior: 50980953!
valueDown

	|newValue|

	value _ (value asNumber asInteger -1) asString.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:53:48' prior: 50981134!
valueDown

	|newValue|

	newValue _ value asNumber asInteger -1.
	self triggerEvent: #updateCounter with: self.
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:55:44' prior: 50981142!
valueDown

	|newValue|

	newValue _ value asNumber asInteger -1.
	newValue > 0 ifTrue: [value _ newValue.
					  self triggerEvent: #updateCounter with: self.].
	
	^ value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:56:07' prior: 50981150!
valueDown

	|newValue|

	newValue _ value asNumber asInteger -1.
	newValue > 0 ifTrue: [value _ newValue asString.
					  self triggerEvent: #updateCounter with: self.].
	
	^ value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/26/2021 19:56:24' prior: 50981162!
valueDown

	|newValue|

	newValue _ value asNumber asInteger -1.
	newValue >= 0 ifTrue: [value _ newValue asString.
					  self triggerEvent: #updateCounter with: self.].
	
	^ value.! !

CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!

----SNAPSHOT----(26 November 2021 20:26:00) CuisUniversity-4972.image priorSource: 20771478!

----STARTUP---- (27 November 2021 11:20:21) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


CatalogWindow openWithUser: 'validUser' andPass: 'validPassword' andCart: 1!

|server|
server _ TusLibrosRestAPIInterfaceTest  startTestServerAndGraphicInterface.!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:04' prior: 50980570!
authenticate
	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:06' prior: 50981208!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:23' prior: 50980350!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:29' prior: 50980373!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:35' prior: 50980396!
build3rdRow
	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'Create Cart'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:40' prior: 50980411!
build4rdRow
	| thirdRowLayoutMorph |
	
	errorMessageMorph := LabelMorph contents: '' font: FontFamily defaultFamilyAndPointSize emphasis: AbstractFont boldCode.
	errorMessageMorph color: Color red.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: errorMessageMorph.
	
	^thirdRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:44' prior: 50980427 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:47' prior: 50980438 overrides: 50965689!
defaultExtent

	^ 1035@485
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:52' prior: 50980442!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:34:56' prior: 50980458!
login
	errorMessageMorph contents: self model response.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:35:45' prior: 50980138!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:35:52' prior: 50980154!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: anExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:38:07' prior: 50980187!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.25).
	^ itemMorph! !

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:41:22' prior: 50980167!
buildCatalogMorph
	
	| catalogMorph p |
	
	catalogMorph := LayoutMorph newColumn.
	p := PluggableScrollPane new.
	p morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: p morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: p morphExtent).].
	
	^ p.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:41:46' prior: 50981416!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemMorphWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:45:02'!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 11:45:03' prior: 50981436!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.60);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

!methodRemoval: CatalogWindow #buildCatalogItemMorphWithName:withISBN:withExtent: stamp: 'AF 11/27/2021 11:45:03'!
buildCatalogItemMorphWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	^ itemMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 11:45:39' prior: 50981457!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:02:11' prior: 50981078!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.1;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:12:48' prior: 50981123!
updateCounter: aCounter

	^(counters at: aCounter id) innerTextMorph acceptContents.

"	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

!methodRemoval: ItemCounterModel #initialize stamp: 'AF 11/27/2021 12:16:23'!
initialize

	value _ '0'!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:21:11' prior: 50981174!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [value _ newValue asString.
					  self triggerEvent: #updateCounter with: self.].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:21:36' prior: 50981605!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [self value: newValue asString.
					    "self triggerEvent: #updateCounter with: self".].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:22:28' prior: 50980939!
valueUp

	self value: (self value asNumber asInteger +1) asString.
	self triggerEvent: #updateCounter with: self.
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:22:33' prior: 50981624!
valueUp

	self value: (self value asNumber asInteger +1) asString.
	"self triggerEvent: #updateCounter with: self."
! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:23:26' prior: 50981614!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [self value: newValue asString.
					    "self triggerEvent: #updateCounter with: self"].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:23:31' prior: 50981641!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [self value: newValue asString.
					    self triggerEvent: #updateCounter with: self].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:23:38' prior: 50981631!
valueUp

	self value: (self value asNumber asInteger +1) asString.
	self triggerEvent: #updateCounter with: self.
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:23:53' prior: 50980930!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
	] on: Error do: [].
	^ value.! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:24:09' prior: 50981667!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		value _ num asString. 
	] on: Error do: [].! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:30:22' prior: 50981586!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph hasUnacceptedEdits: true.
	^textMorph acceptContents.
	

"	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:31:14' prior: 50981683!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	

"	(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:31:39' prior: 50981699!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	

	"(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:33:32' prior: 50981717!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	

	"(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:34:55' prior: 50981735!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	

	"(counters at: aCounter id) innerTextMorph contents: aCounter value.
	^(counters at: aCounter id) innerTextMorph resetTextComposition; updateFromTextComposition ."
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 12:35:52' prior: 50981753!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:37:07' prior: 50981275!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:37:33' prior: 50981784!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:43:02' prior: 50981329 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:44:17'!
build1stRow: anExtent
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: anExtent y * 0.25;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:45:15' prior: 50981843 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: (self build1stRow: self defaultExtent);
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:45:58' prior: 50981853!
build1stRow: anExtent
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: anExtent y * 3;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:47:00' prior: 50981896!
build1stRow: anExtent
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphHeight: anExtent y * 0.25;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 12:47:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/27/2021 12:47:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/27/2021 12:47:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/27/2021 12:47:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/27/2021 12:47:03'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 12:47:03'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 12:47:03'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 12:47:06'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/27/2021 12:47:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/27/2021 12:47:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/27/2021 12:47:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/27/2021 12:47:06'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 12:47:06'!
FAILURE!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:47:25' prior: 50981931!
build1stRow: anExtent
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphHeight: anExtent y * 5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!methodRemoval: LoginWindow #build1stRow: stamp: 'AF 11/27/2021 12:47:46'!
build1stRow: anExtent
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphHeight: anExtent y * 5;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:47:56' prior: 50981877 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:49:33' prior: 50981341 overrides: 50965689!
defaultExtent

	^ 500@485
	! !

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:50:14' prior: 50982064 overrides: 50965689!
defaultExtent

	^ 1035@485
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:50:50'!
build1stRow1rstCollumn
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 12:51:12'!
build1stRow1rstColumn
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

!methodRemoval: LoginWindow #build1stRow1rstCollumn stamp: 'AF 11/27/2021 12:51:12'!
build1stRow1rstCollumn
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:00:20' prior: 50982101!
build1stRow1rstColumn
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newColumn .
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:00:44' prior: 50982146!
build1stRow1rstColumn
	| firstRowLayoutMorph |
		
	firstRowLayoutMorph := LayoutMorph newColumn .
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:01:05' prior: 50982052 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: self build3rdRow;
	"addMorph: self build1stRow;
	addMorph: self build2ndRow;"
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:01:14' prior: 50982182 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: self build1stRow1rstColumn ;
	"addMorph: self build1stRow;
	addMorph: self build2ndRow;"
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:03:54' prior: 50982169!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 25;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !

LoginWindow open.!

LoginWindow open.!

LoginWindow open.!

----SNAPSHOT----(27 November 2021 13:05:18) CuisUniversity-4972.image priorSource: 20785095!

LoginWindow open.!
!LoginWindow class methodsFor: 'instance creation' stamp: 'AF 11/27/2021 13:05:38' prior: 50980471!
open
	
	^self new initializeWith: 'TusLibros - login'.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:17:59' prior: 50982215!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:18:26' prior: 50981252!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:18:33' prior: 50982251!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:18:48' prior: 50982238!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 50;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !

LoginWindow open.!

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:20:21' prior: 50982297!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:21:13' prior: 50982274!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 1035@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:21:34' prior: 50981812!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 1035@1;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:21:49' prior: 50982347!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 1035@1;
	addMorph: (LabelMorph contents:'Password: ');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:22:06' prior: 50982371!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Password: ');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:22:12' prior: 50982324!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:22:41' prior: 50982074 overrides: 50965689!
defaultExtent

	^ 475@485
	! !

LoginWindow open.!

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:24:40' prior: 50982417!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:24:44' prior: 50982394!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Password: ');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:25:07' prior: 50982468!
build2ndRow
	| secondRowLayoutMorph |
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Password: ');
	addMorph: passwordTextBoxMorph.
	
	^secondRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:25:14' prior: 50982446!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:25:23' prior: 50982311!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 1;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:25:45' prior: 50982537!
build1stRow1rstColumn
	| firstRowsFirstColumn |
		
	firstRowsFirstColumn := LayoutMorph newColumn .
	firstRowsFirstColumn separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self minimumExtent;
	addMorph: self build1stRow ;
	addMorph: self build2ndRow .
	
	^firstRowsFirstColumn.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:26:17' prior: 50982195 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0.5;
	morphExtent: self defaultExtent ;
	addMorph: self build1stRow1rstColumn ;
	"addMorph: self build1stRow;
	addMorph: self build2ndRow;"
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:26:42' prior: 50982563 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1;
	axisEdgeWeight: 0;
	morphExtent: self defaultExtent ;
	addMorph: self build1stRow1rstColumn ;
	"addMorph: self build1stRow;
	addMorph: self build2ndRow;"
	addMorph: self build3rdRow;
	addMorph: self build4rdRow.! !

LoginWindow open.!

LoginWindow open.!

LoginWindow open.!

----SNAPSHOT----(27 November 2021 13:34:26) CuisUniversity-4972.image priorSource: 20818484!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 13:41:17' prior: 50981047!
buildShopBody

	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	cartListMorph := self buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph;
	addMorph: cartListMorph.
	
	^bodyLayoutMorph.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/27/2021 13:49:11' prior: 50978828!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/27/2021 13:49:17' prior: 50978842!
createCartFor: aUser authenticatedWith: aPassword

	^ self if: aUser authenticatesWith: aPassword do: [ | cartId cartSession |

		cartId := self generateCartId.
		cartSession := CartSession ownedBy: aUser with: (Cart acceptingItemsOf: catalog) on: self..
		cartSessions at: cartId put: cartSession.

		cartId  ]! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/27/2021 13:49:21' prior: 50982612!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/27/2021 13:49:53' prior: 50978863!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'AF 11/27/2021 13:50:04' prior: 50978885!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]! !
!LineItem methodsFor: 'initialization' stamp: 'AF 11/27/2021 13:57:01' prior: 50978387!
initializeOf: anItem quantity: aQuantity total: aTotal

	item := anItem.
	quantity := aQuantity.
	total := aTotal

! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/27/2021 14:00:31' prior: 50978547!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosSystemFacade methodsFor: 'cart session management' stamp: 'AF 11/27/2021 14:02:19' prior: 50978811!
withCartSessionIdentifiedAs: aCartId do: aBlock

	| cartSession |

	cartSession := cartSessions at: aCartId ifAbsent: [self signalInvalidCartId ].
	^cartSession do: aBlock
! !

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/27/2021 14:04:53' prior: 50982640!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession | cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear ]
! !
!CartSession methodsFor: 'cart' stamp: 'AF 11/27/2021 14:05:23' prior: 50978151!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!CartSession methodsFor: 'cart' stamp: 'AF 11/27/2021 14:20:35' prior: 50982805!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	^(Cashier
		toCheckout: cart
		ownedBy: owner
		charging: (CreditCard expiringOn: anExpirationMonthOfYear)
		throught: systemFacade merchantProcessor
		on: self today
		registeringOn: systemFacade salesBook) checkOut ! !
!Cashier methodsFor: 'checkout' stamp: 'AF 11/27/2021 14:23:18' prior: 50978234!
checkOut

	self createTicket.
	self debitTotal.
	self registerSale.

	^ ticket ! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 14:46:26' prior: 50981474!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.6);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 14:46:46' prior: 50982837!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.6);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 14:55:00' prior: 50982858!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.6);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: catalogMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 14:55:28' prior: 50982596!
buildShopBody

	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph;
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 14:55:48' prior: 50982904!
buildShopBody

	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph.
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:06:08' prior: 50982880!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.6);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: scrollMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:17:36' prior: 50982922!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListMorph |
		
	catalogColumn := self buildCatalogColumn.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn .
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:19:18'!
buildCatalogColumn

	| bodyLayoutMorph catalogColumn cartListMorph |
		
	catalogColumn := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn .
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:19:48' prior: 50982978!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph cartListMorph |
		
	catalogMorph := self buildCatalogMorph.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:20:24' prior: 50982994!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:20:59' prior: 50983010!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:22:49' prior: 50982940!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.6)@(self defaultExtent y * 0.6);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: scrollMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:23:02' prior: 50983036!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.6)@(self defaultExtent y * 0.5);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: scrollMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:24:27' prior: 50981396!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.33).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:30:33' prior: 50983058!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.5);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	morphExtent: scrollMorph morphExtent;
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 15:33:46' prior: 50981531!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:35:31' prior: 50983094!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.5);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:38:20' prior: 50983158!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:38:48' prior: 50983183!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 0; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:39:10' prior: 50983206!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.69);
	scroller: catalogMorph.
	
	catalogMorph separation: 0; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:39:21' prior: 50983229!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 0; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:39:32' prior: 50983252!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 0.001; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:40:18' prior: 50981008!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 10;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:44:11' prior: 50983295!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 10;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history'; separation: 50);
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:45:33' prior: 50983320!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 10;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:46:08' prior: 50983344!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:46:26' prior: 50983367!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.1) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:47:33' prior: 50983392!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:47:40' prior: 50983418!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 0@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:48:39' prior: 50982962!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListMorph |
		
	catalogColumn := self buildCatalogColumn.
	"cartListMorph := self buildCartListMorph."
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn .
	"addMorph: cartListMorph."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:49:28' prior: 50983441!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x*0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 0@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:49:46' prior: 50983485!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 0@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:49:58' prior: 50983467!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListMorph |
		
	catalogColumn := self buildCatalogColumn.
	cartListMorph := self buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListMorph.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:50:16' prior: 50983531!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListMorph.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:50:23' prior: 50983547!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:51:25'!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorph.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:52:00' prior: 50983578!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorph.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:52:28' prior: 50983591!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorph.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:52:37' prior: 50983023!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:52:55' prior: 50983605!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorph.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:54:35' prior: 50981073!
buildCartListMorph

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.45)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:54:43' prior: 50983646!
buildCartListMorph

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:55:03' prior: 50983272!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.6)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 0.001; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 15:55:10' prior: 50983688!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.6)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:56:48' prior: 50981064 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@25;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:57:16' prior: 50983732 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 10@10;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:57:52' prior: 50983508!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:58:18' prior: 50983756!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:58:32' prior: 50983782!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 10@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:59:18' prior: 50983808!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 15:59:34' prior: 50980980 overrides: 50965689!
defaultExtent

	^ 1535@685
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:00:21' prior: 50983834!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(50) ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:00:26' prior: 50983865!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.05) ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@50 ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:00:45' prior: 50983888!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@50 ;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@50 ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:01:07' prior: 50983913!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@20;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@20 ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:01:42' prior: 50983937!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.6)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:02:16' prior: 50983961!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph: (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:04:10' prior: 50983983!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph headerWelcome |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	headerWelcome _ LabelMorph contents:'Welcome, ',username,'!!'.
	headerWelcome separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@5.
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph: headerWelcome;
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:06:02' prior: 50984005!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:09:29' prior: 50984033!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 1@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:09:54' prior: 50984057!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:10:33' prior: 50984082!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@5 ;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:11:19' prior: 50983744 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 10@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:11:31' prior: 50984131 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 10@100;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:11:43' prior: 50984143 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 10@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:11:46' prior: 50984155 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:11:51' prior: 50984165 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:15:00' prior: 50981513!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:15:09' prior: 50981383!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: anExtent).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:16:34' prior: 50984106!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:17:36' prior: 50984175 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody;
	addMorph: self buildShopFooter.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:17:47'!
buildShopFooter

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@5;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:18:36' prior: 50984255!
buildShopFooter

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@1;
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1;
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:19:04' prior: 50984277!
buildShopFooter

	| firstRowLayoutMorph headerButtonsMorph |
		
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:20:14' prior: 50984245 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody;
	addMorph: self buildShopFooter;
	addMorph: self buildShopFooter.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:20:51' prior: 50984313 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody;
	addMorph: self buildShopFooter.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:21:12' prior: 50984327 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

!methodRemoval: CatalogWindow #buildShopFooter stamp: 'AF 11/27/2021 16:21:15'!
buildShopFooter

	| firstRowLayoutMorph headerButtonsMorph |
		
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1.
	
	^firstRowLayoutMorph.!

----SNAPSHOT----(27 November 2021 16:21:19) CuisUniversity-4972.image priorSource: 20830069!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:21:45' prior: 50983618!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:22:14' prior: 50984360!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:22:32' prior: 50984376!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:22:45' prior: 50983708!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.5)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:24:26'!
buildCatalogMorph: anExtend
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.5)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:24:26' prior: 50984392!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorph: extend.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildCatalogMorph stamp: 'AF 11/27/2021 16:24:26'!
buildCatalogMorph
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.5)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:24:46'!
buildCatalogMorphWith: anExtend
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.5)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:24:46' prior: 50984448!
buildCatalogColumn

	| bodyLayoutMorph catalogMorph  |
		
	catalogMorph := self buildCatalogMorphWith: extend.
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: catalogMorph .

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildCatalogMorph: stamp: 'AF 11/27/2021 16:24:46'!
buildCatalogMorph: anExtend
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.5)@(self defaultExtent y * 0.7);
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:25:40' prior: 50984502!
buildCatalogColumn

	| bodyLayoutMorph   |
		
	
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: self buildCatalogMorphWith: bodyLayoutMorph extent.

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:25:51' prior: 50984536!
buildCatalogColumn

	| bodyLayoutMorph   |
		
	
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph extent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:26:01' prior: 50984549!
buildCatalogColumn

	| bodyLayoutMorph   |

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph extent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:26:20' prior: 50984481!
buildCatalogMorphWith: anExtend
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtend;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:26:24' prior: 50984575!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	20 timesRepeat: [catalogMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 16:27:23' prior: 50984562!
buildCatalogColumn

	| bodyLayoutMorph   |

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

----SNAPSHOT----(27 November 2021 16:27:58) CuisUniversity-4972.image priorSource: 20886588!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:31:19' prior: 50983667!
buildCartListMorph

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:31:44'!
buildCartListMorphWith

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:31:44' prior: 50983632!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorphWith.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildCartListMorph stamp: 'AF 11/27/2021 16:31:44'!
buildCartListMorph

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:32:16'!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:32:16' prior: 50984674!
buildCartListColumn

	| bodyLayoutMorph cartListMorph  |
		
	cartListMorph := self buildCartListMorphWith: extent.

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: cartListMorph .

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildCartListMorphWith stamp: 'AF 11/27/2021 16:32:16'!
buildCartListMorphWith

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (self defaultExtent x *  0.4)@(self defaultExtent y * 0.7);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:32:31' prior: 50984707!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:33:05' prior: 50984728!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph:  (self buildCartListMorphWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:38:21' prior: 50983858 overrides: 50965689!
defaultExtent

	^ 1335@685
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:42:39' prior: 50983563!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:44:22' prior: 50984805!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:44:58' prior: 50984823!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@25;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:46:56' prior: 50984841!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

----SNAPSHOT----(27 November 2021 16:52:20) CuisUniversity-4972.image priorSource: 20895326!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 16:54:53' prior: 50984338 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	color: Color gray;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

WordsClientWindow open!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:01:18' prior: 50984879 overrides: 50965593!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: self defaultExtent;
	addMorph: self buildShopHeader;
	addMorph: self buildShopBody.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:01:42' prior: 50980960!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	username _ aUsername.
	password _ aPassword.
	counters _ OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self color: Color gray.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:02:06' prior: 50984859!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	"addMorph: cartListColumn."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:02:21' prior: 50984928!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn.
	"addMorph: cartListColumn."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:03:04' prior: 50984946!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	color: Color gray;
	addMorph: catalogColumn.
	"addMorph: cartListColumn."
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:03:39' prior: 50984615!
buildCatalogColumn

	| bodyLayoutMorph   |

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	color: Color gray;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:04:05' prior: 50984983!
buildCatalogColumn

	| bodyLayoutMorph   |

	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:04:17' prior: 50984905!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	username _ aUsername.
	password _ aPassword.
	counters _ OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:09:36' prior: 50984964!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	color: Color gray;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:09:40' prior: 50985032!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.70) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:14:33'!
buildCheckoutRow
	| loginButtonMorph thirdRowLayoutMorph |
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'Create Cart'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: loginButtonMorph.
	
	^thirdRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:14:49' prior: 50985065!
buildCheckoutRow
	| checkoutButton thirdRowLayoutMorph |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #authenticate  label: 'Create Cart'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^thirdRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:20:08' prior: 50985080!
buildCheckoutRow
	| checkoutButton thirdRowLayoutMorph |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^thirdRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:21:38' prior: 50985095!
buildCheckoutRow
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^checkoutRow.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:22:12'!
buildCheckoutRowWith
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^checkoutRow.! !

!methodRemoval: CatalogWindow #buildCheckoutRow stamp: 'AF 11/27/2021 17:22:12'!
buildCheckoutRow
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^checkoutRow.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:22:29'!
buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^checkoutRow.! !

!methodRemoval: CatalogWindow #buildCheckoutRowWith stamp: 'AF 11/27/2021 17:22:29'!
buildCheckoutRowWith
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: self minimumExtent;
 	addMorph: checkoutButton.
	
	^checkoutRow.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:24:03' prior: 50985149!
buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:24:12' prior: 50985176!
buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: nil  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:25:06' prior: 50984782!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCartListMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent)

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:25:19' prior: 50985206!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCartListMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:27:11' prior: 50984220!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.2);
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.2);
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:27:51' prior: 50985049!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:28:32' prior: 50985224!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y) ;
	addMorph: (self buildCartListMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:28:48' prior: 50985286!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCartListMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:30:06' prior: 50985242!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.3);
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3);
	addMorph:  (LabelMorph contents:'Welcome, ',username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:30:15' prior: 50985268!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.7) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:33:24' prior: 50984762!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y * 0.5);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:33:44' prior: 50985359!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y * 0.8);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:34:20' prior: 50985343!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.9) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:35:16' prior: 50985405!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.9) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:35:31' prior: 50985423!
buildShopBody

	| bodyLayoutMorph catalogColumn cartListColumn |
		
	catalogColumn := self buildCatalogColumn.
	cartListColumn := self buildCartListColumn.
		
	bodyLayoutMorph := LayoutMorph newRow.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.9) ;
	addMorph: catalogColumn;
	addMorph: cartListColumn.
	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:36:37' prior: 50985382!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCatalogItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:41:42' prior: 50985457!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:42:32'!
buildCartItemRowWithName: aName withISBN: anISBN withExtent: anExtent
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:43:47' prior: 50985502!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:43:57' prior: 50985508!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:44:16' prior: 50984999!
buildCatalogColumn

    | bodyLayoutMorph |

    bodyLayoutMorph := LayoutMorph newColumn.
    bodyLayoutMorph separation: 1@1;
    axisEdgeWeight: 0.0;
    morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
    addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
    addMorph: (self buildAddToCartRowWith: bodyLayoutMorph morphExtent).

    
    ^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:44:23'!
buildAddToCartRowWith: anExtent

    | checkoutButton checkoutRow |
    
        checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add to cart'.

        checkoutRow := LayoutMorph newRow.
        checkoutRow separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
         addMorph: checkoutButton.

        ^checkoutRow.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:45:08' prior: 50985544!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildAddToCartRowWith: bodyLayoutMorph morphExtent).

    
    ^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:45:16' prior: 50985575!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildAddToCartRowWith: bodyLayoutMorph morphExtent).

    
    	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:45:37' prior: 50985527!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:46:20' prior: 50985609!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:47:29' prior: 50985629!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:48:29' prior: 50985482!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:48:51'!
 buildCartListHeaderWithExtent: anExtent! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:49:31' prior: 50985689!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: anExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:49:48' prior: 50985694!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'ISBN' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 17:51:38' prior: 50983082!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.3).
	^ itemMorph! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

Panel subclass: #CatalogWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 17:53:12'!
Panel subclass: #CatalogWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 17:53:16'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:53:48' prior: 50985012!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel class methodsFor: 'nil' stamp: 'AF 11/27/2021 17:56:16'!
with: aUser and: aPassword and: aCartId

	^self basicNew initializeWith: aUser and: aPassword and: aCartId.! !
!CatalogWindowModel methodsFor: 'no messages' stamp: 'AF 11/27/2021 17:56:33'!
initializeWith: aUser and: aPassword and: aCartId! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:57:02' prior: 50985787!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword 
! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:58:18' prior: 50985792!
initializeWith: aUser and: aPassword and: aCartId

	| cartId |
	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	counters := OrderedCollection new.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:58:40' prior: 50985799!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .

	counters := OrderedCollection new.! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 17:58:56'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password counters cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:58:55' prior: 50985808!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	counters := OrderedCollection new.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 17:59:42' prior: 50985764!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:02:30' prior: 50985825!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

! !

Panel subclass: #CatalogWindow
	instanceVariableNames: 'counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 18:02:42'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:03:33' prior: 50985833!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:09:24'!
addToCart
! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 18:23:34'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password counters cartId catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:23:32' prior: 50985852!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	catalog := self fetchCatalog.
! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:23:42'!
fetchCatalog
! !

----End fileIn of C:\Users\ferra\Desktop\windows64\Packages\TerseGuide.pck.st----!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:26:10' prior: 50985912!
fetchCatalog
! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:30:25' prior: 50988841!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: 'asdad' -> 'asdasd'.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:32:22' prior: 50988845!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 1.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:34:16' prior: 50988851!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 120;
	add: '00000001' -> 100;
	add: '00000002' -> 200.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:37:05' prior: 50988857!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 120;
	add: '00000001' -> 100;
	add: '00000002' -> 200.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:40:30' prior: 50988865!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 'Moby Dick';
	add: '00000001' -> 'Winnie Pooh';
	add: '00000002' -> 'La guia para la vida de Bart Simpson'.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:41:04'!
catalog

	^catalog.
! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 18:47:32' prior: 50984594!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	catalog _ self model catalog.
	catalog keys do: [: anISBN | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: anISBN) withISBN: anISBN withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 18:47:50' prior: 50988886!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: anISBN | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: anISBN) withISBN: anISBN withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:49:02' prior: 50985320!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.3);
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Checkout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3);
	addMorph:  (LabelMorph contents:'Welcome, ',self model username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:49:17'!
username 

	^username.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:49:47' prior: 50988873!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 'Moby Dick';
	add: '00000001' -> 'Winnie Pooh';
	add: '00000002' -> 'La guia para la vida de Bart Simpson'.
	
	^dict.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:50:32' prior: 50988963!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 'Moby Dick';
	add: '00000001' -> 'Winnie Pooh';
	add: '00000002' -> 'Haikyuu'.
	
	^dict.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:52:10' prior: 50988975!
fetchCatalog

	| dict |
	dict _ Dictionary new.
	
	dict add: '00000000' -> 'Moby Dick';
	add: '00000001' -> 'Winnie Pooh';
	add: '00000002' -> 'Haikyuu!!!!';
	add: '00000003' -> 'Eragon';
	add: '00000004' -> 'The Shining';
	add: '00000005' -> 'Eldest';
	add: '00000006' -> 'Legado'.
	
	
	^dict.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 18:54:21'!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:54:21' prior: 50984186!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: ISBN).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

!methodRemoval: CatalogWindow #buildCounterMorph stamp: 'AF 11/27/2021 18:54:21'!
buildCounterMorph
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ counters size +1. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 18:54:35' prior: 50989000!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 18:54:59' prior: 50989041!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: anISBN).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 18:56:32' prior: 50985872!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #authenticationResponse send: #login to: self."
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 18:56:56' prior: 50989099!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: anId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:03:48' prior: 50989179!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: anId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:05:12' prior: 50981772!
updateCounter: aCounter
	
	| textMorph |
	textMorph _ (counters at: aCounter id) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model addToLocalCart: (counters at: aCounter id).
! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:06:47' prior: 50989261!
updateCounter: aCounter
	
	| textMorph counterId |
	counterId _ aCounter id.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id.
! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:07:24'!
updateCounter: aCounter with: anAmount 
	
	| textMorph counterId |
	counterId _ aCounter id.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:07:24' prior: 50989221!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: anId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter:with: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

!methodRemoval: CatalogWindow #updateCounter: stamp: 'AF 11/27/2021 19:07:24'!
updateCounter: aCounter
	
	| textMorph counterId |
	counterId _ aCounter id.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id.
!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:11:02'!
updateCounter: aCounter  
	
	| textMorph counterId |
	counterId _ aCounter id.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:11:03' prior: 50989302!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counters add: anId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

!methodRemoval: CatalogWindow #updateCounter:with: stamp: 'AF 11/27/2021 19:11:03'!
updateCounter: aCounter with: anAmount 
	
	| textMorph counterId |
	counterId _ aCounter id.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: aCounter value.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id.
!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:12:28' prior: 50989355!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	counterId _ aCounter id.
	counterValue _ aCounter value.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id with: counterValue.
! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:12:43'!
updateLocalCartAt: aString with: aString2 
	self shouldBeImplemented.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 19:13:56' prior: 50989423!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	counterId _ aCounter id.
	counterValue _ aCounter value.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: aCounter id with: counterValue asNumber.
! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 19:15:24'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password counters cartId catalog localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:15:06' prior: 50989441!
updateLocalCartAt: anISBN with: anAmount

	localCart add: anISBN -> anAmount.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:16:24' prior: 50985904!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	catalog := self fetchCatalog.

	localCart := Dictionary new.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:18:02' prior: 50985891!
addToCart

	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:26:51' prior: 50989491!
addToCart

	|client notDecodedResponse respDict |
	client _ WebClient new.
	
	localCart keysAndValuesDo: [:anISBN :aQuantity |
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',self cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			
		] 
		ifFalse: [
			respDict at: 'errorDescription'.
		].
	]
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:26:57' prior: 50989495!
addToCart

	|client notDecodedResponse respDict |
	client _ WebClient new.
	
	localCart keysAndValuesDo: [:anISBN :aQuantity |
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',self cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			
		] 
		ifFalse: [
			respDict at: 'errorDescription'.
		].
	].
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:27:07'!
cartId
	^cartId .! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:27:11' prior: 50989535!
cartId

	^cartId.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:27:46' prior: 50989515!
addToCart

	|client notDecodedResponse respDict |
	client _ WebClient new.
	
	localCart keysAndValuesDo: [:anISBN :aQuantity |
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			
		] 
		ifFalse: [
			respDict at: 'errorDescription'.
		].
	].
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:31:46' prior: 50989543!
addToCart

	|client notDecodedResponse respDict |
	client _ WebClient new.
	
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				
			] 
			ifFalse: [
				respDict at: 'errorDescription'.
			]
		]
	].
	
	client close.
	
	self triggerEvent: #booksAddedToCart! !

!classDefinition: #ErrorWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 19:41:39'!
Panel subclass: #ErrorWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:41:23' prior: 50989563!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Dictionary new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow with: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:45:33' prior: 50989591!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Array new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow with: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart withArguments: xxxx.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:50:59' prior: 50989619!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Array new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart withArguments: xxxx.! !
!ErrorWindow class methodsFor: 'no messages' stamp: 'AF 11/27/2021 19:51:38'!
openWith: aTitle and: aCollectionOfErrorDescriptions

	! !
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:52:08' prior: 50989676!
openWith: aTitle and: aCollectionOfErrorDescriptions

	^self basicNew initializeWith: aTitle and: aCollectionOfErrorDescriptions .! !
!ErrorWindow methodsFor: 'nil' stamp: 'AF 11/27/2021 19:52:24'!
initializeWith: aTitle and: aCollectionOfErrorDescriptions

	! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:53:38' prior: 50989689!
initializeWith: aTitle and: aCollectionOfErrorDescriptions
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: self. "muy mal pero no se que irira en el model"
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:54:13' overrides: 50965689!
defaultExtent

	^200@300.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:54:26' overrides: 50965593!
buildMorphicWindow

	! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/27/2021 19:54:52' prior: 50985559!
buildAddToCartRowWith: anExtent

    | checkoutButton checkoutRow |
    
        checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #addToCart label: 'Add to cart'.

        checkoutRow := LayoutMorph newRow.
        checkoutRow separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: checkoutButton.

        ^checkoutRow.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:57:39' prior: 50989160!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart send: #updateBooksSentSuccessfuly to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:59:11' prior: 50989734!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart send: #updateBooksSentSuccessfuly to: self with.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 19:59:16' prior: 50989754!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart send: #updateBooksSentSuccessfuly to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:03:16' prior: 50989774!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counters := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:06:04'!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 20:12:55'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counters cartListMorph2'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:12:54' prior: 50985304!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph2 := (self buildCartListMorphWith: bodyLayoutMorph morphExtent).
	
	bodyLayoutMorph addMorph: cartListMorph2;
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:13:57'!
buildRightColumnMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:13:57' prior: 50989827!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph2 := (self buildRightColumnMorphWith: bodyLayoutMorph morphExtent).
	
	bodyLayoutMorph addMorph: cartListMorph2;
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildCartListMorphWith: stamp: 'AF 11/27/2021 20:13:57'!
buildCartListMorphWith: anExtent

	| cartListMorph scrollMorph |
	
	cartListMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: cartListMorph.
	
	cartListMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	cartListMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:14:30' prior: 50989843!
buildRightColumnMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	2 timesRepeat: [rightColumnMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: 'ISBN' withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 20:14:44'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counters cartListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:14:44' prior: 50989863!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildRightColumnMorphWith: bodyLayoutMorph morphExtent).
	
	bodyLayoutMorph addMorph: cartListMorph;
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:17:10' prior: 50989814!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	cartListMorph! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:19:45' prior: 50989899!
buildRightColumnMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:20:57' prior: 50989945!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: '' withExtent: cartListMorph morphExtent)! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:21:45' prior: 50989968!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph addMorph: (self buildCartItemRowWithName: 'test' withISBN: '' withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:23:07'!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:23:07' prior: 50989928!
buildCartListColumn

	| bodyLayoutMorph |
		
	bodyLayoutMorph := LayoutMorph newColumn.
	bodyLayoutMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: bodyLayoutMorph morphExtent).
	
	bodyLayoutMorph addMorph: cartListMorph;
	addMorph: (self buildCheckoutRowWith: bodyLayoutMorph morphExtent).

	
	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildRightColumnMorphWith: stamp: 'AF 11/27/2021 20:23:07'!
buildRightColumnMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph.!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:23:39' prior: 50990003!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildCheckoutRowWith: cartListColumnMorph morphExtent).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 20:24:47' prior: 50989987!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:26:09' prior: 50989977!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: 'test' withISBN: '' withExtent: cartListMorph morphExtent)]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

!classDefinition: #ErrorWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 20:27:11'!
Panel subclass: #ErrorWindow
	instanceVariableNames: 'dictionaryOfErrors'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:27:10' prior: 50989695!
initializeWith: aName and: aDictionaryOfErrors 
    
    dictionaryOfErrors := aDictionaryOfErrors.
    self titleMorph showButtonsNamed: #( close collapse ).
    self setLabel: aName.
    self model: nil.
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:27:28' prior: 50990090!
initializeWith: aName and: aDictionaryOfErrors 
    
    dictionaryOfErrors := aDictionaryOfErrors.

    self titleMorph showButtonsNamed: #( close collapse ).
    self setLabel: aName.
    self model: nil.
    self morphExtent: self defaultExtent.
    self buildMorphicWindow.
    self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:28:23' prior: 50989708 overrides: 50965689!
defaultExtent

	^800@300.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:28:35' prior: 50989713 overrides: 50965593!
buildMorphicWindow
    
    | errorsMorph scrollMorph |
    errorsMorph := self buildErrorsMorph.
    
    scrollMorph := PluggableScrollPane new.
    scrollMorph morphExtent: self defaultExtent*0.8;
    scroller: errorsMorph.
    
    self layoutMorph beColumn;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: scrollMorph.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:28:45'!
ErrorRowFor: isbn text: err
    
    | morph |
    morph _ LayoutMorph  newRow.
    morph separation: 0@0;
    axisEdgeWeight: 0.0;
    addMorph: (LabelMorph contents: (isbn, ': ', err)).
    ^ morph! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:28:50'!
buildErrorsMorph 

    | errorsMorph |
    errorsMorph := LayoutMorph newColumn.
    errorsMorph separation: 0@5;
    axisEdgeWeight: 0.0.
    dictionaryOfErrors keysAndValuesDo: [:isbn :err | errorsMorph addMorph: (self ErrorRowFor: isbn text: err)].
    ^ errorsMorph.! !
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:29:14' prior: 50989682!
openWith: aTitle and: aDictionaryOfErrors

	^self basicNew initializeWith: aTitle and: aDictionaryOfErrors .! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:29:58' prior: 50989648!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Array new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart withArguments: xxxx.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:30:18' prior: 50990167!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Array new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart withArguments: xxxx.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:32:25' prior: 50990158!
openWith: aTitle and: aDictionaryOfErrors

	^self new initializeWith: aTitle and: aDictionaryOfErrors .! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:34:39' prior: 50990198!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ Array new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	xxxx ifNotEmpty: [self triggerEvent: #booksAddedToCart withArguments: xxxx.]! !

----SNAPSHOT----(27 November 2021 20:35:13) CuisUniversity-4972.image priorSource: 20903152!
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'AF 11/27/2021 20:37:03' prior: 50980064!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		
		add: '00000000' -> 'Moby Dick';
		add: '00000001' -> 'Winnie Pooh';
		add: '00000002' -> 'Haikyuu!!!!';
		add: '00000003' -> 'Eragon';
		add: '00000004' -> 'The Shining';
		add: '00000005' -> 'Eldest';
		add: '00000006' -> 'Legado';
		yourself ! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:40:12' prior: 50990245!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	xxxx ifNotEmpty: [self triggerEvent: #booksAddedToCart withArguments: xxxx.]! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:41:53' prior: 50981230!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
		].
	
	
	client close.
	
	self triggerEvent: #authenticationResponse! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:42:19' prior: 50990330!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			CatalogWindow openWithUser: username andPass: password andCart: cartId.
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
			self triggerEvent: #authenticationResponse
		].
	
	
	client close.
	
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:43:16' prior: 50981361!
login

	errorMessageMorph contents: self model response.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:43:53' prior: 50990374!
login
	"cambiar el nombre pls"
	errorMessageMorph contents: self model response.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:44:14' prior: 50981345!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	self model when: #closeWindow send: #closeWindow to: self
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:44:16' prior: 50990385!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #login to: self.
	self model when: #closeWindow send: #closeWindow to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:45:00' prior: 50990379!
login

	self delete! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:43:53' prior: 50990421!
login
	"cambiar el nombre pls"
	errorMessageMorph contents: self model response.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:45:31'!
closeWindow

	self delete! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:46:39' prior: 50990352!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
			self triggerEvent: #authenticationResponse
		].
	
	
	client close.
	
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:47:21' prior: 50990431!
closeWindow

	| cartId password username |
	
	CatalogWindow openWithUser: username andPass: password andCart: cartId.
	self delete! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:47:36'!
loginError
	"cambiar el nombre pls"
	errorMessageMorph contents: self model response.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:47:36' prior: 50990403!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #loginError to: self.
	self model when: #closeWindow send: #closeWindow to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: LoginWindow #login stamp: 'AF 11/27/2021 20:47:36'!
login
	"cambiar el nombre pls"
	errorMessageMorph contents: self model response.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:47:45' prior: 50990463!
loginError

	errorMessageMorph contents: self model response.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:48:09'!
loginSuccessful

	| cartId password username |
	
	CatalogWindow openWithUser: username andPass: password andCart: cartId.
	self delete! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:48:09' prior: 50990469!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationResponse send: #loginError to: self.
	self model when: #loginSuccessful send: #loginSuccessful to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: LoginWindow #closeWindow stamp: 'AF 11/27/2021 20:48:10'!
closeWindow

	| cartId password username |
	
	CatalogWindow openWithUser: username andPass: password andCart: cartId.
	self delete!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:49:15' prior: 50990436!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess
			
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
			self triggerEvent: #authenticationFailure
		].
	
	
	client close.
	
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:50:17' prior: 50990529!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy, password copy, cartId}
			
		] 
		ifFalse: [
			response _ respDict at: 'errorDescription'.
			self triggerEvent: #authenticationFailure
		].
	
	
	client close.
	
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:51:26' prior: 50990550!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy, password copy, cartId}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	
	client close.
	
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:55:14' prior: 50990504!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationFailure evaluate: [:anErrorDescription | self loginErrorwith: anErrorDescription].
	self model when: #authenticationSuccess evaluate: [:aUsername :aPassword :aCartId | self loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId ]
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:55:32'!
loginError: anErrorMessage

	errorMessageMorph contents: anErrorMessage .! !

!methodRemoval: LoginWindow #loginError stamp: 'AF 11/27/2021 20:55:37'!
loginError

	errorMessageMorph contents: self model response.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:55:56' prior: 50990596!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationFailure evaluate: [:anErrorDescription | self loginErrorWith: anErrorDescription].
	self model when: #authenticationSuccess evaluate: [:aUsername :aPassword :aCartId | self loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId ]
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:56:03'!
loginErrorWith: anErrorMessage

	errorMessageMorph contents: anErrorMessage .! !

!methodRemoval: LoginWindow #loginError: stamp: 'AF 11/27/2021 20:56:05'!
loginError: anErrorMessage

	errorMessageMorph contents: anErrorMessage .!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:56:29'!
loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId

	CatalogWindow openWithUser: aUsername andPass: aPassword andCart: aCartId.
	self delete! !

!methodRemoval: LoginWindow #loginSuccessful stamp: 'AF 11/27/2021 20:56:32'!
loginSuccessful

	| cartId password username |
	
	CatalogWindow openWithUser: username andPass: password andCart: cartId.
	self delete!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:56:40' prior: 50990628!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationFailure evaluate: [:anErrorDescription | self loginErrorWith: anErrorDescription].
	self model when: #authenticationSuccess evaluate: [:aUsername :aPassword :aCartId | self loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId ].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: LoginWindowModel #response stamp: 'AF 11/27/2021 20:57:22'!
response
	^ response.
	!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:57:42' prior: 50980615!
username: aUsername
	username _ aUsername asString.
	^ true.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:57:44' prior: 50990701!
username: aUsername

	username _ aUsername asString.
	^ true.
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:57:54' prior: 50990707!
username: aUsername

	username _ aUsername asString.

	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:57:58' prior: 50980602!
password: aPassword
	password _ aPassword asString.

	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:58:03' prior: 50990718!
password: aPassword

	password _ aPassword asString.

	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 20:58:13' prior: 50980592 overrides: 16896425!
initialize

	username := ''.
	password := '' "Dont do this at home kids".! !

----SNAPSHOT----(27 November 2021 20:58:16) CuisUniversity-4972.image priorSource: 21075947!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:00:56' prior: 50982515!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20.
	userTextBoxMorph innerTextMorph contents: 'validUser'.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:01:18' prior: 50990749!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20.
	userTextBoxMorph innerTextMorph contents: 'validUser'; acceptContents.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !

LoginWindow open.!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:01:37' prior: 50990774!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20.
	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:01:44' prior: 50990799!
build1stRow
	| firstRowLayoutMorph |
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #username textSetter: #username:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200 ; morphHeight: 20.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	morphExtent: 475@1;
	addMorph: (LabelMorph contents:'Username:');
	addMorph: userTextBoxMorph.
	
	^firstRowLayoutMorph.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:02:12' prior: 50979239!
validUserPassword

	^'password'! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:02:21' prior: 50979235!
validUser

	^'admin'! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:02:25' prior: 50990844!
validUserPassword

	^'admin'! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:02:36' prior: 50979230!
invalidPassword

	^'notAdmin'! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 21:02:44'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/27/2021 21:02:44'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/27/2021 21:02:44'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/27/2021 21:02:44'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 21:02:44'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:02:44'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 21:02:53'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:03:48' prior: 50979764!
validUser

	^'admin'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:03:52' prior: 50979768!
validUserPassword

	^'admin'! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/27/2021 21:04:02' prior: 50979754!
invalidUser

	^'notAdmin'! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 21:04:12'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/27/2021 21:04:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/27/2021 21:04:12'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/27/2021 21:04:12'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/27/2021 21:04:12'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 21:04:12'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 21:04:14'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(27 November 2021 21:04:29) CuisUniversity-4972.image priorSource: 21090700!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/27/2021 21:04:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/27/2021 21:04:33'!
PASSED!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:05:36' prior: 50990573!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	
	client close.
	
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:09:56' prior: 50990300!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	xxxx ifNotEmpty: [self triggerEvent: #booksAddedToCart with: xxxx.]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:11:45' prior: 50990069!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: 'test' withISBN: anAssociation withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:12:25' prior: 50991193!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation value withISBN: anAssociation key withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:12:40' prior: 50991204!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation value 
																						   withISBN: anAssociation key 
																						withExtent: cartListMorph morphExtent)]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:13:37' prior: 50991216!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation key 
																						   withISBN: anAssociation value 
																						withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 21:16:06'!
buildCartItemRowWith: aQuantity of: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	"addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);"
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

!methodRemoval: CatalogWindow #buildCartItemRowWithName:withISBN:withExtent: stamp: 'AF 11/27/2021 21:16:16'!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:16:47' prior: 50991232!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 21:17:34' prior: 50991245!
buildCartItemRowWith: aQuantity of: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: '           ' ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:19:29' prior: 50991285!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) value: 0.		
								]! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:20:27'!
reset

	|newValue|

	newValue _ 0.
	self value: newValue asString.
	self triggerEvent: #updateCounter with: self.	
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:20:38' prior: 50991320!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:25:56' prior: 50991342!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) textProvider reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:01' prior: 50991359!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:18' prior: 50991375!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph textProvider reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:29' prior: 50991390!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:35:57' prior: 50991406!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph contents: 0.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:36:20' prior: 50991421!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph contents: 0 asString.		
								]! !

----STARTUP---- (27 November 2021 21:36:55) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!

!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:05:36' prior: 50990573!
authenticate

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	
	client close.
	
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:09:56' prior: 50990300!
addToCart

	|client notDecodedResponse respDict raisedErrors xxxx |
	client _ WebClient new.
	xxxx _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				xxxx add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	xxxx ifNotEmpty: [self triggerEvent: #booksAddedToCart with: xxxx.]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:11:45' prior: 50990069!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: 'test' withISBN: anAssociation withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:12:25' prior: 50991510!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation value withISBN: anAssociation key withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:12:40' prior: 50991521!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation value 
																						   withISBN: anAssociation key 
																						withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:13:37' prior: 50991533!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWithName: anAssociation key 
																						   withISBN: anAssociation value 
																						withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 21:16:06'!
buildCartItemRowWith: aQuantity of: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	"addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);"
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

!methodRemoval: CatalogWindow #buildCartItemRowWithName:withISBN:withExtent: stamp: 'AF 11/27/2021 21:37:17'!
buildCartItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:16:47' prior: 50991547!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent)]! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/27/2021 21:17:34' prior: 50991560!
buildCartItemRowWith: aQuantity of: anISBN withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: '           ' ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:19:29' prior: 50991600!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) value: 0.		
								]! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:20:27'!
reset

	|newValue|

	newValue _ 0.
	self value: newValue asString.
	self triggerEvent: #updateCounter with: self.	
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:20:38' prior: 50991633!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:25:56' prior: 50991655!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) textProvider reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:01' prior: 50991670!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:18' prior: 50991686!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph textProvider reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:27:29' prior: 50991701!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) reset.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:35:57' prior: 50991717!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph contents: 0.		
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:36:20' prior: 50991732!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph contents: 0 asString.		
								]! !

----SNAPSHOT----(27 November 2021 21:37:47) CuisUniversity-4972.image priorSource: 21100554!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.
!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:39:32' prior: 50991748!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   (counters at: anAssociation key) innerTextMorph contents: 0 asString.	
											   (counters at: anAssociation key) innerTextMorph acceptContents.	
								]! !

----SNAPSHOT----(27 November 2021 21:39:36) CuisUniversity-4972.image priorSource: 21123603!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.
!

----STARTUP---- (27 November 2021 21:40:13) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.
!

----STARTUP---- (27 November 2021 21:40:55) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

----STARTUP---- (27 November 2021 21:41:23) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!

!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:41:32' prior: 50991772!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   "(counters at: anAssociation key) innerTextMorph contents: 0 asString.	
											   (counters at: anAssociation key) innerTextMorph acceptContents.	"
								]! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 21:45:38' prior: 50989447!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	counterId _ aCounter id.
	counterValue _ aCounter value.
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 21:45:45' prior: 50991845!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counters at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:47:40' prior: 50991817!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |textMorph|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   textMorph _ (counters at: anAssociation key) innerTextMorph.
											   textMorph contents: 0 asString.
											   textMorph hasUnacceptedEdits: true.
											   textMorph acceptContents.
										          	textMorph resetTextComposition; updateFromTextComposition.
								]! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(27 November 2021 21:55:11) CuisUniversity-4972.image priorSource: 21124449!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:57:30' prior: 50981674!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		num >= 0 ifTrue: [value num asString.
					    self triggerEvent: #updateCounter with: self].
	] on: Error do: [].! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:57:38' prior: 50991912!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		num >= 0 ifTrue: [value _ num asString.
					    self triggerEvent: #updateCounter with: self].
	] on: Error do: [].! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:57:58' prior: 50981651!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [self value: newValue asString.
					    "self triggerEvent: #updateCounter with: self"].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 21:58:03' prior: 50981660!
valueUp

	self value: (self value asNumber asInteger +1) asString.
	"self triggerEvent: #updateCounter with: self."
! !

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:01:14' prior: 50991921!
value: aValue
	[
		|num|
		num _ aValue asNumber asInteger.
		num >= 0 ifTrue: [value _ num asString].
	] on: Error do: [].! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:01:22' prior: 50991930!
valueDown

	|newValue|

	newValue _ self value asNumber asInteger -1.
	newValue >= 0 ifTrue: [self value: newValue asString.
					    self triggerEvent: #updateCounter with: self].
	
! !
!ItemCounterModel methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:01:30' prior: 50991940!
valueUp

	self value: (self value asNumber asInteger +1) asString.
	self triggerEvent: #updateCounter with: self.
! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:04:26'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'countersTextMorphs cartListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:04:26' prior: 50989369!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	countersTextMorphs add: anId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:04:26' prior: 50991861!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (countersTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:04:26' prior: 50991878!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |textMorph|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   textMorph _ (countersTextMorphs at: anAssociation key) innerTextMorph.
											   textMorph contents: 0 asString.
											   textMorph hasUnacceptedEdits: true.
											   textMorph acceptContents.
										          	textMorph resetTextComposition; updateFromTextComposition.
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:04:26' prior: 50989794!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	countersTextMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:05:54'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'countersTextMorphs cartListMorph counterModels'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:05:53' prior: 50991983!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	countersTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:06:02'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:06:02' prior: 50992094!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounter: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:06:02' prior: 50992024!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:06:02' prior: 50992041!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |textMorph|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   textMorph _ (counterTextMorphs at: anAssociation key) innerTextMorph.
											   textMorph contents: 0 asString.
											   textMorph hasUnacceptedEdits: true.
											   textMorph acceptContents.
										          	textMorph resetTextComposition; updateFromTextComposition.
								]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:06:02' prior: 50992065!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counterTextMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:06:19' prior: 50992228!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 

	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID ).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:07:29'!
updateCounterTextMorph: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:07:29' prior: 50992145!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounterTextMorph: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

!methodRemoval: CatalogWindow #updateCounter: stamp: 'AF 11/27/2021 22:07:29'!
updateCounter: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:11:56' prior: 50992204!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |counterModel|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											  counterModel _ (counterModels at: anAssociation key) value: '0'.
											  self updateCounterTextMorph: counterModel 
								]! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:12:19'!
updateCounterTextMorphBasedOn: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:12:19' prior: 50992287!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents ] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounterTextMorphBasedOn: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/27/2021 22:12:19' prior: 50992345!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |counterModel|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											  counterModel _ (counterModels at: anAssociation key) value: '0'.
											  self updateCounterTextMorphBasedOn: counterModel 
								]! !

!methodRemoval: CatalogWindow #updateCounterTextMorph: stamp: 'AF 11/27/2021 22:12:19'!
updateCounterTextMorph: aCounter  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounter id.
	counterValue _ aCounter value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:12:27' prior: 50992363!
updateCounterTextMorphBasedOn: aCounterModel  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounterModel id.
	counterValue _ aCounterModel value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
	self model updateLocalCartAt: counterId with: counterValue asNumber.
! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

----SNAPSHOT----(27 November 2021 22:16:04) CuisUniversity-4972.image priorSource: 21128234!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:20:44' prior: 50992380!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents.
															self model updateLocalCartAt: counterId with: counter value asNumber.] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounterTextMorphBasedOn: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:21:48'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

----STARTUP---- (27 November 2021 22:28:00) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!

!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/27/2021 22:20:44' prior: 50992380!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents.
															self model updateLocalCartAt: counterId with: counter value asNumber.] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounterTextMorphBasedOn: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:28:10'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/27/2021 22:28:10'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.
!

----SNAPSHOT----(27 November 2021 22:29:25) CuisUniversity-4972.image priorSource: 21146539!

----SNAPSHOT----(27 November 2021 22:30:14) CuisUniversity-4972.image priorSource: 21150973!

----SNAPSHOT----(27 November 2021 22:31:06) CuisUniversity-4972.image priorSource: 21151067!

----STARTUP---- (27 November 2021 22:31:20) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!

!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'AF 11/27/2021 23:20:51' prior: 50990278!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		
		add: '00000000' -> 'Moby Dick';
		add: '00000001' -> 'Winnie Pooh';
		add: '00000002' -> 'Haikyuu!!!!';
		add: '00000003' -> 'Eragon';
		add: '00000004' -> 'The Shining';
		"add: '00000005' -> 'Eldest';"
		add: '00000006' -> 'Legado';
		yourself ! !

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.
!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(27 November 2021 23:21:46) CuisUniversity-4972.image priorSource: 21151161!

|server|
server _ TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

----SNAPSHOT----(27 November 2021 23:22:33) CuisUniversity-4972.image priorSource: 21152315!

----STARTUP---- (28 November 2021 12:22:39) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!

!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/28/2021 12:23:52'!
fetchCatalog

	! !
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'AF 11/28/2021 12:27:18' prior: 50992632!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		
		add: 'Moby Dick' -> 1000;
		add: 'Winnie Pooh' -> 900;
		add: 'Haikyuu!!!!' -> 450;
		add: 'Eragon' -> 1200;
		add: 'The Shining' -> 650;
		"add: 'Eldest' -> 1250;"
		add: 'Legado' -> 1100;
		yourself ! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'AF 11/28/2021 12:28:40' prior: 50992673!
fetchCatalog

	^catalog.! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:31:56' prior: 50982689!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForListPurchases: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:33:12'!
jsonResponseForFetchCatalog: catalogDictionary

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'catalog' -> catalogDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:36:03' prior: 50992698!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:38:31' prior: 50978532!
convertToDictionary: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:41:58'!
addServiceWithInternalErrorHandling: aService action: aBlock	
	
	
	webServer addService: '/createCart' action:[:request | 		aBlock on: Error 
												      do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
									  ].
	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:46:31' prior: 50992805!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addService: '/createCart' action:[:request | 
		[
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].
	
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:47:00' prior: 50992914!
addServiceWithInternalErrorHandling: aService action: aBlock	
	
	
	webServer addService: '/createCart' action:[:request | 		[aBlock value: request] on: Error 
												      do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
									  ].
	! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:48:24' prior: 50992926!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	webServer addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
														| user password cartId |
														user := (request fields at:'clientId').
														password := (request fields at:'password').
															
														cartId := systemFacade createCartFor: user authenticatedWith: password.
																	
														request send200Response: (self jsonResponseForCreateCart: cartId).
														].
												
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:48:48' prior: 50993038!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
														| user password cartId |
														user := (request fields at:'clientId').
														password := (request fields at:'password').
															
														cartId := systemFacade createCartFor: user authenticatedWith: password.
																	
														request send200Response: (self jsonResponseForCreateCart: cartId).
														].
												
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:50:26' prior: 50993140!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
												
	self addServiceWithInternalErrorHandling: '/addToCart' action:[:request | 
													| book bookAmount cartId |
													cartId := (request fields at:'cartId').
													book := (request fields at:'bookIsbn').
													bookAmount := (request fields at:'bookQuantity').		
													
													systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

													request send200Response: self jsonSuccessfulResponse.
												      ].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 12:52:08) CuisUniversity-4972.image priorSource: 21152499!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!TusLibrosSystemFacade methodsFor: 'authentication' stamp: 'AF 11/28/2021 12:52:48' prior: 50978759!
does: aUser authenticatesWith: aPassword

	"Recordar que esto es solo un ejemplo. No se deben guardar passwords en un sistema de verdad sino un
	hash o similar - Hernan"

	| storedPassword |

	storedPassword := validUsersAndPasswords at: aUser ifAbsent: [ ^false ].
	^aPassword = storedPassword ! !
!TusLibrosSystemFacade methodsFor: 'authentication' stamp: 'AF 11/28/2021 12:52:52' prior: 50978772!
if: aUser authenticatesWith: aPassword do: aBlock

	^ (self does: aUser authenticatesWith: aPassword)
		ifTrue: aBlock
		ifFalse: [ self signalInvalidUserAndOrPassword ].
	! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/28/2021 12:53:36' prior: 50991004!
validUser

	^'admin'! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 12:53:52'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 12:53:52'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 12:53:52'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 12:53:52'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 12:53:52'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 12:53:52'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 12:53:52'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:53:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:53:53'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 12:54:07' prior: 50979286!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 12:54:15' prior: 50979312!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 12:54:19'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 12:55:25'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 12:55:25'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 12:55:25'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 12:55:25'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 12:55:25'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 12:55:25'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 12:55:32'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 12:55:45'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 12:55:45'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 12:55:45'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 12:55:45'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 12:55:45'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 12:55:45'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 12:55:48'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:48:48' prior: 50993251!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
														| user password cartId |
														user := (request fields at:'clientId').
														password := (request fields at:'password').
															
														cartId := systemFacade createCartFor: user authenticatedWith: password.
																	
														request send200Response: (self jsonResponseForCreateCart: cartId).
														].
												
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:58:23' prior: 50993702!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
												
	webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 12:59:57' prior: 50993804!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
		
	self addServiceWithInternalErrorHandling: '/addToCart' action: 	[:request |
													| book bookAmount cartId |
													cartId := (request fields at:'cartId').
													book := (request fields at:'bookIsbn').
													bookAmount := (request fields at:'bookQuantity').		
													
													systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

													request send200Response: self jsonSuccessfulResponse.
												       ].
												
	"webServer addService: '/addToCart' action:[:request | 
		[
			| book bookAmount cartId |
			cartId := (request fields at:'cartId').
			book := (request fields at:'bookIsbn').
			bookAmount := (request fields at:'bookQuantity').		
			
			systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

			request send200Response: self jsonSuccessfulResponse.
		 ] 
		on: Error 
		do: [ :anError | request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	]."

	webServer addService: '/listCart' action:[:request | 
		[
			| cartId cartContents cartContentsDictionary |
			cartId := (request fields at:'cartId').	
			
			cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			cartContentsDictionary _ self convertToDictionary: cartContents.

			request send200Response: (self jsonResponseForListCart: cartContentsDictionary).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:00:57'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 13:00:57'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 13:00:57'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 13:00:57'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 13:00:57'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 13:00:57'!
ERROR!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:00:58'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:02:44'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:02:44'!
FAILURE!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:04:45' prior: 50993025!
addServiceWithInternalErrorHandling: aService action: aBlock	
	
	
	webServer addService: aService action:[:request | 		[aBlock value: request] on: Error 
												      do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
									  ].
	! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 13:05:34) CuisUniversity-4972.image priorSource: 21174622!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:08:01' prior: 50993910!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
		
	self addServiceWithInternalErrorHandling: '/addToCart' action: 	[:request |
													| book bookAmount cartId |
													cartId := (request fields at:'cartId').
													book := (request fields at:'bookIsbn').
													bookAmount := (request fields at:'bookQuantity').		
													
													systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

													request send200Response: self jsonSuccessfulResponse.
												       ].

	self addServiceWithInternalErrorHandling: '/listCart' action:[:request | 
												 | cartId cartContents cartContentsDictionary |
												 cartId := (request fields at:'cartId').	
												
												 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
												 cartContentsDictionary _ self convertToDictionary: cartContents.

												 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

												 ].

	webServer addService: '/checkOutCart' action:[:request | 
		[
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		 ] 
		on: Error 
		do: [ :anError |			request send200Response: (self jsonErrorResponseBasedOn: anError) .		]
	].
	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:09:00' prior: 50994089!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
		
	self addServiceWithInternalErrorHandling: '/addToCart' action: 	[:request |
													| book bookAmount cartId |
													cartId := (request fields at:'cartId').
													book := (request fields at:'bookIsbn').
													bookAmount := (request fields at:'bookQuantity').		
													
													systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

													request send200Response: self jsonSuccessfulResponse.
												       ].

	self addServiceWithInternalErrorHandling: '/listCart' action:[:request | 
												 | cartId cartContents cartContentsDictionary |
												 cartId := (request fields at:'cartId').	
												
												 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
												 cartContentsDictionary _ self convertToDictionary: cartContents.

												 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

												 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:09:20' prior: 50994187!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
		
	self addServiceWithInternalErrorHandling: '/addToCart' action: 	[:request |
													| book bookAmount cartId |
													cartId := (request fields at:'cartId').
													book := (request fields at:'bookIsbn').
													bookAmount := (request fields at:'bookQuantity').		
													
													systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

													request send200Response: self jsonSuccessfulResponse.
												       ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:09:53' prior: 50994283!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' action:[:request | 
													
													| user password cartId |
													user := (request fields at:'clientId').
													password := (request fields at:'password').
														
													cartId := systemFacade createCartFor: user authenticatedWith: password.
																
													request send200Response: (self jsonResponseForCreateCart: cartId).
													].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:10:11' prior: 50994377!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	webServer addService: '/listPurchases' action:[:request | 
		[
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:18:58' prior: 50994469!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	webServer addService: '/fetchCatalog' action:[:request | 
		[
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
		 ] 
		on: Error 
		do: [ :anError |			 request send200Response: (self jsonErrorResponseBasedOn: anError).]
	].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 13:19:38' prior: 50994559!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner|
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonSuccessfulResponse).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 13:20:46) CuisUniversity-4972.image priorSource: 21197834!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:24:39' prior: 50988984!
fetchCatalog

	|client notDecodedResponse respDict raisedErrors |
	client _ WebClient new.
	catalog _ Dictionary new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			
		] 
		ifFalse: [
			
		].
		

	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 13:26:29'!
test07fetchCatalog

	|server client book response responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	response _ (client httpGet: 'http://localhost:8080/fetchCatalog' ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 13:26:42' prior: 50994758!
test07fetchCatalog

	|server client response responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	response _ (client httpGet: 'http://localhost:8080/fetchCatalog' ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 13:26:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 13:26:52'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 13:26:52'!
PASSED!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:28:34' prior: 50994740!
fetchCatalog

	|client notDecodedResponse responseDictionary raisedErrors |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			
		].
		

	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:30:51' prior: 50994846!
fetchCatalog

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			ErrorWindow openWith: 'It was not possible to retrieve the catalog'
		].
		

	
	client close.
	
	
! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:32:29'!
buildMorphicWindowForMultipleErrors
    
    | errorsMorph scrollMorph |
    errorsMorph := self buildErrorsMorph.
    
    scrollMorph := PluggableScrollPane new.
    scrollMorph morphExtent: self defaultExtent*0.8;
    scroller: errorsMorph.
    
    self layoutMorph beColumn;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: scrollMorph.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:32:29' prior: 50990103!
initializeWith: aName and: aDictionaryOfErrors 
    
    dictionaryOfErrors := aDictionaryOfErrors.

    self titleMorph showButtonsNamed: #( close collapse ).
    self setLabel: aName.
    self model: nil.
    self morphExtent: self defaultExtent.
    self buildMorphicWindowForMultipleErrors.
    self openInWorld.! !

!methodRemoval: ErrorWindow #buildMorphicWindow stamp: 'AF 11/28/2021 13:32:29'!
buildMorphicWindow
    
    | errorsMorph scrollMorph |
    errorsMorph := self buildErrorsMorph.
    
    scrollMorph := PluggableScrollPane new.
    scrollMorph morphExtent: self defaultExtent*0.8;
    scroller: errorsMorph.
    
    self layoutMorph beColumn;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: scrollMorph.!
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:32:47'!
openWith: aTitle

	^self new initializeWith: aTitle.! !
!ErrorWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:33:21' prior: 50994927!
openWith: anErrorDescription

	^self new initializeWith: anErrorDescription .! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:34:04'!
initializeWith: anErrorDescription

    self titleMorph showButtonsNamed: #( close collapse ).
    self setLabel: 'Error' .
    self model: nil.
    self morphExtent: self defaultExtent.
    self buildDefaultMorphicWindow.
    self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:36:05'!
buildDefaultMorphicWindow: anErrorDescription

	! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:36:11' prior: 50994938!
initializeWith: anErrorDescription

    self titleMorph showButtonsNamed: #( close collapse ).
    self setLabel: 'Error' .
    self model: nil.
    self morphExtent: self defaultExtent.
    self buildDefaultMorphicWindow: anErrorDescription .
    self openInWorld.! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:37:22' prior: 50994949!
buildDefaultMorphicWindow: anErrorDescription

    self layoutMorph beRow;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: LabelMorph contents: anErrorDescription .! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:37:31' prior: 50994966!
buildDefaultMorphicWindow: anErrorDescription

    self layoutMorph beRow;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: (LabelMorph contents: anErrorDescription).! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

----SNAPSHOT----(28 November 2021 13:37:59) CuisUniversity-4972.image priorSource: 21218744!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:44:15' prior: 50994866!
fetchCatalog

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error do:[ErrorWindow openWith: 'Server down - It was not possible to retrieve the catalog'].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			ErrorWindow openWith: 'It was not possible to retrieve the catalog'
		].
		

	
	client close.
	
	
! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:49:30' prior: 50994992!
fetchCatalog

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      ^ErrorWindow openWith: 'Server down - It was not possible to retrieve the catalog'].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			ErrorWindow openWith: 'It was not possible to retrieve the catalog'
		].
		

	
	client close.
	
	
! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:49:50' prior: 50994976!
buildDefaultMorphicWindow: anErrorDescription

    self layoutMorph beColumn;
    separation: 10@10;
    axisEdgeWeight: 0.0;
    morphExtent: self defaultExtent;
    addMorph: (LabelMorph contents: anErrorDescription).! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 13:52:40' prior: 50992249!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	|modelTemp|
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	
	modelTemp _ CatalogWindowModel with: aUsername and: aPassword and: aCartID .
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: modelTemp.
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 13:55:39' prior: 50988907!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ (self model catalog) ifNil:[self delete].
	catalog keys do: [: anISBN | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: anISBN) withISBN: anISBN withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:00:35' prior: 50995016!
fetchCatalog

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      ErrorWindow openWith: 'Server down - It was not possible to retrieve the catalog'.
																      catalog _ Dictionary new.].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			ErrorWindow openWith: 'It was not possible to retrieve the catalog'
		].
		

	
	client close.
	! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:00:55' prior: 50995075!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ (self model catalog) ifEmpty:[self delete].
	catalog keys do: [: anISBN | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: anISBN) withISBN: anISBN withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:05:31' prior: 50995100!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasond unknown - It was not possible to retrieve the catalog'
		].
		

	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:06:25' prior: 50995147!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
		].
		

	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:08:15' prior: 50995171!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:09:06' prior: 50989479!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	localCart := Dictionary new.

	self fetchCatalog.

! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:10:11' prior: 50995195!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																	self triggerEvent: #hola with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
		].
			
	client close.
	! !

----SNAPSHOT----(28 November 2021 14:10:15) CuisUniversity-4972.image priorSource: 21226785!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:23:50' prior: 50995228!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																      ^self triggerEvent: #ServerDown with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:25:20' prior: 50990675!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self when: #authenticationFailure evaluate: [:anErrorDescription | self loginErrorWith: anErrorDescription].
	self when: #authenticationSuccess evaluate: [:aUsername :aPassword :aCartId | self loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId ].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!LoginWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:26:17' prior: 50995284!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #authenticationFailure evaluate: [:anErrorDescription | self loginErrorWith: anErrorDescription].
	self model when: #authenticationSuccess evaluate: [:aUsername :aPassword :aCartId | self loginSuccessfulFor: aUsername with:aPassword andObtaining: aCartId ].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:28:48' prior: 50995052!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	|modelTemp|
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	
	modelTemp _ CatalogWindowModel with: aUsername and: aPassword and: aCartID .
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: modelTemp.
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #serverDown evaluate: [:anErrorDescription | ErrorWindow  openWith: anErrorDescription.
													   self delete.
													  ].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:28:53' prior: 50995257!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																      ^self triggerEvent: #serverDown with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:29:54' prior: 50995363!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	[notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog')] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																      ^self triggerEvent: #serverDown with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:31:16' prior: 50995124!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: anISBN | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: anISBN) withISBN: anISBN withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 14:31:44) CuisUniversity-4972.image priorSource: 21235282!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:38:13' prior: 50995392!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ [client httpGet: 'http://localhost:8080/fetchCatalog'] on: Error 
																 do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																      ^self triggerEvent: #serverDown with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:38:21' prior: 50995466!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ [client httpGet: 'http://localhost:8080/fetchCatalog'] on: Error 
															      do:[client close.
																      errorRaised _ 'Server down - It was not possible to retrieve the catalog'.
																      ^self triggerEvent: #serverDown with: errorRaised ].
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:38:47' prior: 50995493!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
			
		].
			
	client close.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:40:01' prior: 50995522!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'
						
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:40:49' prior: 50995544!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #fatalError with: errorRaised.			
		].
			
	client close.
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:41:31' prior: 50995335!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	|modelTemp|
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	
	modelTemp _ CatalogWindowModel with: aUsername and: aPassword and: aCartID .
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: modelTemp.
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:44:33' prior: 50984204!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'Price' ownerExtent: anExtent).
	^ catalogMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:45:07' prior: 50995423!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: (catalog at: aTitle) withISBN: aTitle withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:45:36' prior: 50995632!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withISBN: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:47:14'!
buildCatalogItemRowWithName: aBookName withPrice: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: anISBN).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 14:47:14' prior: 50995653!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.! !

!methodRemoval: CatalogWindow #buildCatalogItemRowWithName:withISBN:withExtent: stamp: 'AF 11/28/2021 14:47:14'!
buildCatalogItemRowWithName: aBookName withISBN: anISBN withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: anISBN ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: anISBN).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:47:41' prior: 50995676!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aPrice).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 14:48:02' prior: 50995736!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).

	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 14:49:06' prior: 50991613!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: '           ' ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 14:49:28' prior: 50995776!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 14:50:07' prior: 50985708!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'AF 11/28/2021 14:53:55' prior: 50992677!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		
		add: 'Moby Dick' -> 1000;
		add: 'Winnie The Pooh' -> 900;
		add: 'Haikyuu!!!!' -> 450;
		add: 'Eragon' -> 1200;
		add: 'The Shining' -> 650;
		"add: 'Eldest' -> 1250;"
		add: 'Legado' -> 1100;
		yourself ! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:10:29' prior: 50992423!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |counterModel|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											  counterModel _ (counterModels at: anAssociation key) value: '0'.
											  self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:10:48' prior: 50995859!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:anAssociation | |counterModel|
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: anAssociation value 
																						   of: anAssociation key
																						withExtent: cartListMorph morphExtent).
											   counterModel _ (counterModels at: anAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 15:21:09'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels localCart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 15:21:06' prior: 50995796!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph _ quantityMorph.
	
	localCart add: aBookTitle -> quantityMorph.
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 15:21:32' prior: 50995905!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	localCart add: aBookTitle -> quantityMorph.
	
	"TO DO: falta agregar boton para agregar al carrito"

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:22:48' prior: 50995585!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	localCart := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:29:25' prior: 50995878!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   localCart at: aBookQuantityAssociation key ifAbsent:[
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: aBookQuantityAssociation value 
																						   of: aBookQuantityAssociation key
																						withExtent: cartListMorph morphExtent)].
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:34:30' prior: 50995979!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   (localCart at: aBookQuantityAssociation key ifAbsent:[
											   cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						   of: aBookQuantityAssociation key
																						withExtent: cartListMorph morphExtent)]) contents.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:42:32' prior: 50996002!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (localCart at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						localCart at: aBookQuantityAssociation key.]).
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:47:25' prior: 50996024!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (localCart at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						localCart at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:49:31'!
updateQuantityMorph: aLabelMorph to: aValue

	|newValue|
	
	newValue _ aLabelMorph content asNumber + aValue.
	
	aLabelMorph content: newValue asString.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:51:45' prior: 50996076!
updateQuantityMorph: aLabelMorph to: aValue

	|newValue|
	
	newValue _ aLabelMorph content asNumber + aValue.
	
	aLabelMorph content: newValue asString.
	aLabelMorph hasUnacceptedEdits: true.
	aLabelMorph acceptContents.
	aLabelMorph resetTextComposition; updateFromTextComposition.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:52:53' prior: 50996084!
updateQuantityMorph: aLabelMorph to: aValue

	|newValue|
	
	newValue _ aLabelMorph contents asNumber + aValue.
	
	aLabelMorph content: newValue asString.
	aLabelMorph hasUnacceptedEdits: true.
	aLabelMorph acceptContents.
	aLabelMorph resetTextComposition; updateFromTextComposition.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:53:28' prior: 50996099!
updateQuantityMorph: aLabelMorph to: aValue

	|newValue|
	
	newValue _ aLabelMorph contents asNumber + aValue.
	
	aLabelMorph contents: newValue asString.
	aLabelMorph hasUnacceptedEdits: true.
	aLabelMorph acceptContents.
	aLabelMorph resetTextComposition; updateFromTextComposition.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 15:53:48' prior: 50996116!
updateQuantityMorph: aLabelMorph to: aValue

	|newValue|
	
	newValue _ aLabelMorph contents asNumber + aValue.
	
	aLabelMorph contents: newValue asString.
! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:09:10' prior: 50991480!
addToCart

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
	
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', anISBN,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !
!Cart methodsFor: 'adding' stamp: 'AF 11/28/2021 16:10:28' prior: 50978056!
add: aQuantity of: anItem

	self assertIsValidQuantity: aQuantity.
	self assertIsValidItem: anItem.

	items add: anItem withOccurrences: aQuantity ! !
!Cart methodsFor: 'assertions' stamp: 'AF 11/28/2021 16:10:48' prior: 50977998!
assertIsValidItem: anItem

	(catalog includesKey: anItem) ifFalse: [ self signalInvalidItem ]! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/28/2021 16:13:46'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 16:13:47'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 16:13:47'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:13:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 16:13:51'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 16:14:17'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 16:14:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 16:14:36'!
PASSED!

----SNAPSHOT----(28 November 2021 16:15:19) CuisUniversity-4972.image priorSource: 21241526!

----STARTUP---- (28 November 2021 16:16:31) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


LoginWindow open.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 16:20:50) CuisUniversity-4972.image priorSource: 21272966!

LoginWindow open.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

LoginWindow open.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:24:54'!
encodeSpacesForUrl: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:26:22' prior: 50996140!
addToCart

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 0!

LoginWindow open.!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 16:29:50' prior: 50995928!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	localCart add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/28/2021 16:34:33' prior: 50989717!
buildAddToCartRowWith: anExtent

    | checkoutButton checkoutRow |
    
        checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #addToCart label: 'Add to cart'.

        checkoutRow := LayoutMorph newRow.
        checkoutRow separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: checkoutButton.

        ^checkoutRow.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:38:11'!
addToCart

	|booksToAdd|

	counterTextMorphs associationsDo: [:aBookCounterAssociation | booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:38:28' prior: 50996528!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterTextMorphs associationsDo: [:aBookCounterAssociation | booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:40:04' prior: 50996537!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterModels associationsDo: [:aBookCounterAssociation | booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value value]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:40:27' prior: 50996547!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterModels associationsDo: [:aBookCounterAssociation | booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value value].
	
	self model addToCart: booksToAdd .! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:41:18'!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !

!methodRemoval: CatalogWindowModel #addToCart stamp: 'AF 11/28/2021 16:41:18'!
addToCart

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	localCart keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:41:27' prior: 50996568!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:45:21' prior: 50996557!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterModels associationsDo: [:aBookCounterAssociation | aBookCounterAssociation value value > 0 
												    ifTrue:[booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value value]].
	
	self model addToCart: booksToAdd .! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:45:58' prior: 50996671!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterModels associationsDo: [:aBookCounterAssociation | aBookCounterAssociation value value asNumber > 0 
												    ifTrue:[booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value value]].
	
	self model addToCart: booksToAdd .! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:47:39' prior: 50996684!
addToCart

	|booksToAdd|

	booksToAdd  _ Dictionary new.	
	counterModels associationsDo: [:aBookCounterAssociation | aBookCounterAssociation value value asNumber > 0 
												    ifTrue:[booksToAdd add: aBookCounterAssociation key -> aBookCounterAssociation value value asNumber]].
	
	self model addToCart: booksToAdd .! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/28/2021 16:50:07' prior: 50992551!
buildCounterMorph: anId
	| numberInputMorph counterMorph arrowDown arrowUp counter arrowsMorph counterId |
	
	counterId _ anId. 
	counter _ ItemCounterModel newWith: counterId.
	numberInputMorph := TextModelMorph textProvider: counter textGetter: #value textSetter: #value:.
	numberInputMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | numberInputMorph innerTextMorph acceptContents.] .
	numberInputMorph morphExtent: 50@20.
	counterModels add: counterId -> counter.
	counterTextMorphs add: counterId -> numberInputMorph. 
	
	arrowUp := PluggableButtonMorph model: counter stateGetter: nil action: #valueUp  label: (Character arrowUp asString).
	arrowUp morphExtent: 25@10. 
	
	arrowDown := PluggableButtonMorph model: counter stateGetter: nil action: #valueDown  label: (Character arrowDown asString) .
	arrowDown morphExtent: 25@10.
	
	counter when: #updateCounter send: #updateCounterTextMorphBasedOn: to: self with: counter.
	
	arrowsMorph := LayoutMorph newColumn.
	arrowsMorph separation: 0.001;
	morphExtent: 25@20;
	addMorph: arrowUp;
	addMorph: arrowDown.
		
	counterMorph := LayoutMorph newRow. 
	counterMorph separation: 0.001;
	morphExtent: 100@50;
	addMorph: numberInputMorph;
	addMorph: arrowsMorph.
	
	^ counterMorph.! !
!CatalogWindow methodsFor: 'auxiliary' stamp: 'AF 11/28/2021 16:50:12' prior: 50992458!
updateCounterTextMorphBasedOn: aCounterModel  
	
	| textMorph counterId counterValue |
	
	counterId _ aCounterModel id.
	counterValue _ aCounterModel value.
	
	textMorph _ (counterTextMorphs at: counterId) innerTextMorph.
	textMorph contents: counterValue.
	textMorph hasUnacceptedEdits: true.
	textMorph acceptContents.
	textMorph resetTextComposition; updateFromTextComposition.
! !

!methodRemoval: CatalogWindowModel #updateLocalCartAt:with: stamp: 'AF 11/28/2021 16:50:46'!
updateLocalCartAt: anISBN with: anAmount

	localCart add: anISBN -> anAmount.
	!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:50:54' prior: 50995219!
initializeWith: aUser and: aPassword and: aCartId

	username := aUser.
	password  := aPassword .
	cartId := aCartId .

	self fetchCatalog.

! !

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 16:51:38'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 16:52:45'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels localCartQuantityMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:52:45' prior: 50996491!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	localCartQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:52:45' prior: 50995952!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	localCartQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:52:45' prior: 50996049!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (localCartQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						localCartQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 16:53:24'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels cartQuantityMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:24' prior: 50996805!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:24' prior: 50996827!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:24' prior: 50996854!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !

!classDefinition: #CatalogWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 16:53:44'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels cartItemsQuantityMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:44' prior: 50996892!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: '' ownerExtent: itemMorph morphExtent).
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:44' prior: 50996914!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:53:44' prior: 50996941!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	aCollectionOfBooksAndQuantitys do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !

----SNAPSHOT----(28 November 2021 16:56:16) CuisUniversity-4972.image priorSource: 21273264!

----End fileIn of C:\Users\ferra\Downloads\Telegram Desktop\CheckoutWindow.st----!

!classDefinition: #CheckoutWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 16:59:40'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 16:59:31' prior: 50997151!
openInitialize
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:27:11' prior: 50997077!
buildCartListHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: '' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/28/2021 17:30:32' prior: 50985191!
buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:33:11'!
checkOut

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			
		] 
		ifFalse: [
			respDict at: 'errorDescription'
		].
	

	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:34:20' prior: 50994646!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseForCheckOutCart: ticket).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:35:42'!
jsonResponseForCheckOutCart: aTicket

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'ticket' -> aTicket ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:39:48'!
convertBagToDictionary: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:39:48' prior: 50997273!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseForCheckOutCart: ticket).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #convertToDictionary: stamp: 'AF 11/28/2021 17:39:48'!
convertToDictionary: aBag
	
	|cartContentsDictionary|

	cartContentsDictionary _ Dictionary new.
	aBag do:[:anItem | cartContentsDictionary add: anItem -> (aBag occurrencesOf: anItem)].
	
	^cartContentsDictionary.!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:41:46'!
convertTicketToDictionary: aTicket
	
	|ticketDictionary|

	ticketDictionary _ Dictionary new.
	aTicket lineItemsDo: [:aLineItem | ticketDictionary add: aLineItem item -> aLineItem total].
	
	^ticketDictionary ! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:42:37' prior: 50997377!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseForListCart: cartContentsDictionary).

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseForCheckOutCart: (self convertTicketToDictionary: ticket)).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 17:43:12' prior: 50997358!
jsonResponseForCheckOutCart: aDictionaryTicket

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'ticket' -> aDictionaryTicket ; yourself)! !

----SNAPSHOT----(28 November 2021 17:43:57) CuisUniversity-4972.image priorSource: 21292960!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:17'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:44:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 17:44:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:44:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:44:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:44:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 17:44:22'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 17:44:22'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/28/2021 17:44:23'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:44:54' prior: 50979409!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:46:16' prior: 50997814!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 15); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:47:05' prior: 50997861!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:47:48' prior: 50997914!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket')
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:47:49' prior: 50997963!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:47:50'!
FAILURE!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:48:23' prior: 50998015!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:48:25'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 17:48:25'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 17:48:25'!
PASSED!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 17:48:37) CuisUniversity-4972.image priorSource: 21309631!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:48:39'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 17:48:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:48:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:48:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:48:39'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 17:48:40'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 17:48:40'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:48:42'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:49:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/28/2021 17:49:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/28/2021 17:49:19'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:49:28' prior: 50979457!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:49:37'!
test05CheckOut

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test05 stamp: 'AF 11/28/2021 17:49:37'!
test05

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:49:44' prior: 50979370!
test04

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:50:00'!
test04ListCart

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test04 stamp: 'AF 11/28/2021 17:50:00'!
test04

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:50:11' prior: 50979340!
test03

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/28/2021 17:50:31'!
test03AddToCart

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test03 stamp: 'AF 11/28/2021 17:50:31'!
test03

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:54:26' prior: 50997249!
checkOut

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			respDict at: 'errorDescription'
		].
	

	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	booksAdded ifNotEmpty: [self triggerEvent: #booksAddedToCart with: booksAdded.]! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:55:14' prior: 50998563!
checkOut

	|client notDecodedResponse respDict raisedErrors |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:55:24' prior: 50998588!
checkOut

	|client notDecodedResponse respDict |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:57:48' prior: 50997001!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow ]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:58:25'!
openWindowWithTicket
  
 	^self new openInitialize.
! !

!methodRemoval: CheckoutWindow class #openWindow stamp: 'AF 11/28/2021 17:58:25'!
openWindow
  
 	^self new openInitialize.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:58:35'!
openWindowWithTicket: aTicket
  
 	^self new openInitialize.
! !

!methodRemoval: CheckoutWindow class #openWindowWithTicket stamp: 'AF 11/28/2021 17:58:35'!
openWindowWithTicket
  
 	^self new openInitialize.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:58:46' prior: 50998666!
openWindowWithTicket: aTicket
  
 	^self new openInitializeWith: aTicket.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:58:55' prior: 50997204!
openInitialize
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:59:03'!
openInitializeWith
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !

!methodRemoval: CheckoutWindow #openInitialize stamp: 'AF 11/28/2021 17:59:03'!
openInitialize
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 17:59:11'!
openInitializeWith: aTicket
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !

!methodRemoval: CheckoutWindow #openInitializeWith stamp: 'AF 11/28/2021 17:59:11'!
openInitializeWith
    
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:10:00'!
buildTicketMorphWith: anExtent

	    | cartListMorph scrollMorph |
	    
	    cartListMorph := LayoutMorph newColumn.
	    scrollMorph := PluggableScrollPane new.
	    scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
	    scroller: cartListMorph.
	    
	    cartListMorph separation: 0@0; 
	    axisEdgeWeight: 0.0.
	    cartListMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	    
	    ^ scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:10:00' prior: 50997133 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Precio total: $');
	addMorph: self testButton.
	
! !

!methodRemoval: CheckoutWindow #buildCartListMorphWith: stamp: 'AF 11/28/2021 18:10:00'!
buildCartListMorphWith: anExtent

	    | cartListMorph scrollMorph |
	    
	    cartListMorph := LayoutMorph newColumn.
	    scrollMorph := PluggableScrollPane new.
	    scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
	    scroller: cartListMorph.
	    
	    cartListMorph separation: 0@0; 
	    axisEdgeWeight: 0.0.
	    cartListMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).
	    
	    ^ scrollMorph.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:10:19'!
buildTicketHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: '' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:10:19' prior: 50998736!
buildTicketMorphWith: anExtent

	    | cartListMorph scrollMorph |
	    
	    cartListMorph := LayoutMorph newColumn.
	    scrollMorph := PluggableScrollPane new.
	    scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
	    scroller: cartListMorph.
	    
	    cartListMorph separation: 0@0; 
	    axisEdgeWeight: 0.0.
	    cartListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	    
	    ^ scrollMorph.! !

!methodRemoval: CheckoutWindow #buildCartListHeaderWithExtent: stamp: 'AF 11/28/2021 18:10:19'!
buildCartListHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: '' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	    ^ catalogMorph.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:11:17' prior: 50998801!
buildTicketMorphWith: anExtent

	    | ticketListMorph scrollMorph |
	    
	    ticketListMorph := LayoutMorph newColumn.
	    scrollMorph := PluggableScrollPane new.
	    scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
	    scroller: ticketListMorph.
	    
	    ticketListMorph separation: 0@0; 
	    axisEdgeWeight: 0.0.
	    ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	    
	    ^ scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:12:45' prior: 50998835!
buildTicketMorphWith: anExtent

	    | ticketListMorph scrollMorph |
	    
	    ticketListMorph := LayoutMorph newColumn.
	    scrollMorph := PluggableScrollPane new.
	    scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
	    scroller: ticketListMorph.
	    
	    ticketListMorph separation: 0@0; 
	    axisEdgeWeight: 0.0.
	    ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	    
	    ^ scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:13:26' prior: 50998784!
buildTicketHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: '' ownerExtent: anExtent);
	    addMorph: (self buildCatalogTableItem: 'Spent' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:14:05'!
buildTicketItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.33).
	^ itemMorph! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:14:05' prior: 50998871!
buildTicketHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: '' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ catalogMorph.! !

!methodRemoval: CheckoutWindow #buildCatalogTableItem:ownerExtent: stamp: 'AF 11/28/2021 18:14:05'!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.33).
	^ itemMorph!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:16:52' prior: 50998627!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWindowWithTicket: aTicket]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

LoginWindow open.!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:23:52' prior: 50998608!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1).
	cco _ self encodeSpacesForUrl: 'Juan Perez'.
	
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:24:02' prior: 50998959!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1).
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !

LoginWindow open.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:25:20' prior: 50998988!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !

----SNAPSHOT----(28 November 2021 18:26:16) CuisUniversity-4972.image priorSource: 21327942!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 18:26:48'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:26:45' prior: 50998714!
openInitializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel new).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:27:14' prior: 50998754 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Precio total: $', self ticketTotal);
	addMorph: self testButton.
	
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:30:12'!
ticketTotal

	|total|
	
	total _ 0.

	^ticket valuesDo: [:aPartialAmountSpent | total _ total + aPartialAmountSpent ]! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:31:00' prior: 50999085!
ticketTotal

	|total|
	
	total _ 0.

	ticket valuesDo: [:aPartialAmountSpent | total _ total + aPartialAmountSpent ].
	
	^total asString.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:32:07' prior: 50998853!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:33:04' prior: 50999103!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:aBookAmmountSpentAssociation | ]


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:33:15' prior: 50998897!
buildTicketHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:35:06' prior: 50999121!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:aBookAmmountSpentAssociation | ticketListMorph].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:36:37'!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:36:50' prior: 50999173!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.0;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:38:08' prior: 50999154!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:38:20' prior: 50999203!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:38:37' prior: 50999226!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:40:30' prior: 50999250!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newRow.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:41:21' prior: 50999274!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x * 0.8) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:42:02' prior: 50999140!
buildTicketHeaderWithExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:42:08' prior: 50999188!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:43:13' prior: 50999297!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x * 0.8) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.0.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:43:20' prior: 50997147 overrides: 50965689!
defaultExtent
	 ^ 600@500
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:46:28' prior: 50999350!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x * 0.5) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:46:39' prior: 50999379!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x * 0.8) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:46:49' prior: 50999403!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:47:10' prior: 50999427!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:48:50' prior: 50999335!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    morphExtent: (anExtent x * 0.9)@(anExtent y);
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:49:19' prior: 50999475!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    morphExtent: (anExtent x * 0.9)@(anExtent y);
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: catalogMorph morphExtent );
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: catalogMorph morphExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:48:50' prior: 50999492!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    morphExtent: (anExtent x * 0.9)@(anExtent y);
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:50:40' prior: 50999510!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | catalogMorph |
	    
	    catalogMorph := LayoutMorph newRow.
	    catalogMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ catalogMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:50:59' prior: 50998887!
buildTicketItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.5).
	^ itemMorph! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:51:09' prior: 50999543!
buildTicketItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph! !

!classDefinition: #CheckoutWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 18:52:01'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CheckoutWindowModel methodsFor: 'no messages' stamp: 'AF 11/28/2021 18:51:56'!
ticketTotal

	|total|
	
	total _ 0.

	ticket valuesDo: [:aPartialAmountSpent | total _ total + aPartialAmountSpent ].
	
	^total asString.! !

!methodRemoval: CheckoutWindow #ticketTotal stamp: 'AF 11/28/2021 18:52:05'!
ticketTotal

	|total|
	
	total _ 0.

	ticket valuesDo: [:aPartialAmountSpent | total _ total + aPartialAmountSpent ].
	
	^total asString.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:52:16' prior: 50999058!
openInitializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel newWith: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:52:22' prior: 50999585!
openInitializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:52:42' prior: 50999451!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key and: anAssociation value asString andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:52:56' prior: 50999611!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !

----SNAPSHOT----(28 November 2021 18:53:21) CuisUniversity-4972.image priorSource: 21356611!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:53:34' prior: 50999071 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Precio total: $', self model ticketTotal);
	addMorph: self testButton.
	
! !
!CheckoutWindowModel class methodsFor: 'no messages' stamp: 'AF 11/28/2021 18:54:33'!
with: aTicket

	^self new initializeWith: aTicket.! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:54:51'!
initializeWith: aTicket


	ticket _ aTicket.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:55:18'!
ticket
	self shouldBeImplemented.
	^ticket! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:55:20' prior: 50999690!
ticket
	
	^ticket! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:57:06'!
initializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:57:06' prior: 50998676!
openWindowWithTicket: aTicket
  
 	^self new initializeWith: aTicket.
! !

!methodRemoval: CheckoutWindow #openInitializeWith: stamp: 'AF 11/28/2021 18:57:06'!
openInitializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:59:21' prior: 50998923!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWindowWithTicket: aTicket].
	self model when: #checkOutFailure evaluate: [:aTicket | ErrorWindow openWithTicket: aTicket]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:59:36' prior: 50999730!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWindowWithTicket: aTicket].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWithTicket: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 18:59:57' prior: 50999764!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWindowWithTicket: aTicket].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:00:27'!
openWithTicket: aTicket
  
 	^self new initializeWith: aTicket.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:00:27' prior: 50999798!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: CheckoutWindow class #openWindowWithTicket: stamp: 'AF 11/28/2021 19:00:27'!
openWindowWithTicket: aTicket
  
 	^self new initializeWith: aTicket.
!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:01:22' prior: 50999017!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '111122223333444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:02:02' prior: 50999877!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:02:34' prior: 50999908!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber - 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:03:03' prior: 50990117 overrides: 50965689!
defaultExtent

	^600@200.! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:06:21' prior: 50999937!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #checkOutFailure with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:07:54' prior: 50997161!
testButton

	
	   | checkoutButton checkoutRow checkoutButton2|

	    checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #logout  label: 'Logout'.
	    checkoutButton2 := PluggableButtonMorph model: self model stateGetter: nil action: #newPurchase  label: 'New Purchase'.

	    checkoutRow := LayoutMorph newRow.
	    checkoutRow separation: 50@0;
	    axisEdgeWeight: 0.5;
	    morphExtent: self defaultExtent;
	    addMorph: checkoutButton;
	    addMorph: checkoutButton2.

	    ^checkoutRow.
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:08:19' prior: 50999838!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:08:43'!
logout
	self shouldBeImplemented.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:09:12' prior: 51000061!
logout
	
	LoginWindow open .
	self delete.! !

!classDefinition: #CheckoutWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:12:14'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: 'ticket username'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:12:15'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: 'ticket username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:12:06'!
newPurchase

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self username,'&password=',self password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	
	client close.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:12:45'!
buildButtons

	
	   | checkoutButton checkoutRow checkoutButton2|

	    checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #logout  label: 'Logout'.
	    checkoutButton2 := PluggableButtonMorph model: self model stateGetter: nil action: #newPurchase  label: 'New Purchase'.

	    checkoutRow := LayoutMorph newRow.
	    checkoutRow separation: 50@0;
	    axisEdgeWeight: 0.5;
	    morphExtent: self defaultExtent;
	    addMorph: checkoutButton;
	    addMorph: checkoutButton2.

	    ^checkoutRow.
	! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:12:45' prior: 50999664 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Precio total: $', self model ticketTotal);
	addMorph: self buildButtons.
	
! !

!methodRemoval: CheckoutWindow #testButton stamp: 'AF 11/28/2021 19:12:45'!
testButton

	
	   | checkoutButton checkoutRow checkoutButton2|

	    checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #logout  label: 'Logout'.
	    checkoutButton2 := PluggableButtonMorph model: self model stateGetter: nil action: #newPurchase  label: 'New Purchase'.

	    checkoutRow := LayoutMorph newRow.
	    checkoutRow separation: 50@0;
	    axisEdgeWeight: 0.5;
	    morphExtent: self defaultExtent;
	    addMorph: checkoutButton;
	    addMorph: checkoutButton2.

	    ^checkoutRow.
	!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:13:56'!
initializeWith: aTicket for: aUserName 

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:13:56' prior: 50999832!
openWithTicket: aTicket
  
 	^self new initializeWith: aTicket for: username.
! !

!methodRemoval: CheckoutWindow #initializeWith: stamp: 'AF 11/28/2021 19:13:56'!
initializeWith: aTicket

	ticket _ aTicket.   

 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:14:22'!
openWithTicket: aTicket fro: aUsername 
  
 	^self new initializeWith: aTicket for: username.
! !

!methodRemoval: CheckoutWindow class #openWithTicket: stamp: 'AF 11/28/2021 19:14:22'!
openWithTicket: aTicket
  
 	^self new initializeWith: aTicket for: username.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:14:29'!
openWithTicket: aTicket for: aUsername 
  
 	^self new initializeWith: aTicket for: username.
! !

!methodRemoval: CheckoutWindow class #openWithTicket:fro: stamp: 'AF 11/28/2021 19:14:29'!
openWithTicket: aTicket fro: aUsername 
  
 	^self new initializeWith: aTicket for: username.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:14:34' prior: 51000205!
openWithTicket: aTicket for: aUsername 
  
 	^self new initializeWith: aTicket for: aUsername.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:15:07' prior: 51000024!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:16:51' prior: 51000163!
initializeWith: aTicket for: aUsername 

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:17:04' prior: 51000261!
initializeWith: aTicket for: aUsername 

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !

Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:17:12'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:17:40'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:17:47'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: 'userTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Panel subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 19:17:52'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:18:26'!
initializeWith: aTicket for: aUsername 


	ticket _ aTicket.! !
!CheckoutWindowModel class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:18:26' prior: 50999678!
with: aTicket

	^self new initializeWith: aTicket for: aUsername.! !

!methodRemoval: CheckoutWindowModel #initializeWith: stamp: 'AF 11/28/2021 19:18:26'!
initializeWith: aTicket


	ticket _ aTicket.!
!CheckoutWindowModel class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:19:00'!
with: aTicket for: aUsername 

	^self new initializeWith: aTicket for: aUsername.! !

!methodRemoval: CheckoutWindowModel class #with: stamp: 'AF 11/28/2021 19:19:00'!
with: aTicket

	^self new initializeWith: aTicket for: aUsername.!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:19:59'!
openWithTicket: aTicket for: aUsername and: aPassword  
  
 	^self new initializeWith: aTicket for: aUsername.
! !

!methodRemoval: CheckoutWindow class #openWithTicket:for: stamp: 'AF 11/28/2021 19:19:59'!
openWithTicket: aTicket for: aUsername 
  
 	^self new initializeWith: aTicket for: aUsername.
!
!CheckoutWindow class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:20:11' prior: 51000367!
openWithTicket: aTicket for: aUsername and: aPassword  
  
 	^self new initializeWith: aTicket for: aUsername and: aPassword .
! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:20:35'!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !

!methodRemoval: CheckoutWindow #initializeWith:for: stamp: 'AF 11/28/2021 19:20:35'!
initializeWith: aTicket for: aUsername 

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
!
!CheckoutWindowModel class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:20:55'!
with: aTicket for: aUsername and: aPassword  

	^self new initializeWith: aTicket for: aUsername.! !

!methodRemoval: CheckoutWindowModel class #with:for: stamp: 'AF 11/28/2021 19:20:55'!
with: aTicket for: aUsername 

	^self new initializeWith: aTicket for: aUsername.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:21:08' prior: 51000387!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!CheckoutWindowModel class methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:21:24' prior: 51000412!
with: aTicket for: aUsername and: aPassword  

	^self new initializeWith: aTicket for: aUsername and: aPassword.! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:21:41'!
initializeWith: aTicket for: aUsername and: aPassword  


	ticket _ aTicket.! !

!methodRemoval: CheckoutWindowModel #initializeWith:for: stamp: 'AF 11/28/2021 19:21:41'!
initializeWith: aTicket for: aUsername 


	ticket _ aTicket.!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:21:58' prior: 51000445!
initializeWith: aTicket for: aUsername and: aPassword  


	ticket _ aTicket.
	username _ aUsername.
	password _ aPassword.! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:22:31' prior: 51000087!
newPurchase

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',username,'&password=',password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	
	client close.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:25:08' prior: 51000424!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.


	self model when: #newPurchase evaluate: [:aCartId | CatalogWindow openWithUser: self model username andPass: self model password andCart: aCartId ].! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:27:36' prior: 51000464!
newPurchase

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',username,'&password=',password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #newPurchase  with:cartId
			
		] 
		ifFalse: [
			
			self triggerEvent: #logout
		].
	
	
	client close.! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:27:40' prior: 51000505!
newPurchase

	|client notDecodedResponse respDict |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/createCart?clientId=',username,'&password=',password ).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #newPurchase  with: cartId
			
		] 
		ifFalse: [
			
			self triggerEvent: #logout
		].
	
	
	client close.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:28:22' prior: 51000486!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.


	self model when: #newPurchase evaluate: [:aCartId | CatalogWindow openWithUser: self model username andPass: self model password andCart: aCartId ].
	self model when: #logout evaluate: [:aCartId | self logout ].! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:28:50' prior: 51000543!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.


	self model when: #newPurchase evaluate: [:aCartId | CatalogWindow openWithUser: self model username andPass: self model password andCart: aCartId.
											 	self delete.].
	self model when: #logout evaluate: [:aCartId | self logout ].! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:30:05' prior: 51000225!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly: aValue].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:30:45'!
password

	^password.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:31:35' prior: 51000564!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.


	self model when: #newPurchase evaluate: [:aCartId | CatalogWindow openWithUser: self model username andPass: self model password andCart: aCartId.
											 	self delete.].
	self model when: #logout evaluate: [self logout ].! !

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'validUser' andPass: 'asdas' andCart: 1!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 1!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:33:02'!
username
	self shouldBeImplemented.
	^username! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:33:07' prior: 51000657!
username

	^username! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:33:22'!
password
	self shouldBeImplemented.
	^password! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:33:24' prior: 51000666!
password
	
	^password! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 1!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

----SNAPSHOT----(28 November 2021 19:36:13) CuisUniversity-4972.image priorSource: 21376280!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:36:57' prior: 50988933!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.3);
	addMorph: (LabelMorph contents: 'Purchase history');
	addMorph: (LabelMorph contents: 'Logout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3);
	addMorph:  (LabelMorph contents:'Welcome, ',self model username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:38:22' prior: 51000682!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.3);
	addMorph: (PluggableButtonMorph model: self model stateGetter: nil action: #purchaseHistory label: 'Purchase history');
	addMorph: (PluggableButtonMorph model: self stateGetter: nil action: #logout label: 'Logout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3);
	addMorph:  (LabelMorph contents:'Welcome, ',self model username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 19:38:37'!
logout
	
	LoginWindow open .
	self delete.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

----SNAPSHOT----(28 November 2021 20:09:37) CuisUniversity-4972.image priorSource: 21408892!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

Panel subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #PurchaseHistoryWindow category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:11:54'!
Panel subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

Object subclass: #PurchaseHistoryModel
	instanceVariableNames: 'ticket username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #PurchaseHistoryModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:12:06'!
Object subclass: #PurchaseHistoryModel
	instanceVariableNames: 'ticket username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRenamed: #PurchaseHistoryModel as: #PurchaseHistoryWindowModel stamp: 'AF 11/28/2021 20:15:28'!
Smalltalk renameClassNamed: #PurchaseHistoryModel as: #PurchaseHistoryWindowModel!
!PurchaseHistoryWindow class methodsFor: 'no messages' stamp: 'AF 11/28/2021 20:15:50'!
openFor: aUsername and: aPassword  
  
 	^self new initializeFor: aUsername and: aPassword .
! !
!PurchaseHistoryWindow methodsFor: 'nil' stamp: 'AF 11/28/2021 20:16:51'!
initializeFor: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!PurchaseHistoryWindowModel class methodsFor: 'no messages' stamp: 'AF 11/28/2021 20:17:32'!
for: aUsername and: aPassword 

	^self new initializeFor: aUsername and: aPassword .! !
!PurchaseHistoryWindowModel methodsFor: 'no messages' stamp: 'AF 11/28/2021 20:17:43'!
initializeFor: aUsername and: aPassword! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:18:15' prior: 51000804!
initializeFor: aUsername and: aPassword

	username _ aUsername.
	password  _ aPassword.
	! !

Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #PurchaseHistoryWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:18:23'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:19:03' prior: 51000809!
initializeFor: aUsername and: aPassword

	username _ aUsername.
	password  _ aPassword.
	
	
	self listPurchases.! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:19:11'!
listPurchases

	! !

!classDefinition: #PurchaseHistoryWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:22:04'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password purchases'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:22:03' prior: 51000837!
listPurchases

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #fatalError with: errorRaised.			
		].
			
	client close.

	! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:22:15' prior: 51000851!
listPurchases

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #fatalError with: errorRaised.			
		].
			
	client close.

	! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:25:29' prior: 51000873!
listPurchases

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription').			
		].
			
	client close.

	! !

----SNAPSHOT----(28 November 2021 20:26:09) CuisUniversity-4972.image priorSource: 21410831!

!classDefinition: #PurchaseHistoryWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:37:17'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password purchases error'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:37:12' prior: 51000895!
listPurchases

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			error _ responseDictionary at: 'errorDescription'
		].
			
	client close.

	! !

!classDefinition: #PurchaseHistoryWindowModel category: 'TusLibros-Graphics' stamp: 'AF 11/28/2021 20:37:24'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password purchases errorMessage'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:37:24' prior: 51000927!
listPurchases

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			errorMessage _ responseDictionary at: 'errorDescription'
		].
			
	client close.

	! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:38:53' overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Precio total: $', self model ticketTotal);
	addMorph: self buildButtons.
	
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:39:13' overrides: 50965689!
defaultExtent
	 ^ 600@500
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:47:19' prior: 51000975 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Purchase History');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Total spent: $', self model purchasesTotal).! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:47:37' prior: 51000130 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildTicketMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Total spent: $', self model ticketTotal);
	addMorph: self buildButtons.
	
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:48:51' prior: 51000785!
initializeFor: aUsername and: aPassword  
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:48:54' prior: 51001025!
initializeFor: aUsername and: aPassword 
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:48:55' prior: 51001038!
initializeFor: aUsername and: aPassword
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.
! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:49:18' prior: 51000995 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Purchase History');
	addMorph: (self buildListMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Total spent: $', self model purchasesTotal).! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:50:36'!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model purchases associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:51:05' prior: 50999527!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:51:56' prior: 51001103!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:52:29'!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:52:57' prior: 51001133!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:53:17'!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:54:51' prior: 51001163!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^itemMorph! !

----SNAPSHOT----(28 November 2021 20:56:53) CuisUniversity-4972.image priorSource: 21416418!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:58:03' prior: 51000706!
buildShopHeader

	| firstRowLayoutMorph headerButtonsMorph |
		
	headerButtonsMorph := LayoutMorph newRow.
	headerButtonsMorph separation: 25@1;
	axisEdgeWeight: 1.0;
	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.3);
	addMorph: (PluggableButtonMorph model: self stateGetter: nil action: #purchaseHistory label: 'Purchase history');
	addMorph: (PluggableButtonMorph model: self stateGetter: nil action: #logout label: 'Logout').
	
	
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@(self defaultExtent y * 0.3);
	addMorph:  (LabelMorph contents:'Welcome, ',self model username,'!!');
	addMorph: headerButtonsMorph.
	
	^firstRowLayoutMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 20:59:01'!
purchaseHistory	

	PurchaseHistoryWindow openFor: self model username and: self model password.
! !

LoginWindow open.!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:01:26' prior: 51000956!
listPurchases

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=', username,'&password=', password).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			errorMessage _ responseDictionary at: 'errorDescription'
		].
			
	client close.

	! !

LoginWindow open.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

LoginWindow open.!

LoginWindow open.!

LoginWindow open.!
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:21:55' prior: 51001079!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model purchases associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:22:01'!
buildListHeaderWithExtent: aPoint 
	self shouldBeImplemented.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:22:10' prior: 51001270!
buildListHeaderWithExtent: anExtent 


	! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:22:31' prior: 50999321!
buildTicketHeaderWithExtent: anExtent
	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:23:17' prior: 51001276!
buildListHeaderWithExtent: anExtent 

	| catalogMorph |
	    
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 0@0; 
	axisEdgeWeight: 0.5;
	addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	^ catalogMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:23:24' prior: 51001295!
buildListHeaderWithExtent: anExtent 

	| headerMorph |
	    
	headerMorph := LayoutMorph newRow.
	headerMorph separation: 0@0; 
	axisEdgeWeight: 0.5;
	addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	^ headerMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:23:53' prior: 51001308!
buildListHeaderWithExtent: anExtent 

	| headerMorph |
	    
	headerMorph := LayoutMorph newRow.
	headerMorph separation: 0@0; 
	axisEdgeWeight: 0.5;
	addMorph: (self buildItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildItem: 'Spent' ownerExtent: anExtent).
	^ headerMorph.! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:23:57'!
purchases
	self shouldBeImplemented.
	^purchases! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:24:01' prior: 51001334!
purchases

	^purchases! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:24:10'!
purchasesTotal
	self shouldBeImplemented.! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:25:29' prior: 51001344!
purchasesTotal
	
	|total|
	
	total _ 0.
	purchases associationsDo: [: anAssociation | total _ total + anAssociation value].
	
	^total.! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:26:45' prior: 51001349!
purchasesTotal
	
	|total|
	
	total _ 0.
	purchases associationsDo: [: anAssociation | total _ total + anAssociation value].
	
	^total asString.! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 21:29:52' prior: 50978664!
jsonResponseForListPurchases: purchasesDictionary
	purchasesDictionary ifEmpty: [ purchasesDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'purchases' -> purchasesDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/28/2021 21:30:05' prior: 50978655!
jsonResponseForListCart: cartContentsDictionary

	cartContentsDictionary ifEmpty: [ cartContentsDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself)! !

----SNAPSHOT----(28 November 2021 21:30:40) CuisUniversity-4972.image priorSource: 21425001!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 21:31:16) CuisUniversity-4972.image priorSource: 21431540!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:35:55' prior: 50997028!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	| cartContents |
	cartContents _ self model listCart.

	cartContents do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:37:51'!
updateBooksSentSuccessfuly

	| cartContents |
	cartContents _ self model listCart.

	cartContents do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:37:51' prior: 51000588!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [:aValue | self updateBooksSentSuccessfuly].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: CatalogWindow #updateBooksSentSuccessfuly: stamp: 'AF 11/28/2021 21:37:51'!
updateBooksSentSuccessfuly: aCollectionOfBooksAndQuantitys

	| cartContents |
	cartContents _ self model listCart.

	cartContents do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:38:18' prior: 51001458!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [self updateBooksSentSuccessfuly].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:38:37'!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.

	cartContents do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:38:37' prior: 51001523!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [self updateCartContents].
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: CatalogWindow #updateBooksSentSuccessfuly stamp: 'AF 11/28/2021 21:38:37'!
updateBooksSentSuccessfuly

	| cartContents |
	cartContents _ self model listCart.

	cartContents do: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:39:31' prior: 50996634!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [ErrorWindow openWith: 'The following books could not be added' and: raisedErrors].
	
	self triggerEvent: #booksAddedToCart! !

LoginWindow open.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:40:25'!
listCart
	self shouldBeImplemented.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:40:28' prior: 51001685!
listCart
	
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:44:43' prior: 51001690!
listCart

	|client notDecodedResponse responseDictionary cartContents |
	client _ WebClient new.
	
	cartContents _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			cartContents _ responseDictionary at: 'cartContents'
		] 
		ifFalse: [
			
		].
			
	client close.
	
	^cartContents.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:45:16' prior: 51001694!
listCart

	|client notDecodedResponse responseDictionary cartContents |
	client _ WebClient new.
	
	cartContents _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId asString).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			cartContents _ responseDictionary at: 'cartContents'
		] 
		ifFalse: [
			
		].
			
	client close.
	
	^cartContents.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 21:51:03) CuisUniversity-4972.image priorSource: 21431856!

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:52:21' prior: 51001558!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.

	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   self updateQuantityMorph: quantityMorph to: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:53:37' prior: 50996131!
updateQuantityMorph: aLabelMorph to: aValue

	
	aLabelMorph contents: aValue asString.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:54:38' prior: 51001738!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.

	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   quantityMorph contents: aBookQuantityAssociation value.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:54:46' prior: 51001773!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.

	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   quantityMorph contents: aBookQuantityAssociation value asString.
											   counterModel _ (counterModels at: aBookQuantityAssociation key) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]! !

!methodRemoval: CatalogWindow #updateQuantityMorph:to: stamp: 'AF 11/28/2021 21:54:49'!
updateQuantityMorph: aLabelMorph to: aValue

	
	aLabelMorph contents: aValue asString.
!

LoginWindow open.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:57:10' prior: 51001651!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [self triggerEvent: #Error withArguments: { 'The following books could not be added'. raisedErrors}].
	
	self triggerEvent: #booksAddedToCart! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 21:57:30' prior: 51001836!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors booksAdded |
	client _ WebClient new.
	booksAdded _ OrderedCollection new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifTrue: [
				booksAdded add: anISBN -> aQuantity.
			] 
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [self triggerEvent: #MultipleErrors withArguments: { 'The following books could not be added'. raisedErrors}].
	
	self triggerEvent: #booksAddedToCart! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:06:23' prior: 51001587!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [self updateCartContents].
	self model when: #MultipleErrors evaluate: [:anErrorLabel :aCollectionOfErrorMessages | ErrorWindow openWith: anErrorLabel and: aCollectionOfErrorMessages].
	
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:07:01' prior: 51001904!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [self updateCartContents].
	self model when: #MultipleErrors evaluate: [:anErrorLabel :aCollectionOfErrorMessages | ErrorWindow openWith: anErrorLabel 
																						    and: aCollectionOfErrorMessages].
	
	self model when: #fatalError evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
													   self delete].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #checkOutFailure evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:08:14' prior: 50999975!
checkOut

	|client notDecodedResponse respDict cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(respDict at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (respDict at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (respDict at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:08:47' prior: 50995564!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ 'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #Error with: errorRaised.			
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:09:53' prior: 51002016!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ (responseDictionary at: 'error description'),'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #Error with: errorRaised.			
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:10:10' prior: 51002037!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ (responseDictionary at: 'errorDescription'),'Reasons unknown - It was not possible to retrieve the catalog'.
			self triggerEvent: #Error with: errorRaised.			
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:10:18' prior: 51002060!
fetchCatalog

	|client notDecodedResponse responseDictionary errorRaised|
	client _ WebClient new.
	
	catalog _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ (responseDictionary at: 'errorDescription'),' - It was not possible to retrieve the catalog'.
			self triggerEvent: #Error with: errorRaised.			
		].
			
	client close.
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:10:42' prior: 51001713!
listCart

	|client notDecodedResponse responseDictionary cartContents |
	client _ WebClient new.
	
	cartContents _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId asString).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			cartContents _ responseDictionary at: 'cartContents'
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
			
	client close.
	
	^cartContents.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:10:54' prior: 51001987!
checkOut

	|client notDecodedResponse responseDictionary cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	
	client close.
	! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:12:46' prior: 51001945!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksAddedToCart evaluate: [self updateCartContents].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #MultipleErrors evaluate: [:anErrorLabel :aCollectionOfErrorMessages | ErrorWindow openWith: anErrorLabel 
																						    and: aCollectionOfErrorMessages].	
	self model when: #Error evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:18:32' prior: 51001801!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.
	cartContents at: '' ifAbsent:[
	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]).
											   quantityMorph contents: aBookQuantityAssociation value asString.
											   counterModel _ (counterModels at: aBookQuantityAssociation key ) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]
						 ]! !

LoginWindow open.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:20:36' prior: 51002126!
checkOut

	|client notDecodedResponse responseDictionary cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber - 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	
	client close.
	! !

LoginWindow open.!
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:21:24' prior: 50995039!
buildDefaultMorphicWindow: anErrorDescription

    self layoutMorph beColumn;
    separation: 10@10;
    axisEdgeWeight: 0.5;
    morphExtent: self defaultExtent;
    addMorph: (LabelMorph contents: anErrorDescription).! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:21:54' prior: 51002225!
checkOut

	|client notDecodedResponse responseDictionary cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	
	client close.
	! !

----SNAPSHOT----(28 November 2021 22:22:10) CuisUniversity-4972.image priorSource: 21442642!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(28 November 2021 22:23:24) CuisUniversity-4972.image priorSource: 21460619!
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:25:58' prior: 51001221!
listPurchases

	|client notDecodedResponse responseDictionary |
	client _ WebClient new.
	
	purchases _ Dictionary new.
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=', username,'&password=', password).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
			
	client close.

	! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:27:43' prior: 51001051!
initializeFor: aUsername and: aPassword
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.

	
	self model when: #Error evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription ]! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/28/2021 22:28:02' prior: 51002330!
initializeFor: aUsername and: aPassword
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.

	
	self model when: #Error evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
												self delete ]! !

----SNAPSHOT----(28 November 2021 22:29:10) CuisUniversity-4972.image priorSource: 21460935!

----SNAPSHOT----(28 November 2021 22:29:41) CuisUniversity-4972.image priorSource: 21462762!

----SNAPSHOT----(28 November 2021 22:31:28) CuisUniversity-4972.image priorSource: 21462856!

----SNAPSHOT----(28 November 2021 22:36:31) CuisUniversity-4972.image priorSource: 21462950!

----STARTUP---- (29 November 2021 00:12:17) as D:\001.Maca\2c2021\inge1\qaGraphic\CuisUniversity-4972.image!


!classRemoval: #LoginWindowModel stamp: 'MK 11/29/2021 00:12:28'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username password response'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ItemCounterModel stamp: 'MK 11/29/2021 00:12:28'!
Object subclass: #ItemCounterModel
	instanceVariableNames: 'value id'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindowModel stamp: 'MK 11/29/2021 00:12:29'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #LoginWindow stamp: 'MK 11/29/2021 00:12:29'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ErrorWindow stamp: 'MK 11/29/2021 00:12:29'!
Panel subclass: #ErrorWindow
	instanceVariableNames: 'errors name dictionaryOfErrors'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindow stamp: 'MK 11/29/2021 00:12:30'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'username password counters'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #StoreTestObjectsFactory stamp: 'MK 11/29/2021 00:12:34'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #ManualClock stamp: 'MK 11/29/2021 00:12:35'!
Clock subclass: #ManualClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosSystemFacadeTest stamp: 'MK 11/29/2021 00:12:35'!
TestCase subclass: #TusLibrosSystemFacadeTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosRestAPIInterfaceTest stamp: 'MK 11/29/2021 00:12:36'!
TestCase subclass: #TusLibrosRestAPIInterfaceTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CashierTest stamp: 'MK 11/29/2021 00:12:36'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CartTest stamp: 'MK 11/29/2021 00:12:36'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosSystemFacade stamp: 'MK 11/29/2021 00:12:40'!
Object subclass: #TusLibrosSystemFacade
	instanceVariableNames: 'validUsersAndPasswords catalog lastId merchantProcessor salesBook clock cartSessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #TusLibrosRestAPIInterface stamp: 'MK 11/29/2021 00:12:41'!
Object subclass: #TusLibrosRestAPIInterface
	instanceVariableNames: 'port webServer systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Ticket stamp: 'MK 11/29/2021 00:12:41'!
Object subclass: #Ticket
	instanceVariableNames: 'lineItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Sale stamp: 'MK 11/29/2021 00:12:42'!
Object subclass: #Sale
	instanceVariableNames: 'customer ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #MerchantProcessor stamp: 'MK 11/29/2021 00:12:42'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #LineItem stamp: 'MK 11/29/2021 00:12:42'!
Object subclass: #LineItem
	instanceVariableNames: 'item quantity total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CreditCard stamp: 'MK 11/29/2021 00:12:43'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Clock stamp: 'MK 11/29/2021 00:12:43'!
Object subclass: #Clock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cashier stamp: 'MK 11/29/2021 00:12:44'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard owner ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CartSession stamp: 'MK 11/29/2021 00:12:44'!
Object subclass: #CartSession
	instanceVariableNames: 'owner cart lastUsedTime systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cart stamp: 'MK 11/29/2021 00:12:45'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

----End fileIn of D:\001.Maca\2c2021\inge1\qaGraphic\TusLibros-Model.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qaGraphic\TusLibros-Tests.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\qaGraphic\TusLibros-Graphics.st----!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphic interface tests' stamp: 'MK 11/29/2021 00:15:26'!
startTestServerAndLogicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #startTestServerAndGraphicInterface stamp: 'MK 11/29/2021 00:15:26'!
startTestServerAndGraphicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphic interface tests' stamp: 'MK 11/29/2021 00:15:31'!
startTestServerAndLoginInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #startTestServerAndLogicInterface stamp: 'MK 11/29/2021 00:15:31'!
startTestServerAndLogicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphic interface tests' stamp: 'MK 11/29/2021 00:15:42'!
startTestServerAndShopInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphic interface tests' stamp: 'MK 11/29/2021 00:20:16' prior: 50979699!
startTestServerAndShopInterface

	|server cart |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	cart _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	
	CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: cart.
	
	^ server.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'MK 11/29/2021 00:21:57'!
advanceTime: aDuration

	systemFacade advanceTime: aDuration.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'MK 11/29/2021 00:24:08'!
advanceTimeAndExpireSession

	systemFacade advanceTime: systemFacade sessionDuration + 1 minutes.! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #advanceTime: stamp: 'MK 11/29/2021 00:24:12'!
advanceTime: aDuration

	systemFacade advanceTime: aDuration.!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeAndExpireSession.!

!classRemoval: #PurchaseHistoryWindowModel stamp: 'MK 11/29/2021 00:24:51'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password purchases errorMessage'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #LoginWindowModel stamp: 'MK 11/29/2021 00:24:52'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username password response'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ItemCounterModel stamp: 'MK 11/29/2021 00:24:52'!
Object subclass: #ItemCounterModel
	instanceVariableNames: 'value id'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CheckoutWindowModel stamp: 'MK 11/29/2021 00:24:53'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: 'ticket username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindowModel stamp: 'MK 11/29/2021 00:24:53'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #PurchaseHistoryWindow stamp: 'MK 11/29/2021 00:24:54'!
Panel subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #LoginWindow stamp: 'MK 11/29/2021 00:24:54'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ErrorWindow stamp: 'MK 11/29/2021 00:24:54'!
Panel subclass: #ErrorWindow
	instanceVariableNames: 'dictionaryOfErrors'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CheckoutWindow stamp: 'MK 11/29/2021 00:24:55'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindow stamp: 'MK 11/29/2021 00:24:55'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels cartItemsQuantityMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

----End fileIn of D:\001.Maca\2c2021\inge1\repoEntrega\20-TusLibros\Iteracion-4\TusLibros-Graphics.st----!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeAndExpireSession.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphic interface tests' stamp: 'MK 11/29/2021 00:25:33' prior: 50979709!
startTestServerAndShopInterface

	|server cart |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	cart _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	
	CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: cart.
	
	^ server.! !

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeAndExpireSession.!

----SNAPSHOT----(29 November 2021 00:26:30) CuisUniversity-4972.image priorSource: 20616037!

TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

----SNAPSHOT----(29 November 2021 00:26:41) CuisUniversity-4972.image priorSource: 20787518!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeAndExpireSession.!

TusLibrosRestAPIInterface allInstances!

CatalogWindow openWithUser: 'maca' andPass: 'maca' andCart: '1'!

----STARTUP---- (29 November 2021 00:30:52) as D:\001.Maca\2c2021\inge1\QAGraphic2\CuisUniversity-4972.image!


----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\System\Collections-CompactArrays.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\Features\Compression.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\Features\Sound.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\Features\Cryptography-DigitalSignatures.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\Features\Identities-UUID.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\System\Network-Kernel.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\WebClient.pck.st----!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 00:31:55'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/29/2021 00:31:55'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\Packages\Features\Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 00:31:57'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/29/2021 00:31:57'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\Morphic-Misc1.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\Morphic-Widgets-Extras.pck.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\TusLibros-Model.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\TusLibros-Tests.st----!

----End fileIn of D:\001.Maca\2c2021\inge1\QAGraphic2\cosasInstalar\TusLibros-Graphics.st----!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphics testing' stamp: 'MK 11/29/2021 00:34:43'!
startTestServerAndLoginInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #startTestServerAndGraphicInterface stamp: 'MK 11/29/2021 00:34:43'!
startTestServerAndGraphicInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndLoginInterface.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphics testing' stamp: 'MK 11/29/2021 00:35:37'!
startTestServerAndShopInterface

	|server|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	LoginWindow open.
	
	^ server.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphics testing' stamp: 'MK 11/29/2021 00:36:39' prior: 50974552!
startTestServerAndShopInterface

	|server cart |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	cart _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword 
	
	CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: cart.
	
	^ server.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphics testing' stamp: 'MK 11/29/2021 00:36:59' prior: 50974562!
startTestServerAndShopInterface

	|server cart |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	cart _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	
	CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: cart.
	
	^ server.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'encoding' stamp: 'MK 11/29/2021 00:37:34'!
advanceTimeToExpireSession

	clock advanceTime: systemFacade sessionDuration + 1 minutes! !

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndLoginInterface.
test advanceTimeToExpireSession.!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeToExpireSession.!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
!

TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

----SNAPSHOT----(29 November 2021 00:40:09) CuisUniversity-4972.image priorSource: 18974255!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.!

CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: '1'.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'graphics testing' stamp: 'MK 11/29/2021 00:41:47' prior: 50974577!
startTestServerAndShopInterface

	|server cart |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	cart _ systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	
	CatalogWindow openWithUser: self validUser andPass: self validUserPassword andCart: cart.

	^ server.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: '1'.!


TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

----SNAPSHOT----(29 November 2021 00:53:17) CuisUniversity-4972.image priorSource: 20574734!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeToExpireSession.!

TusLibrosRestAPIInterface allInstancesDo: [:i | i destroy.].!

| test |
test _ TusLibrosRestAPIInterfaceTest new.
test startTestServerAndShopInterface.
test advanceTimeToExpireSession.!

----SNAPSHOT----(29 November 2021 01:09:24) CuisUniversity-4972.image priorSource: 20575619!

----STARTUP---- (29 November 2021 09:51:55) as C:\Users\ferra\Desktop\windows64\CuisUniversity-4972.image!


!classRemoval: #PurchaseHistoryWindowModel stamp: 'AF 11/29/2021 09:52:16'!
Object subclass: #PurchaseHistoryWindowModel
	instanceVariableNames: 'username password purchases errorMessage'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #LoginWindowModel stamp: 'AF 11/29/2021 09:52:17'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'username password response'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ItemCounterModel stamp: 'AF 11/29/2021 09:52:17'!
Object subclass: #ItemCounterModel
	instanceVariableNames: 'value id'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CheckoutWindowModel stamp: 'AF 11/29/2021 09:52:17'!
Object subclass: #CheckoutWindowModel
	instanceVariableNames: 'ticket username password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindowModel stamp: 'AF 11/29/2021 09:52:17'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'username password cartId catalog'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #PurchaseHistoryWindow stamp: 'AF 11/29/2021 09:52:18'!
Panel subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #LoginWindow stamp: 'AF 11/29/2021 09:52:18'!
Panel subclass: #LoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph errorMessageMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #ErrorWindow stamp: 'AF 11/29/2021 09:52:18'!
Panel subclass: #ErrorWindow
	instanceVariableNames: 'dictionaryOfErrors'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CheckoutWindow stamp: 'AF 11/29/2021 09:52:18'!
Panel subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #CatalogWindow stamp: 'AF 11/29/2021 09:52:19'!
Panel subclass: #CatalogWindow
	instanceVariableNames: 'counterTextMorphs cartListMorph counterModels cartItemsQuantityMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classRemoval: #StoreTestObjectsFactory stamp: 'AF 11/29/2021 09:52:24'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #ManualClock stamp: 'AF 11/29/2021 09:52:24'!
Clock subclass: #ManualClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosSystemFacadeTest stamp: 'AF 11/29/2021 09:52:24'!
TestCase subclass: #TusLibrosSystemFacadeTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosRestAPIInterfaceTest stamp: 'AF 11/29/2021 09:52:25'!
TestCase subclass: #TusLibrosRestAPIInterfaceTest
	instanceVariableNames: 'testObjectsFactory clock systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CashierTest stamp: 'AF 11/29/2021 09:52:25'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #CartTest stamp: 'AF 11/29/2021 09:52:25'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classRemoval: #TusLibrosSystemFacade stamp: 'AF 11/29/2021 09:52:32'!
Object subclass: #TusLibrosSystemFacade
	instanceVariableNames: 'validUsersAndPasswords catalog lastId merchantProcessor salesBook clock cartSessions'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #TusLibrosRestAPIInterface stamp: 'AF 11/29/2021 09:52:32'!
Object subclass: #TusLibrosRestAPIInterface
	instanceVariableNames: 'port webServer systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Ticket stamp: 'AF 11/29/2021 09:52:32'!
Object subclass: #Ticket
	instanceVariableNames: 'lineItems'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Sale stamp: 'AF 11/29/2021 09:52:32'!
Object subclass: #Sale
	instanceVariableNames: 'customer ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #MerchantProcessor stamp: 'AF 11/29/2021 09:52:33'!
Object subclass: #MerchantProcessor
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #LineItem stamp: 'AF 11/29/2021 09:52:33'!
Object subclass: #LineItem
	instanceVariableNames: 'item quantity total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CreditCard stamp: 'AF 11/29/2021 09:52:33'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Clock stamp: 'AF 11/29/2021 09:52:33'!
Object subclass: #Clock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cashier stamp: 'AF 11/29/2021 09:52:34'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard owner ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #CartSession stamp: 'AF 11/29/2021 09:52:34'!
Object subclass: #CartSession
	instanceVariableNames: 'owner cart lastUsedTime systemFacade'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRemoval: #Cart stamp: 'AF 11/29/2021 09:52:34'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Tests.st----!

----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Model.st----!

----End fileIn of D:\Apuntes\Inge 1\Repos\Repo de entregas\20-TusLibros\Iteracion-4\TusLibros-Graphics.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:00'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 09:53:31'!
PASSED!

TusLibrosRestAPIInterfaceTest new startTestServerAndGraphicInterface.!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 09:57:40'!
test06listPurchases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test06listPurhcases stamp: 'AF 11/29/2021 09:57:40'!
test06listPurhcases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:00:43' prior: 51006509!
test06listPurchases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:02:58'!
sendCreateCartRequest

	| client response |
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	^self decodeJsonMapFrom: response.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:03:11' prior: 51002907!
test01CreateCartForValidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:03:45' prior: 51006670!
test01CreateCartForValidCredentials

	|server responseDecoded responseExpected|
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	responseDecoded _ self sendCreateCartRequest 
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:04:22' prior: 51006696!
test01CreateCartForValidCredentials

	|server responseDecoded responseExpected client |
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	responseDecoded _ self sendCreateCartRequest.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:05:08'!
sendCreateCartRequest: aWebClient

	| response |
	
	response _ (aWebClient httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	^self decodeJsonMapFrom: response.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:05:31' prior: 51006716!
test01CreateCartForValidCredentials

	|server responseDecoded responseExpected client |
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	responseDecoded _ self sendCreateCartRequest: client.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:06:58' prior: 51006747!
test01CreateCartForValidCredentials

	|server responseDecoded responseExpected client |
	
	self setUp.
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	client close.
	server destroy.
	
	responseExpected := (Dictionary new) add: 'status' -> 0; add: 'cartId' -> 1; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'cartId') equals: (responseDecoded at: 'cartId') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:06:58'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:07:03'!
FAILURE!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:07:17'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 10:07:26) CuisUniversity-4972.image priorSource: 21463213!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:07:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:07:27'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:10:23' prior: 51002933!
test02CreateCartForInvalidCredentials

	|server response client responseDecoded responseExpected|
	
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self invalidPassword).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected := Dictionary new add: 'status' -> 1; add: 'errorDescription' -> (systemFacade invalidUserAndOrPasswordErrorDescription); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status').
	self assert: (responseExpected at: 'errorDescription') equals: (responseDecoded at: 'errorDescription').
	! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #sendCreateCartRequest stamp: 'AF 11/29/2021 10:10:44'!
sendCreateCartRequest

	| client response |
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	^self decodeJsonMapFrom: response.
!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:11:06' prior: 51002961!
test03AddToCart

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:11:33' prior: 51006873!
test03AddToCart

	|server client cartId response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ responseDecoded at: 'cartId'.
	
	response _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	responseDecoded _ self decodeJsonMapFrom: response.
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:11:35'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:11:35'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:12:33' prior: 51002991!
test04ListCart

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	response _ (client httpGet: 'http://localhost:8080/createCart?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:13:33' prior: 51006956!
test04ListCart

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:13:34'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:13:34'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:15:00' prior: 51003030!
test05CheckOut

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=1'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:15:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:15:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:15:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:15:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:15:01'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:15:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:15:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:15:02'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:23:12' prior: 51006610!
test06listPurchases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:23:13'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:23:13'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:23:13'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:23:14'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:23:14'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:23:14'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:23:14'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:23:14'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:23:26' prior: 51003133!
test07fetchCatalog

	|server client response responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	response _ (client httpGet: 'http://localhost:8080/fetchCatalog' ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:25:48'!
sendAddToCartRequest: aWebClient withCartId: aCartId

	| response |
	
	response _ (aWebClient httpGet: 'http://localhost:8080/addToCart?cartId=',aCartId asString,'&bookIsbn=', testObjectsFactory itemSellByTheStore, '&bookQuantity=1').
	^self decodeJsonMapFrom: response.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:26:23' prior: 51006903!
test03AddToCart

	|server client cartId responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ responseDecoded at: 'cartId'.
	
	responseDecoded _ self sendAddToCartRequest: client withCartId: cartId .
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:26:26'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:26:26'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:26:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:26:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:26:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:26:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:26:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:26:27'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:27:06' prior: 51006995!
test04ListCart

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	self sendAddToCartRequest: client withCartId: cartId .
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:27:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:27:07'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:27:36' prior: 51007056!
test05CheckOut

	|server client cartId book response responseDecoded responseExpected creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	self sendAddToCartRequest: client withCartId: cartId .
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
			    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
			    										  '&cced=', creditCardExpirationHttpEncoded,
			    										   '&cco=', creditCardOwnerHttpEncoded).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:27:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:27:38'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:29:05' prior: 51007131!
test06listPurchases

	|server client cartId book response responseDecoded creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	client httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:31:06'!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded |
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:32:49' prior: 51007458!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded cartId|
	
	cartId _ aCartId asString.
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:32:57' prior: 51007481!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded cartId|
	
	cartId _ aCartId asString.
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId ,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:33:27' prior: 51007505!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded cartId response |
	
	cartId _ aCartId asString.
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId ,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	 self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:33:37' prior: 51007529!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded cartId response |
	
	cartId _ aCartId asString.
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', cartId ,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:35:15' prior: 51007555!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded response |
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', testObjectsFactory notExpiredCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:36:01' prior: 51007340!
test05CheckOut

	|server client cartId book responseDecoded responseExpected |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	self sendAddToCartRequest: client withCartId: cartId .	

	responseDecoded _ self sendCheckOutCartRequest: client withCartId: cartId.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:36:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:36:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:36:08'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:36:08'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:36:08'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:36:08'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:36:08'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:36:08'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:39:12' prior: 51007413!
test06listPurchases

	|server client cartId book response responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).

	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:39:16'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:39:16'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:40:02' prior: 51007662!
test06listPurchases

	|server client cartId book response responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	response _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).
	responseDecoded _ self decodeJsonMapFrom: response.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:40:04'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:40:04'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:42:16'!
sendListPurchases: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).
	^self decodeJsonMapFrom: response.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:42:37' prior: 51007719!
test06listPurchases

	|server client cartId book responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:42:42'!
ERROR!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:43:15' prior: 51007787!
test06listPurchases

	|server client cartId book responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:43:16'!
FAILURE!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 10:43:23'!
PASSED!

----SNAPSHOT----(29 November 2021 10:50:58) CuisUniversity-4972.image priorSource: 21604883!
!StoreTestObjectsFactory methodsFor: 'customer' stamp: 'AF 11/29/2021 12:16:05'!
validUser

	^'admin'.! !
!StoreTestObjectsFactory methodsFor: 'customer' stamp: 'AF 11/29/2021 12:16:11'!
validUserPassword

	^'admin'.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/29/2021 12:17:05' prior: 51002857!
validUser

	^testObjectsFactory validUser! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'test objects' stamp: 'AF 11/29/2021 12:17:16' prior: 51002861!
validUserPassword

	^testObjectsFactory validUserPassword ! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 12:17:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:29'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:29'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/29/2021 12:17:41' prior: 51003425!
validUser

	^testObjectsFactory validUser ! !
!TusLibrosSystemFacadeTest methodsFor: 'test objects' stamp: 'AF 11/29/2021 12:17:52' prior: 51003429!
validUserPassword

	^testObjectsFactory validUserPassword ! !

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 12:17:55'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 12:17:56'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 12:17:59'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 12:18:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 12:18:00'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:19:03'!
validCreditCardNumber

	^ testObjectsFactory notExpiredCreditCardNumber! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:19:03' prior: 51007581!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded response |
	
	creditCardExpirationHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:20:10'!
validExpirationDateHttpEncoded

	^ self encodeSpacesForUrl: testObjectsFactory notExpiredMonthOfYear asString! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:20:10' prior: 51008144!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded response |
	
	creditCardExpirationHttpEncoded _ self validExpirationDateHttpEncoded. 
	
	creditCardOwnerHttpEncoded _ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:20:40'!
validCreditCardOwnerHttpEncoded

	^ self encodeSpacesForUrl: testObjectsFactory notExpiredCreditCardOwner! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:20:40' prior: 51008174!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded response |
	
	creditCardExpirationHttpEncoded _ self validExpirationDateHttpEncoded. 
	
	creditCardOwnerHttpEncoded _ self validCreditCardOwnerHttpEncoded.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', creditCardExpirationHttpEncoded,
    										   '&cco=', creditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:20:58' prior: 51008203!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| creditCardExpirationHttpEncoded creditCardOwnerHttpEncoded response |
	
	creditCardExpirationHttpEncoded _ self validExpirationDateHttpEncoded. 
	
	creditCardOwnerHttpEncoded _ self validCreditCardOwnerHttpEncoded.
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', self validExpirationDateHttpEncoded,
    										   '&cco=', self validCreditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:21:03' prior: 51008225!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| response |
	
	
	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', self validExpirationDateHttpEncoded,
    										   '&cco=', self validCreditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:21:10' prior: 51008247!
sendCheckOutCartRequest: aWebClient withCartId: aCartId
	
	
	| response |

	response _ aWebClient httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId ,
    										    '&ccn=', self validCreditCardNumber, 
    										  '&cced=', self validExpirationDateHttpEncoded,
    										   '&cco=', self validCreditCardOwnerHttpEncoded.
	
	^self decodeJsonMapFrom: response.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 12:21:12'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 12:21:12'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:22:36' prior: 51007776!
sendListPurchases: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/fetchCatalog' ).

	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:22:43' prior: 51008302!
sendListPurchases: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/fetchCatalog' ).
	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:22:36' prior: 51008311!
sendListPurchases: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/fetchCatalog' ).

	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 10:42:16' prior: 51008320!
sendListPurchases: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/listPurchases?clientId=',self validUser,'&password=',self validUserPassword ).
	^self decodeJsonMapFrom: response.
! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 12:24:33'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 12:24:33'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:25:11'!
sendFetchCatalog: aWebClient
	
	
	| response |
	response _ (aWebClient httpGet: 'http://localhost:8080/fetchCatalog' ).

	^self decodeJsonMapFrom: response.! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:30:52' prior: 51007203!
test07fetchCatalog

	|server client response responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	response _ (client httpGet: 'http://localhost:8080/fetchCatalog' ).

	responseDecoded _ self sendFetchCatalog: client.
	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:30:58' prior: 51008371!
test07fetchCatalog

	|server client responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.

	responseDecoded _ self sendFetchCatalog: client.
	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:31:00' prior: 51008388!
test07fetchCatalog

	|server client responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.

	responseDecoded _ self sendFetchCatalog: client.
	
	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:31:56'!
test03AddToCartReturnsProperly

	|server client cartId responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ responseDecoded at: 'cartId'.
	
	responseDecoded _ self sendAddToCartRequest: client withCartId: cartId .
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test03AddToCart stamp: 'AF 11/29/2021 12:31:56'!
test03AddToCart

	|server client cartId responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ responseDecoded at: 'cartId'.
	
	responseDecoded _ self sendAddToCartRequest: client withCartId: cartId .
	
	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:32:11'!
test04ListCartReturnsProperly

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	self sendAddToCartRequest: client withCartId: cartId .
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test04ListCart stamp: 'AF 11/29/2021 12:32:11'!
test04ListCart

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ testObjectsFactory itemSellByTheStore.
	
	self sendAddToCartRequest: client withCartId: cartId .
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:32:14'!
test05CheckOutReturnsProperly

	|server client cartId book responseDecoded responseExpected |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	self sendAddToCartRequest: client withCartId: cartId .	

	responseDecoded _ self sendCheckOutCartRequest: client withCartId: cartId.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test05CheckOut stamp: 'AF 11/29/2021 12:32:14'!
test05CheckOut

	|server client cartId book responseDecoded responseExpected |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	self sendAddToCartRequest: client withCartId: cartId .	

	responseDecoded _ self sendCheckOutCartRequest: client withCartId: cartId.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:32:18'!
test06listPurchasesReturnsProperly

	|server client cartId book responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test06listPurchases stamp: 'AF 11/29/2021 12:32:18'!
test06listPurchases

	|server client cartId book responseDecoded |
	self setUp.
	book _ testObjectsFactory itemSellByTheStore.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:32:22'!
test07fetchCatalogReturnsProperly

	|server client responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.

	responseDecoded _ self sendFetchCatalog: client.
	
	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')! !

!methodRemoval: TusLibrosRestAPIInterfaceTest #test07fetchCatalog stamp: 'AF 11/29/2021 12:32:22'!
test07fetchCatalog

	|server client responseDecoded |
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.

	responseDecoded _ self sendFetchCatalog: client.
	
	client close.
	server destroy.
	
	self assert: (testObjectsFactory defaultCatalog ) equals: (responseDecoded at: 'catalog')!

----SNAPSHOT----(29 November 2021 12:33:43) CuisUniversity-4972.image priorSource: 21639025!
!TusLibrosRestAPIInterfaceTest methodsFor: 'request http' stamp: 'AF 11/29/2021 12:34:35'!
validBook

	^ testObjectsFactory itemSellByTheStore! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:34:35' prior: 51008525!
test05CheckOutReturnsProperly

	|server client cartId book responseDecoded responseExpected |
	self setUp.
	book _ self validBook.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	self sendAddToCartRequest: client withCartId: cartId .	

	responseDecoded _ self sendCheckOutCartRequest: client withCartId: cartId.

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'ticket' -> (Dictionary new add: book -> 10; yourself); yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: (responseExpected at: 'ticket') equals: (responseDecoded at: 'ticket').
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:34:35' prior: 51008584!
test06listPurchasesReturnsProperly

	|server client cartId book responseDecoded |
	self setUp.
	book _ self validBook.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client.

	client close.
	server destroy.
	
	self assert: (testObjectsFactory itemSellByTheStorePrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:34:35' prior: 51008459!
test04ListCartReturnsProperly

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	book _ self validBook.
	
	self sendAddToCartRequest: client withCartId: cartId .
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'request http' stamp: 'AF 11/29/2021 12:34:35' prior: 51007220!
sendAddToCartRequest: aWebClient withCartId: aCartId

	| response |
	
	response _ (aWebClient httpGet: 'http://localhost:8080/addToCart?cartId=',aCartId asString,'&bookIsbn=', self validBook, '&bookQuantity=1').
	^self decodeJsonMapFrom: response.
! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:35:29' prior: 51008729!
test04ListCartReturnsProperly

	|server client cartId book response responseDecoded responseExpected|
	self setUp.
	book _ self validBook.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.
	
	
	self sendAddToCartRequest: client withCartId: cartId .
	
	response _ (client httpGet: 'http://localhost:8080/listCart?cartId=',cartId ).
	responseDecoded _ self decodeJsonMapFrom: response.
	

	client close.
	server destroy.
	
	responseExpected _ (Dictionary new) add: 'status' -> 0; add: 'cartContents' -> ((Dictionary new) add: book -> 1 ;yourself) ; yourself.
	
	self assert: (responseExpected at: 'status') equals: (responseDecoded at: 'status') .
	self assert: ((responseExpected at: 'cartContents') at: book) equals: ((responseDecoded at: 'cartContents') at: book) .
	! !

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 12:35:30'!
PASSED!
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:35:56'!
validBookPrice

	^ testObjectsFactory itemSellByTheStorePrice! !
!TusLibrosRestAPIInterfaceTest methodsFor: 'tests' stamp: 'AF 11/29/2021 12:35:56' prior: 51008703!
test06listPurchasesReturnsProperly

	|server client cartId book responseDecoded |
	self setUp.
	book _ self validBook.
	
	server _ TusLibrosRestAPIInterface listeningOn: 8080 communicateWith: systemFacade.
	
	client _ WebClient new.
	
	responseDecoded _ self sendCreateCartRequest: client.
	
	cartId _ (responseDecoded at: 'cartId') asString.

	client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId,'&bookIsbn=', book, '&bookQuantity=2'.
	
	self sendCheckOutCartRequest: client withCartId: cartId.

	responseDecoded _ self sendListPurchases: client.

	client close.
	server destroy.
	
	self assert: (self validBookPrice * 2) equals: ((responseDecoded at: 'purchases') at: book)! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 12:36:02'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 12:40:04' prior: 51004467!
jsonErrorResponseBasedOn: anError

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 1; 
									   add: 'errorDescription' -> anError messageText;
									   yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:10:50'!
jsonResponseWithDictionary: purchasesDictionary indexedAs: aString
	purchasesDictionary ifEmpty: [ purchasesDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> purchasesDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:10:56' prior: 51008905!
jsonResponseWithDictionary: aDictionary indexedAs: aString
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> aDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:11:48'!
jsonResponseWith: aDictionary indexedAs: aString
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> aDictionary ; yourself)! !

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseWithDictionary:indexedAs: stamp: 'AF 11/29/2021 13:11:48'!
jsonResponseWithDictionary: aDictionary indexedAs: aString
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> aDictionary ; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:12:20'!
jsonResponseWithDictionary: aDictionary indexedAs: aString
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> aDictionary ; yourself)! !

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseWith:indexedAs: stamp: 'AF 11/29/2021 13:12:20'!
jsonResponseWith: aDictionary indexedAs: aString
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aString -> aDictionary ; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:13:04' prior: 51004381!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseForCheckOutCart: (self convertTicketToDictionary: ticket)).
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:07'!
PASSED!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 13:13:18) CuisUniversity-4972.image priorSource: 21664452!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:13:19'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:14:18' prior: 51008967!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseForListPurchases: list).
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:14:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:14:21'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:15:12' prior: 51009345!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password list |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			list := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: list indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:15:38' prior: 51009576!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseForFetchCatalog: catalog).
			].

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:15:47'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:16:18' prior: 51009665!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseForCreateCart: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:21'!
PASSED!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 13:16:27) CuisUniversity-4972.image priorSource: 21681522!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:16:28'!
PASSED!

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForCheckOutCart: stamp: 'AF 11/29/2021 13:16:47'!
jsonResponseForCheckOutCart: aDictionaryTicket

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'ticket' -> aDictionaryTicket ; yourself)!

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForFetchCatalog: stamp: 'AF 11/29/2021 13:16:52'!
jsonResponseForFetchCatalog: catalogDictionary

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'catalog' -> catalogDictionary ; yourself)!

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForListCart: stamp: 'AF 11/29/2021 13:17:02'!
jsonResponseForListCart: cartContentsDictionary

	cartContentsDictionary ifEmpty: [ cartContentsDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartContents' -> cartContentsDictionary ; yourself)!

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForListPurchases: stamp: 'AF 11/29/2021 13:17:12'!
jsonResponseForListPurchases: purchasesDictionary
	purchasesDictionary ifEmpty: [ purchasesDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'purchases' -> purchasesDictionary ; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:18:17'!
jsonResponseWith: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:18:17' prior: 51009898!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseWith: cartId).
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseForCreateCart: stamp: 'AF 11/29/2021 13:18:17'!
jsonResponseForCreateCart: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:18:52'!
jsonResponseWith: anObject indexedAs: aString

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> anObject; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:19:01' prior: 51010422!
jsonResponseWith: anObject indexedAs: aKey

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> anObject; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:19:08' prior: 51008947!
jsonResponseWithDictionary: aDictionary indexedAs: aKey
	aDictionary ifEmpty: [ aDictionary add: '' -> 0].
	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aKey -> aDictionary ; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:19:18' prior: 51010430!
jsonResponseWith: anObject indexedAs: aKey

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aKey -> anObject; yourself)! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:19:45' prior: 51010448!
jsonResponseWith: aJsonEncodableObject indexedAs: aKey

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: aKey -> aJsonEncodableObject; yourself)! !

!methodRemoval: TusLibrosRestAPIInterface #jsonResponseWith: stamp: 'AF 11/29/2021 13:20:37'!
jsonResponseWith: cartId

	^ WebUtils jsonEncode: ((Dictionary new) add: 'status' -> 0; add: 'cartId' -> cartId; yourself)!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:20:56' prior: 51010324!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseWith: cartId indexedAs: 'cartId').
			].
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:20:59'!
PASSED!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:21:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:21:05'!
PASSED!
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:24:32'!
addCreateCartService

	^ self addServiceWithInternalErrorHandling: '/createCart' 
  	      action:[:request | 
			
			| user password cartId |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			cartId := systemFacade createCartFor: user authenticatedWith: password.
						
			request send200Response: (self jsonResponseWith: cartId indexedAs: 'cartId').
			]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:24:32' prior: 51010472!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ].

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:24:48'!
addAddToCartService

	^ self addServiceWithInternalErrorHandling: '/addToCart' 
	      action: 	[:request |
		  	  | book bookAmount cartId |
			  cartId := (request fields at:'cartId').
			  book := (request fields at:'bookIsbn').
			  bookAmount := (request fields at:'bookQuantity').		
			
			  systemFacade add: bookAmount asNumber of: book toCartIdentifiedAs: cartId asNumber.

  			  request send200Response: self jsonSuccessfulResponse.
		         ]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:24:48' prior: 51010867!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ].

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:06'!
addListCartService

	^ self addServiceWithInternalErrorHandling: '/listCart' 
	       action:[:request | 
			 | cartId cartContents cartContentsDictionary |
			 cartId := (request fields at:'cartId').	
			
			 cartContents _ systemFacade listCartIdentifiedAs: cartId asNumber.
			 cartContentsDictionary _ self convertBagToDictionary: cartContents.

			 request send200Response: (self jsonResponseWithDictionary: cartContentsDictionary indexedAs: 'cartContents').

			 ]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:06' prior: 51010965!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addListCartService.

	self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ] .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:26'!
addCheckOutCartService

	^ self addServiceWithInternalErrorHandling: '/checkOutCart' 
	      action:[:request | 
		
			| cartId cardNumber cardExpirationDate cardOwner ticket |
			cartId := (request fields at:'cartId') asNumber.	
			cardNumber := (request fields at:'ccn').	
			cardExpirationDate := (request fields at:'cced') asMonth.	
			cardOwner := (request fields at:'cco').	
			
			ticket _ systemFacade checkOutCartIdentifiedAs: cartId withCreditCardNumbered: cardNumber  ownedBy: cardOwner expiringOn: cardExpirationDate .
			
			request send200Response: (self jsonResponseWithDictionary: (self convertTicketToDictionary: ticket) indexedAs: 'ticket').
		       ]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:26' prior: 51011051!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addListCartService.

	self addCheckOutCartService .

	
	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:41' prior: 51011130!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addListCartService.

	self addCheckOutCartService .

	self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			].

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:57'!
addListPurchasesService

	^ self addServiceWithInternalErrorHandling: '/listPurchases'
	      action:[:request | 
			| user password purchasesDictionary |
			user := (request fields at:'clientId').
			password := (request fields at:'password').
				
			purchasesDictionary := systemFacade listPurchasesOf: user authenticatingWith: password.
						
			request send200Response: (self jsonResponseWithDictionary: purchasesDictionary indexedAs: 'purchases').
			]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:25:57' prior: 51011165!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addListCartService.

	self addCheckOutCartService .

	self addListPurchasesService.

	self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			].

	webServer startListener.
! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:26:14'!
addFetchCatalogService

	^ self addServiceWithInternalErrorHandling: '/fetchCatalog' 
	      action:[:request | 
			| catalog |
				
			catalog := systemFacade fetchCatalog .
						
			request send200Response: (self jsonResponseWithDictionary: catalog indexedAs: 'catalog').
			]! !
!TusLibrosRestAPIInterface methodsFor: 'initialization' stamp: 'AF 11/29/2021 13:26:14' prior: 51011217!
initializeWith: aPortNumber and: aSystemFacade    
	
	port := aPortNumber.
	systemFacade := aSystemFacade.
	
	webServer := WebServer new listenOn: port.
	
	self addCreateCartService.
		
	self addAddToCartService.

	self addListCartService.

	self addCheckOutCartService .

	self addListPurchasesService.

	self addFetchCatalogService.

	webServer startListener.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:31'!
PASSED!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:26:37'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:38'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:26:38'!
PASSED!
!Behavior method!
initialize
	(today _ [
	(DateAndTime
		cover: (25 to: 35)
		declaredAt: (25 to: 35)) now ] valueCoveringAll:
		{37 to: 39})
		cover: (16 to: 20)
		declaredAt: (16 to: 20).! !
!Behavior method!
createCart
	^ [
	(Cart
		cover: (17 to: 20)
		declaredAt: (17 to: 20)) acceptingItemsOf:
		([
		(self coverAll:
			{40 to: 43}) defaultCatalog ] valueCoveringAll:
			{45 to: 58}) ] valueCoveringAll:
		{22 to: 38}.! !
!Behavior method!
defaultCatalog
	^ [ | cascadeReceiver |
	cascadeReceiver _ [
	(Dictionary
		cover: (22 to: 31)
		declaredAt: (22 to: 31)) new ] valueCoveringAll:
		{33 to: 35}.
	[
	cascadeReceiver
		at:
			([
			(self coverAll:
				{44 to: 47}) itemSellByTheStore ] valueCoveringAll:
				{49 to: 66})
		put:
			([
			(self coverAll:
				{73 to: 76}) itemSellByTheStorePrice ] valueCoveringAll:
				{78 to: 100}) ] valueCoveringAll:
		{40 to: 42. 68 to: 71}.
	[
	cascadeReceiver
		at:
			([
			(self coverAll:
				{110 to: 113}) anotherItemSellByTheStore ] valueCoveringAll:
				{115 to: 139})
		put:
			([
			(self coverAll:
				{146 to: 149}) anotherItemSellByTheStorePrice ] valueCoveringAll:
				{151 to: 180}) ] valueCoveringAll:
		{106 to: 108. 141 to: 144}.
	[
	cascadeReceiver add:
		([
		('Moby Dick' coverAll:
			{195 to: 205}) ->
			(1000 coverAll:
				{210 to: 213}) ] valueCoveringAll:
			{207 to: 208}) ] valueCoveringAll:
		{190 to: 193}.
	[
	cascadeReceiver add:
		([
		('Winnie The Pooh' coverAll:
			{224 to: 240}) ->
			(900 coverAll:
				{245 to: 247}) ] valueCoveringAll:
			{242 to: 243}) ] valueCoveringAll:
		{219 to: 222}.
	[
	cascadeReceiver add:
		([
		('Haikyuu!!!!' coverAll:
			{258 to: 268}) ->
			(450 coverAll:
				{273 to: 275}) ] valueCoveringAll:
			{270 to: 271}) ] valueCoveringAll:
		{253 to: 256}.
	[
	cascadeReceiver add:
		([
		('Eragon' coverAll:
			{286 to: 293}) ->
			(1200 coverAll:
				{298 to: 301}) ] valueCoveringAll:
			{295 to: 296}) ] valueCoveringAll:
		{281 to: 284}.
	[
	cascadeReceiver add:
		([
		('The Shining' coverAll:
			{312 to: 324}) ->
			(650 coverAll:
				{329 to: 331}) ] valueCoveringAll:
			{326 to: 327}) ] valueCoveringAll:
		{307 to: 310}.
	[
	cascadeReceiver add:
		([
		('Legado' coverAll:
			{370 to: 377}) ->
			(1100 coverAll:
				{382 to: 385}) ] valueCoveringAll:
			{379 to: 380}) ] valueCoveringAll:
		{365 to: 368}.
	[ cascadeReceiver yourself ] valueCoveringAll:
		{391 to: 398} ] value.! !
!Behavior method!
itemSellByTheStore
	^ 'validBook' coverAll:
		{26 to: 36}.! !
!Behavior method!
itemSellByTheStorePrice
	^ 10 coverAll:
		{30 to: 31}.! !
!Behavior method!
anotherItemSellByTheStore
	^ 'anotherValidBook' coverAll:
		{32 to: 49}.! !
!Behavior method!
anotherItemSellByTheStorePrice
	^ 15 coverAll:
		{37 to: 38}.! !
!Behavior method!
acceptingItemsOf: aCatalog
	^ [
	([
	(self coverAll:
		{33 to: 36}) new ] valueCoveringAll:
		{38 to: 40}) initializeAcceptingItemsOf:
		(aCatalog
			cover: (70 to: 77)
			declaredAt: (19 to: 26)) ] valueCoveringAll:
		{42 to: 68}.! !
!Behavior method!
initializeAcceptingItemsOf: aCatalog
	(catalog _ aCatalog
		cover: (53 to: 60)
		declaredAt: (29 to: 36))
		cover: (42 to: 48)
		declaredAt: (42 to: 48).
	(items _ [
	(Bag
		cover: (74 to: 76)
		declaredAt: (74 to: 76)) new ] valueCoveringAll:
		{78 to: 80})
		cover: (65 to: 69)
		declaredAt: (65 to: 69).! !
!Behavior method!
isEmpty
	^ [
	(items
		cover: (14 to: 18)
		declaredAt: (14 to: 18)) isEmpty ] valueCoveringAll:
		{20 to: 26}.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'AF 11/29/2021 13:27:04'!
PASSED!
!Behavior method!
itemNotSellByTheStore
	^ 'invalidBook' coverAll:
		{28 to: 40}.! !
!Behavior method!
add: anItem
	^ [
	(self coverAll:
		{19 to: 22})
		add:
			(1 coverAll:
				{29 to: 29})
		of:
			(anItem
				cover: (35 to: 40)
				declaredAt: (6 to: 11)) ] valueCoveringAll:
		{24 to: 27. 31 to: 33}.! !
!Behavior method!
add: aQuantity of: anItem
	[
	(self coverAll:
		{29 to: 32}) assertIsValidQuantity:
		(aQuantity
			cover: (57 to: 65)
			declaredAt: (6 to: 14)) ] valueCoveringAll:
		{34 to: 55}.
	[
	(self coverAll:
		{69 to: 72}) assertIsValidItem:
		(anItem
			cover: (93 to: 98)
			declaredAt: (20 to: 25)) ] valueCoveringAll:
		{74 to: 91}.
	[
	(items
		cover: (103 to: 107)
		declaredAt: (103 to: 107))
		add:
			(anItem
				cover: (114 to: 119)
				declaredAt: (20 to: 25))
		withOccurrences:
			(aQuantity
				cover: (138 to: 146)
				declaredAt: (6 to: 14)) ] valueCoveringAll:
		{109 to: 112. 121 to: 136}.! !
!Behavior method!
assertIsValidQuantity: aQuantity
	[
	([
	(aQuantity
		cover: (38 to: 46)
		declaredAt: (24 to: 32)) strictlyPositive ] valueCoveringAll:
		{48 to: 63}) ifFalse: [
		[
		(self coverAll:
			{75 to: 78}) signalInvalidQuantity ] valueCoveringAll:
			{80 to: 100} ]] valueCoveringAll:
		{65 to: 72}.! !
!Behavior method!
assertIsValidItem: anItem
	[
	([
	(catalog
		cover: (30 to: 36)
		declaredAt: (30 to: 36)) includesKey:
		(anItem
			cover: (51 to: 56)
			declaredAt: (20 to: 25)) ] valueCoveringAll:
		{38 to: 49}) ifFalse: [
		[
		(self coverAll:
			{70 to: 73}) signalInvalidItem ] valueCoveringAll:
			{75 to: 91} ]] valueCoveringAll:
		{59 to: 66}.! !
!Behavior method!
signalInvalidItem
	[
	(self coverAll:
		{23 to: 26}) error:
		([
		(self coverAll:
			{35 to: 38}) invalidItemErrorMessage ] valueCoveringAll:
			{40 to: 62}) ] valueCoveringAll:
		{28 to: 33}.! !
!Behavior method!
invalidItemErrorMessage
	^ [
	([
	(self coverAll:
		{30 to: 33}) class ] valueCoveringAll:
		{35 to: 39}) invalidItemErrorMessage ] valueCoveringAll:
		{41 to: 63}.! !
!Behavior method!
invalidItemErrorMessage
	^ 'Item is not in catalog' coverAll:
		{30 to: 53}.! !

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'AF 11/29/2021 13:27:05'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
signalInvalidQuantity
	[
	(self coverAll:
		{27 to: 30}) error:
		([
		(self coverAll:
			{39 to: 42}) invalidQuantityErrorMessage ] valueCoveringAll:
			{44 to: 70}) ] valueCoveringAll:
		{32 to: 37}.! !
!Behavior method!
invalidQuantityErrorMessage
	^ [
	([
	(self coverAll:
		{34 to: 37}) class ] valueCoveringAll:
		{39 to: 43}) invalidQuantityErrorMessage ] valueCoveringAll:
		{45 to: 71}.! !
!Behavior method!
invalidQuantityErrorMessage
	^ 'Invalid number of items' coverAll:
		{34 to: 58}.! !

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'AF 11/29/2021 13:27:05'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
includes: anItem
	^ [
	(items
		cover: (23 to: 27)
		declaredAt: (23 to: 27)) includes:
		(anItem
			cover: (39 to: 44)
			declaredAt: (11 to: 16)) ] valueCoveringAll:
		{29 to: 37}.! !

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'AF 11/29/2021 13:27:05'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
occurrencesOf: anItem
	^ [
	(items
		cover: (28 to: 32)
		declaredAt: (28 to: 32)) occurrencesOf:
		(anItem
			cover: (49 to: 54)
			declaredAt: (16 to: 21)) ] valueCoveringAll:
		{34 to: 47}.! !

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
customer
	^ 'aCustomer' coverAll:
		{15 to: 25}.! !
!Behavior method!
notExpiredCreditCard
	^ [
	(CreditCard
		cover: (27 to: 36)
		declaredAt: (27 to: 36)) expiringOn:
		([
		(self coverAll:
			{50 to: 53}) notExpiredMonthOfYear ] valueCoveringAll:
			{55 to: 75}) ] valueCoveringAll:
		{38 to: 48}.! !
!Behavior method!
notExpiredMonthOfYear
	^ [
	(Month
		cover: (29 to: 33)
		declaredAt: (29 to: 33))
		month:
			([
			(today
				cover: (42 to: 46)
				declaredAt: (42 to: 46)) monthIndex ] valueCoveringAll:
				{48 to: 57})
		year:
			([
			([
			(today
				cover: (65 to: 69)
				declaredAt: (42 to: 46)) yearNumber ] valueCoveringAll:
				{71 to: 80}) +
				(1 coverAll:
					{83 to: 84}) ] valueCoveringAll:
				{82 to: 82}) ] valueCoveringAll:
		{35 to: 40. 59 to: 63}.! !
!Behavior method!
expiringOn: aMonth
	^ [
	([
	(self coverAll:
		{25 to: 28}) new ] valueCoveringAll:
		{30 to: 32}) initializeExpiringOn:
		(aMonth
			cover: (56 to: 61)
			declaredAt: (13 to: 18)) ] valueCoveringAll:
		{34 to: 54}.! !
!Behavior method!
initializeExpiringOn: aMonth
	(expiration _ aMonth
		cover: (48 to: 53)
		declaredAt: (23 to: 28))
		cover: (34 to: 43)
		declaredAt: (34 to: 43).! !
!Behavior method!
today
	^ today
		cover: (13 to: 17)
		declaredAt: (13 to: 17).! !
!Behavior method!
toCheckout: aCart ownedBy: anOwner charging: aCreditCard throught: aMerchantProcessor on: aDate registeringOn: aSalesBook
	[
	(self coverAll:
		{127 to: 130}) assertIsNotEmpty:
		(aCart
			cover: (150 to: 154)
			declaredAt: (13 to: 17)) ] valueCoveringAll:
		{132 to: 148}.
	[
	(self coverAll:
		{159 to: 162})
		assertIsNotExpired:
			(aCreditCard
				cover: (184 to: 194)
				declaredAt: (46 to: 56))
		on:
			(aDate
				cover: (200 to: 204)
				declaredAt: (91 to: 95)) ] valueCoveringAll:
		{164 to: 182. 196 to: 198}.
	^ [
	([
	(self coverAll:
		{212 to: 215}) new ] valueCoveringAll:
		{217 to: 219})
		initializeToCheckout:
			(aCart
				cover: (243 to: 247)
				declaredAt: (13 to: 17))
		ownedBy:
			(anOwner
				cover: (258 to: 264)
				declaredAt: (28 to: 34))
		charging:
			(aCreditCard
				cover: (276 to: 286)
				declaredAt: (46 to: 56))
		throught:
			(aMerchantProcessor
				cover: (298 to: 315)
				declaredAt: (68 to: 85))
		registeringOn:
			(aSalesBook
				cover: (332 to: 341)
				declaredAt: (112 to: 121)) ] valueCoveringAll:
		{221 to: 241. 249 to: 256. 266 to: 274. 288 to: 296. 317 to: 330}.! !
!Behavior method!
assertIsNotEmpty: aCart
	[
	([
	(aCart
		cover: (29 to: 33)
		declaredAt: (19 to: 23)) isEmpty ] valueCoveringAll:
		{35 to: 41}) ifTrue: [
		[
		(self coverAll:
			{52 to: 55}) signalCartCanNotBeEmpty ] valueCoveringAll:
			{57 to: 79} ]] valueCoveringAll:
		{43 to: 49}.! !
!Behavior method!
signalCartCanNotBeEmpty
	[
	(self coverAll:
		{29 to: 32}) error:
		([
		(self coverAll:
			{41 to: 44}) cartCanNotBeEmptyErrorMessage ] valueCoveringAll:
			{46 to: 74}) ] valueCoveringAll:
		{34 to: 39}.! !
!Behavior method!
cartCanNotBeEmptyErrorMessage
	^ 'Can not check out an empty cart' coverAll:
		{36 to: 68}.! !

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
assertIsNotExpired: aCreditCard on: aDate
	[
	([
	(aCreditCard
		cover: (48 to: 58)
		declaredAt: (21 to: 31)) isExpiredOn:
		(aDate
			cover: (73 to: 77)
			declaredAt: (37 to: 41)) ] valueCoveringAll:
		{60 to: 71}) ifTrue: [
		[
		(self coverAll:
			{89 to: 92}) signalCanNotChargeAnExpiredCreditCard ] valueCoveringAll:
			{94 to: 130} ]] valueCoveringAll:
		{80 to: 86}.! !
!Behavior method!
isExpiredOn: aDate
	^ [
	([
	(expiration
		cover: (25 to: 34)
		declaredAt: (25 to: 34)) start ] valueCoveringAll:
		{36 to: 40}) <
		([
		([
		(Month
			cover: (45 to: 49)
			declaredAt: (45 to: 49))
			month:
				([
				(aDate
					cover: (58 to: 62)
					declaredAt: (14 to: 18)) monthIndex ] valueCoveringAll:
					{64 to: 73})
			year:
				([
				(aDate
					cover: (81 to: 85)
					declaredAt: (14 to: 18)) yearNumber ] valueCoveringAll:
					{87 to: 96}) ] valueCoveringAll:
			{51 to: 56. 75 to: 79}) start ] valueCoveringAll:
			{99 to: 103}) ] valueCoveringAll:
		{42 to: 42}.! !
!Behavior method!
initializeToCheckout: aCart ownedBy: anOwner charging: aCreditCard throught: aMerchantProcessor registeringOn: aSalesBook
	(cart _ aCart
		cover: (135 to: 139)
		declaredAt: (23 to: 27))
		cover: (127 to: 130)
		declaredAt: (127 to: 130).
	(owner _ anOwner
		cover: (153 to: 159)
		declaredAt: (38 to: 44))
		cover: (144 to: 148)
		declaredAt: (144 to: 148).
	(creditCard _ aCreditCard
		cover: (178 to: 188)
		declaredAt: (56 to: 66))
		cover: (164 to: 173)
		declaredAt: (164 to: 173).
	(merchantProcessor _ aMerchantProcessor
		cover: (214 to: 231)
		declaredAt: (78 to: 95))
		cover: (193 to: 209)
		declaredAt: (193 to: 209).
	(salesBook _ aSalesBook
		cover: (249 to: 258)
		declaredAt: (112 to: 121))
		cover: (236 to: 244)
		declaredAt: (236 to: 244).! !
!Behavior method!
checkOut
	[
	(self coverAll:
		{12 to: 15}) createTicket ] valueCoveringAll:
		{17 to: 28}.
	[
	(self coverAll:
		{32 to: 35}) debitTotal ] valueCoveringAll:
		{37 to: 46}.
	[
	(self coverAll:
		{50 to: 53}) registerSale ] valueCoveringAll:
		{55 to: 66}.
	^ ticket
		cover: (73 to: 78)
		declaredAt: (73 to: 78).! !
!Behavior method!
createTicket
	| lineItems |
	(lineItems _ [
	(OrderedCollection
		cover: (49 to: 65)
		declaredAt: (49 to: 65)) new ] valueCoveringAll:
		{67 to: 69})
		cover: (36 to: 44)
		declaredAt: (20 to: 28).
	[
	(cart
		cover: (74 to: 77)
		declaredAt: (74 to: 77)) itemsAndQuantitiesDo: [ :anItem :aQuantity |
		[
		(lineItems
			cover: (127 to: 135)
			declaredAt: (20 to: 28)) add:
			([
			(self coverAll:
				{143 to: 146})
				createLineItemOf:
					(anItem
						cover: (166 to: 171)
						declaredAt: (104 to: 109))
				quantity:
					(aQuantity
						cover: (183 to: 191)
						declaredAt: (112 to: 120)) ] valueCoveringAll:
				{148 to: 164. 173 to: 181}) ] valueCoveringAll:
			{137 to: 140} ]] valueCoveringAll:
		{79 to: 99}.
	(ticket _ [
	(Ticket
		cover: (210 to: 215)
		declaredAt: (210 to: 215)) of:
		(lineItems
			cover: (221 to: 229)
			declaredAt: (20 to: 28)) ] valueCoveringAll:
		{217 to: 219})
		cover: (200 to: 205)
		declaredAt: (200 to: 205).! !
!Behavior method!
itemsAndQuantitiesDo: aBlock
	^ [
	([
	(items
		cover: (36 to: 40)
		declaredAt: (36 to: 40)) contents ] valueCoveringAll:
		{42 to: 49}) keysAndValuesDo: [ :anItem :aQuantity |
		[
		(aBlock
			cover: (91 to: 96)
			declaredAt: (23 to: 28))
			value:
				(anItem
					cover: (105 to: 110)
					declaredAt: (71 to: 76))
			value:
				(aQuantity
					cover: (119 to: 127)
					declaredAt: (79 to: 87)) ] valueCoveringAll:
			{98 to: 103. 112 to: 117} ]] valueCoveringAll:
		{51 to: 66}.! !
!Behavior method!
createLineItemOf: anItem quantity: aQuantity
	^ [
	(LineItem
		cover: (51 to: 58)
		declaredAt: (51 to: 58))
		of:
			(anItem
				cover: (64 to: 69)
				declaredAt: (19 to: 24))
		quantity:
			(aQuantity
				cover: (81 to: 89)
				declaredAt: (36 to: 44))
		total:
			([
			(self coverAll:
				{99 to: 102})
				totalOf:
					(anItem
						cover: (113 to: 118)
						declaredAt: (19 to: 24))
				quantity:
					(aQuantity
						cover: (130 to: 138)
						declaredAt: (36 to: 44)) ] valueCoveringAll:
				{104 to: 111. 120 to: 128}) ] valueCoveringAll:
		{60 to: 62. 71 to: 79. 91 to: 96}.! !
!Behavior method!
totalOf: anItem quantity: aQuantity
	^ [
	([
	([
	(cart
		cover: (43 to: 46)
		declaredAt: (43 to: 46)) catalog ] valueCoveringAll:
		{48 to: 54}) at:
		(anItem
			cover: (60 to: 65)
			declaredAt: (10 to: 15)) ] valueCoveringAll:
		{56 to: 58}) *
		(aQuantity
			cover: (70 to: 78)
			declaredAt: (27 to: 35)) ] valueCoveringAll:
		{68 to: 68}.! !
!Behavior method!
catalog
	^ catalog
		cover: (15 to: 21)
		declaredAt: (15 to: 21).! !
!Behavior method!
of: anItem quantity: aQuantity total: aTotal
	^ [
	([
	(self coverAll:
		{51 to: 54}) new ] valueCoveringAll:
		{56 to: 58})
		initializeOf:
			(anItem
				cover: (74 to: 79)
				declaredAt: (5 to: 10))
		quantity:
			(aQuantity
				cover: (91 to: 99)
				declaredAt: (22 to: 30))
		total:
			(aTotal
				cover: (108 to: 113)
				declaredAt: (39 to: 44)) ] valueCoveringAll:
		{60 to: 72. 81 to: 89. 101 to: 106}.! !
!Behavior method!
initializeOf: anItem quantity: aQuantity total: aTotal
	(item _ anItem
		cover: (66 to: 71)
		declaredAt: (15 to: 20))
		cover: (58 to: 61)
		declaredAt: (58 to: 61).
	(quantity _ aQuantity
		cover: (87 to: 95)
		declaredAt: (32 to: 40))
		cover: (75 to: 82)
		declaredAt: (75 to: 82).
	(total _ aTotal
		cover: (108 to: 113)
		declaredAt: (49 to: 54))
		cover: (99 to: 103)
		declaredAt: (99 to: 103).! !
!Behavior method!
of: aCollectionOfLineItems
	^ [
	([
	(self coverAll:
		{33 to: 36}) new ] valueCoveringAll:
		{38 to: 40}) initializeOf:
		(aCollectionOfLineItems
			cover: (56 to: 77)
			declaredAt: (5 to: 26)) ] valueCoveringAll:
		{42 to: 54}.! !
!Behavior method!
initializeOf: aCollectionOfLineItems
	(lineItems _ aCollectionOfLineItems
		cover: (55 to: 76)
		declaredAt: (15 to: 36))
		cover: (42 to: 50)
		declaredAt: (42 to: 50).! !
!Behavior method!
debitTotal
	[
	(merchantProcessor
		cover: (16 to: 32)
		declaredAt: (16 to: 32))
		debit:
			([
			(ticket
				cover: (41 to: 46)
				declaredAt: (41 to: 46)) total ] valueCoveringAll:
				{48 to: 52})
		from:
			(creditCard
				cover: (60 to: 69)
				declaredAt: (60 to: 69)) ] valueCoveringAll:
		{34 to: 39. 54 to: 58}.! !
!Behavior method!
total
	^ [
	(lineItems
		cover: (12 to: 20)
		declaredAt: (12 to: 20)) sum: [ :aLineItem |
		[
		(aLineItem
			cover: (42 to: 50)
			declaredAt: (30 to: 38)) total ] valueCoveringAll:
			{52 to: 56} ]] valueCoveringAll:
		{22 to: 25}.! !
!Behavior method!
total
	^ total
		cover: (13 to: 17)
		declaredAt: (13 to: 17).! !
!Behavior method!
registerSale
	[
	(salesBook
		cover: (18 to: 26)
		declaredAt: (18 to: 26)) add:
		([
		(self coverAll:
			{33 to: 36}) createSale ] valueCoveringAll:
			{38 to: 47}) ] valueCoveringAll:
		{28 to: 31}.! !
!Behavior method!
createSale
	^ [
	(Sale
		cover: (18 to: 21)
		declaredAt: (18 to: 21))
		doneBy:
			(owner
				cover: (31 to: 35)
				declaredAt: (31 to: 35))
		certifiedWith:
			(ticket
				cover: (52 to: 57)
				declaredAt: (52 to: 57)) ] valueCoveringAll:
		{23 to: 29. 37 to: 50}.! !
!Behavior method!
doneBy: aCustomer certifiedWith: aTicket
	^ [
	([
	(self coverAll:
		{47 to: 50}) new ] valueCoveringAll:
		{52 to: 54})
		initializeDoneBy:
			(aCustomer
				cover: (74 to: 82)
				declaredAt: (9 to: 17))
		certifiedWith:
			(aTicket
				cover: (99 to: 105)
				declaredAt: (34 to: 40)) ] valueCoveringAll:
		{56 to: 72. 84 to: 97}.! !
!Behavior method!
initializeDoneBy: aCustomer certifiedWith: aTicket
	(customer _ aCustomer
		cover: (68 to: 76)
		declaredAt: (19 to: 27))
		cover: (56 to: 63)
		declaredAt: (56 to: 63).
	(ticket _ aTicket
		cover: (91 to: 97)
		declaredAt: (44 to: 50))
		cover: (81 to: 86)
		declaredAt: (81 to: 86).! !

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
expiredCreditCard
	^ [
	(CreditCard
		cover: (24 to: 33)
		declaredAt: (24 to: 33)) expiringOn:
		([
		(self coverAll:
			{47 to: 50}) expiredMonthOfYear ] valueCoveringAll:
			{52 to: 69}) ] valueCoveringAll:
		{35 to: 45}.! !
!Behavior method!
expiredMonthOfYear
	^ [
	(Month
		cover: (26 to: 30)
		declaredAt: (26 to: 30))
		month:
			([
			(today
				cover: (39 to: 43)
				declaredAt: (39 to: 43)) monthIndex ] valueCoveringAll:
				{45 to: 54})
		year:
			([
			([
			(today
				cover: (62 to: 66)
				declaredAt: (39 to: 43)) yearNumber ] valueCoveringAll:
				{68 to: 77}) -
				(1 coverAll:
					{80 to: 81}) ] valueCoveringAll:
				{79 to: 79}) ] valueCoveringAll:
		{32 to: 37. 56 to: 60}.! !
!Behavior method!
signalCanNotChargeAnExpiredCreditCard
	[
	(self coverAll:
		{44 to: 47}) error:
		([
		(self coverAll:
			{56 to: 59}) canNotChargeAnExpiredCreditCardErrorMessage ] valueCoveringAll:
			{61 to: 103}) ] valueCoveringAll:
		{49 to: 54}.! !
!Behavior method!
canNotChargeAnExpiredCreditCardErrorMessage
	^ 'Can not charge an expired credit card' coverAll:
		{50 to: 88}.! !

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
total
	^ [
	(ticket
		cover: (13 to: 18)
		declaredAt: (13 to: 18)) total ] valueCoveringAll:
		{20 to: 24}.! !

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'AF 11/29/2021 13:27:05'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
creditCardHasNoCreditErrorMessage
	^ 'Credit card has no credit' coverAll:
		{40 to: 66}.! !

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
now: aTime
	^ [
	([
	(self coverAll:
		{17 to: 20}) new ] valueCoveringAll:
		{22 to: 24}) initializeNow:
		(aTime
			cover: (41 to: 45)
			declaredAt: (6 to: 10)) ] valueCoveringAll:
		{26 to: 39}.! !
!Behavior method!
initializeNow: aTime
	(now _ aTime
		cover: (33 to: 37)
		declaredAt: (16 to: 20))
		cover: (26 to: 28)
		declaredAt: (26 to: 28).! !
!Behavior method!
validUser
	^ 'admin' coverAll:
		{14 to: 20}.! !
!Behavior method!
validUserPassword
	^ 'admin' coverAll:
		{22 to: 28}.! !
!Behavior method!
authenticatingWith: aValidUsersAndPasswords acceptingItemsOf: aCatalog registeringOn: aSalesBook debitingThrought: aMerchantProcessor measuringTimeWith: aClock
	^ [
	([
	(self coverAll:
		{174 to: 177}) new ] valueCoveringAll:
		{179 to: 181})
		initializeAuthenticatingWith:
			(aValidUsersAndPasswords
				cover: (216 to: 238)
				declaredAt: (21 to: 43))
		acceptingItemsOf:
			(aCatalog
				cover: (261 to: 268)
				declaredAt: (65 to: 72))
		registeringOn:
			(aSalesBook
				cover: (288 to: 297)
				declaredAt: (91 to: 100))
		debitingThrought:
			(aMerchantProcessor
				cover: (320 to: 337)
				declaredAt: (122 to: 139))
		measuringTimeWith:
			(aClock
				cover: (361 to: 366)
				declaredAt: (162 to: 167)) ] valueCoveringAll:
		{186 to: 214. 243 to: 259. 273 to: 286. 302 to: 318. 342 to: 359}.! !
!Behavior method!
initializeAuthenticatingWith: aValidUsersAndPasswords acceptingItemsOf: aCatalog registeringOn: aSalesBook debitingThrought: aMerchantProcessor measuringTimeWith: aClock
	(validUsersAndPasswords _ aValidUsersAndPasswords
		cover: (209 to: 231)
		declaredAt: (31 to: 53))
		cover: (183 to: 204)
		declaredAt: (183 to: 204).
	(catalog _ aCatalog
		cover: (247 to: 254)
		declaredAt: (75 to: 82))
		cover: (236 to: 242)
		declaredAt: (236 to: 242).
	(salesBook _ aSalesBook
		cover: (272 to: 281)
		declaredAt: (101 to: 110))
		cover: (259 to: 267)
		declaredAt: (259 to: 267).
	(merchantProcessor _ aMerchantProcessor
		cover: (307 to: 324)
		declaredAt: (132 to: 149))
		cover: (286 to: 302)
		declaredAt: (286 to: 302).
	(clock _ aClock
		cover: (338 to: 343)
		declaredAt: (172 to: 177))
		cover: (329 to: 333)
		declaredAt: (329 to: 333).
	(cartSessions _ [
	(Dictionary
		cover: (366 to: 375)
		declaredAt: (366 to: 375)) new ] valueCoveringAll:
		{377 to: 379})
		cover: (350 to: 361)
		declaredAt: (350 to: 361).
	(lastId _ 0 coverAll:
		{394 to: 394})
		cover: (384 to: 389)
		declaredAt: (384 to: 389).! !
!Behavior method!
listeningOn: aPortNumber communicateWith: aSystemFacade
	^ [
	([
	(self coverAll:
		{63 to: 66}) basicNew ] valueCoveringAll:
		{68 to: 75})
		initializeWith:
			(aPortNumber
				cover: (93 to: 103)
				declaredAt: (14 to: 24))
		and:
			(aSystemFacade
				cover: (110 to: 122)
				declaredAt: (43 to: 55)) ] valueCoveringAll:
		{77 to: 91. 105 to: 108}.! !
!Behavior method!
initializeWith: aPortNumber and: aSystemFacade
	(port _ aPortNumber
		cover: (63 to: 73)
		declaredAt: (17 to: 27))
		cover: (55 to: 58)
		declaredAt: (55 to: 58).
	(systemFacade _ aSystemFacade
		cover: (93 to: 105)
		declaredAt: (34 to: 46))
		cover: (77 to: 88)
		declaredAt: (77 to: 88).
	(webServer _ [
	([
	(WebServer
		cover: (124 to: 132)
		declaredAt: (124 to: 132)) new ] valueCoveringAll:
		{134 to: 136}) listenOn:
		(port
			cover: (148 to: 151)
			declaredAt: (55 to: 58)) ] valueCoveringAll:
		{138 to: 146})
		cover: (111 to: 119)
		declaredAt: (111 to: 119).
	[
	(self coverAll:
		{157 to: 160}) addCreateCartService ] valueCoveringAll:
		{162 to: 181}.
	[
	(self coverAll:
		{188 to: 191}) addAddToCartService ] valueCoveringAll:
		{193 to: 211}.
	[
	(self coverAll:
		{216 to: 219}) addListCartService ] valueCoveringAll:
		{221 to: 238}.
	[
	(self coverAll:
		{243 to: 246}) addCheckOutCartService ] valueCoveringAll:
		{248 to: 269}.
	[
	(self coverAll:
		{275 to: 278}) addListPurchasesService ] valueCoveringAll:
		{280 to: 302}.
	[
	(self coverAll:
		{307 to: 310}) addFetchCatalogService ] valueCoveringAll:
		{312 to: 333}.
	[
	(webServer
		cover: (338 to: 346)
		declaredAt: (111 to: 119)) startListener ] valueCoveringAll:
		{348 to: 360}.! !
!Behavior method!
addCreateCartService
	^ [
	(self coverAll:
		{26 to: 29})
		addServiceWithInternalErrorHandling:
			('/createCart' coverAll:
				{68 to: 80})
		action: [ :request | | user password cartId |
			(user _ [
			([
			(request
				cover: (156 to: 162)
				declaredAt: (101 to: 107)) fields ] valueCoveringAll:
				{164 to: 169}) at:
				('clientId' coverAll:
					{174 to: 183}) ] valueCoveringAll:
				{171 to: 173})
				cover: (147 to: 150)
				declaredAt: (121 to: 124).
			(password _ [
			([
			(request
				cover: (203 to: 209)
				declaredAt: (101 to: 107)) fields ] valueCoveringAll:
				{211 to: 216}) at:
				('password' coverAll:
					{221 to: 230}) ] valueCoveringAll:
				{218 to: 220})
				cover: (190 to: 197)
				declaredAt: (126 to: 133).
			(cartId _ [
			(systemFacade
				cover: (252 to: 263)
				declaredAt: (252 to: 263))
				createCartFor:
					(user
						cover: (280 to: 283)
						declaredAt: (121 to: 124))
				authenticatedWith:
					(password
						cover: (304 to: 311)
						declaredAt: (126 to: 133)) ] valueCoveringAll:
				{265 to: 278. 285 to: 302})
				cover: (242 to: 247)
				declaredAt: (135 to: 140).
			[
			(request
				cover: (324 to: 330)
				declaredAt: (101 to: 107)) send200Response:
				([
				(self coverAll:
					{350 to: 353})
					jsonResponseWith:
						(cartId
							cover: (373 to: 378)
							declaredAt: (135 to: 140))
					indexedAs:
						('cartId' coverAll:
							{391 to: 398}) ] valueCoveringAll:
					{355 to: 371. 380 to: 389}) ] valueCoveringAll:
				{332 to: 347} ]] valueCoveringAll:
		{31 to: 66. 92 to: 98}.! !
!Behavior method!
addServiceWithInternalErrorHandling: aService action: aBlock
	[
	(webServer
		cover: (68 to: 76)
		declaredAt: (68 to: 76))
		addService:
			(aService
				cover: (90 to: 97)
				declaredAt: (38 to: 45))
		action: [ :request |
			[
			[
			[
			(aBlock
				cover: (121 to: 126)
				declaredAt: (55 to: 60)) value:
				(request
					cover: (135 to: 141)
					declaredAt: (108 to: 114)) ] valueCoveringAll:
				{128 to: 133} ]
				on:
					(Error
						cover: (148 to: 152)
						declaredAt: (148 to: 152))
				do: [ :anError |
					[
					(request
						cover: (193 to: 199)
						declaredAt: (108 to: 114)) send200Response:
						([
						(self coverAll:
							{219 to: 222}) jsonErrorResponseBasedOn:
							(anError
								cover: (250 to: 256)
								declaredAt: (180 to: 186)) ] valueCoveringAll:
							{224 to: 248}) ] valueCoveringAll:
						{201 to: 216} ]] valueCoveringAll:
				{144 to: 146. 173 to: 175} ]] valueCoveringAll:
		{78 to: 88. 99 to: 105}.! !
!Behavior method!
addAddToCartService
	^ [
	(self coverAll:
		{25 to: 28})
		addServiceWithInternalErrorHandling:
			('/addToCart' coverAll:
				{67 to: 78})
		action: [ :request | | book bookAmount cartId |
			(cartId _ [
			([
			(request
				cover: (159 to: 165)
				declaredAt: (99 to: 105)) fields ] valueCoveringAll:
				{167 to: 172}) at:
				('cartId' coverAll:
					{177 to: 184}) ] valueCoveringAll:
				{174 to: 176})
				cover: (148 to: 153)
				declaredAt: (134 to: 139).
			(book _ [
			([
			(request
				cover: (202 to: 208)
				declaredAt: (99 to: 105)) fields ] valueCoveringAll:
				{210 to: 215}) at:
				('bookIsbn' coverAll:
					{220 to: 229}) ] valueCoveringAll:
				{217 to: 219})
				cover: (193 to: 196)
				declaredAt: (118 to: 121).
			(bookAmount _ [
			([
			(request
				cover: (253 to: 259)
				declaredAt: (99 to: 105)) fields ] valueCoveringAll:
				{261 to: 266}) at:
				('bookQuantity' coverAll:
					{271 to: 284}) ] valueCoveringAll:
				{268 to: 270})
				cover: (238 to: 247)
				declaredAt: (123 to: 132).
			[
			(systemFacade
				cover: (299 to: 310)
				declaredAt: (299 to: 310))
				add:
					([
					(bookAmount
						cover: (317 to: 326)
						declaredAt: (123 to: 132)) asNumber ] valueCoveringAll:
						{328 to: 335})
				of:
					(book
						cover: (341 to: 344)
						declaredAt: (118 to: 121))
				toCartIdentifiedAs:
					([
					(cartId
						cover: (366 to: 371)
						declaredAt: (134 to: 139)) asNumber ] valueCoveringAll:
						{373 to: 380}) ] valueCoveringAll:
				{312 to: 315. 337 to: 339. 346 to: 364}.
			[
			(request
				cover: (391 to: 397)
				declaredAt: (99 to: 105)) send200Response:
				([
				(self coverAll:
					{416 to: 419}) jsonSuccessfulResponse ] valueCoveringAll:
					{421 to: 442}) ] valueCoveringAll:
				{399 to: 414} ]] valueCoveringAll:
		{30 to: 65. 88 to: 94}.! !
!Behavior method!
addListCartService
	^ [
	(self coverAll:
		{24 to: 27})
		addServiceWithInternalErrorHandling:
			('/listCart' coverAll:
				{66 to: 76})
		action: [ :request | | cartId cartContents cartContentsDictionary |
			(cartId _ [
			([
			(request
				cover: (173 to: 179)
				declaredAt: (96 to: 102)) fields ] valueCoveringAll:
				{181 to: 186}) at:
				('cartId' coverAll:
					{191 to: 198}) ] valueCoveringAll:
				{188 to: 190})
				cover: (162 to: 167)
				declaredAt: (113 to: 118).
			(cartContents _ [
			(systemFacade
				cover: (226 to: 237)
				declaredAt: (226 to: 237)) listCartIdentifiedAs:
				([
				(cartId
					cover: (261 to: 266)
					declaredAt: (113 to: 118)) asNumber ] valueCoveringAll:
					{268 to: 275}) ] valueCoveringAll:
				{239 to: 259})
				cover: (211 to: 222)
				declaredAt: (120 to: 131).
			(cartContentsDictionary _ [
			(self coverAll:
				{307 to: 310}) convertBagToDictionary:
				(cartContents
					cover: (336 to: 347)
					declaredAt: (120 to: 131)) ] valueCoveringAll:
				{312 to: 334})
				cover: (282 to: 303)
				declaredAt: (133 to: 154).
			[
			(request
				cover: (355 to: 361)
				declaredAt: (96 to: 102)) send200Response:
				([
				(self coverAll:
					{381 to: 384})
					jsonResponseWithDictionary:
						(cartContentsDictionary
							cover: (414 to: 435)
							declaredAt: (133 to: 154))
					indexedAs:
						('cartContents' coverAll:
							{448 to: 461}) ] valueCoveringAll:
					{386 to: 412. 437 to: 446}) ] valueCoveringAll:
				{363 to: 378} ]] valueCoveringAll:
		{29 to: 64. 87 to: 93}.! !
!Behavior method!
addCheckOutCartService
	^ [
	(self coverAll:
		{28 to: 31})
		addServiceWithInternalErrorHandling:
			('/checkOutCart' coverAll:
				{70 to: 84})
		action: [ :request | | cartId cardNumber cardExpirationDate cardOwner ticket |
			(cartId _ [
			([
			([
			(request
				cover: (192 to: 198)
				declaredAt: (103 to: 109)) fields ] valueCoveringAll:
				{200 to: 205}) at:
				('cartId' coverAll:
					{210 to: 217}) ] valueCoveringAll:
				{207 to: 209}) asNumber ] valueCoveringAll:
				{220 to: 227})
				cover: (181 to: 186)
				declaredAt: (122 to: 127).
			(cardNumber _ [
			([
			(request
				cover: (249 to: 255)
				declaredAt: (103 to: 109)) fields ] valueCoveringAll:
				{257 to: 262}) at:
				('ccn' coverAll:
					{267 to: 271}) ] valueCoveringAll:
				{264 to: 266})
				cover: (234 to: 243)
				declaredAt: (129 to: 138).
			(cardExpirationDate _ [
			([
			([
			(request
				cover: (302 to: 308)
				declaredAt: (103 to: 109)) fields ] valueCoveringAll:
				{310 to: 315}) at:
				('cced' coverAll:
					{320 to: 325}) ] valueCoveringAll:
				{317 to: 319}) asMonth ] valueCoveringAll:
				{328 to: 334})
				cover: (279 to: 296)
				declaredAt: (140 to: 157).
			(cardOwner _ [
			([
			(request
				cover: (355 to: 361)
				declaredAt: (103 to: 109)) fields ] valueCoveringAll:
				{363 to: 368}) at:
				('cco' coverAll:
					{373 to: 377}) ] valueCoveringAll:
				{370 to: 372})
				cover: (341 to: 349)
				declaredAt: (159 to: 167).
			(ticket _ [
			(systemFacade
				cover: (398 to: 409)
				declaredAt: (398 to: 409))
				checkOutCartIdentifiedAs:
					(cartId
						cover: (437 to: 442)
						declaredAt: (122 to: 127))
				withCreditCardNumbered:
					(cardNumber
						cover: (468 to: 477)
						declaredAt: (129 to: 138))
				ownedBy:
					(cardOwner
						cover: (489 to: 497)
						declaredAt: (159 to: 167))
				expiringOn:
					(cardExpirationDate
						cover: (511 to: 528)
						declaredAt: (140 to: 157)) ] valueCoveringAll:
				{411 to: 435. 444 to: 466. 480 to: 487. 499 to: 509})
				cover: (389 to: 394)
				declaredAt: (169 to: 174).
			[
			(request
				cover: (539 to: 545)
				declaredAt: (103 to: 109)) send200Response:
				([
				(self coverAll:
					{565 to: 568})
					jsonResponseWithDictionary:
						([
						(self coverAll:
							{599 to: 602}) convertTicketToDictionary:
							(ticket
								cover: (631 to: 636)
								declaredAt: (169 to: 174)) ] valueCoveringAll:
							{604 to: 629})
					indexedAs:
						('ticket' coverAll:
							{650 to: 657}) ] valueCoveringAll:
					{570 to: 596. 639 to: 648}) ] valueCoveringAll:
				{547 to: 562} ]] valueCoveringAll:
		{33 to: 68. 94 to: 100}.! !
!Behavior method!
addListPurchasesService
	^ [
	(self coverAll:
		{29 to: 32})
		addServiceWithInternalErrorHandling:
			('/listPurchases' coverAll:
				{71 to: 86})
		action: [ :request | | user password purchasesDictionary |
			(user _ [
			([
			(request
				cover: (168 to: 174)
				declaredAt: (104 to: 110)) fields ] valueCoveringAll:
				{176 to: 181}) at:
				('clientId' coverAll:
					{186 to: 195}) ] valueCoveringAll:
				{183 to: 185})
				cover: (159 to: 162)
				declaredAt: (120 to: 123).
			(password _ [
			([
			(request
				cover: (215 to: 221)
				declaredAt: (104 to: 110)) fields ] valueCoveringAll:
				{223 to: 228}) at:
				('password' coverAll:
					{233 to: 242}) ] valueCoveringAll:
				{230 to: 232})
				cover: (202 to: 209)
				declaredAt: (125 to: 132).
			(purchasesDictionary _ [
			(systemFacade
				cover: (277 to: 288)
				declaredAt: (277 to: 288))
				listPurchasesOf:
					(user
						cover: (307 to: 310)
						declaredAt: (120 to: 123))
				authenticatingWith:
					(password
						cover: (332 to: 339)
						declaredAt: (125 to: 132)) ] valueCoveringAll:
				{290 to: 305. 312 to: 330})
				cover: (254 to: 272)
				declaredAt: (134 to: 152).
			[
			(request
				cover: (352 to: 358)
				declaredAt: (104 to: 110)) send200Response:
				([
				(self coverAll:
					{378 to: 381})
					jsonResponseWithDictionary:
						(purchasesDictionary
							cover: (411 to: 429)
							declaredAt: (134 to: 152))
					indexedAs:
						('purchases' coverAll:
							{442 to: 452}) ] valueCoveringAll:
					{383 to: 409. 431 to: 440}) ] valueCoveringAll:
				{360 to: 375} ]] valueCoveringAll:
		{34 to: 69. 95 to: 101}.! !
!Behavior method!
addFetchCatalogService
	^ [
	(self coverAll:
		{28 to: 31})
		addServiceWithInternalErrorHandling:
			('/fetchCatalog' coverAll:
				{70 to: 84})
		action: [ :request | | catalog |
			(catalog _ [
			(systemFacade
				cover: (148 to: 159)
				declaredAt: (148 to: 159)) fetchCatalog ] valueCoveringAll:
				{161 to: 172})
				cover: (137 to: 143)
				declaredAt: (119 to: 125).
			[
			(request
				cover: (186 to: 192)
				declaredAt: (103 to: 109)) send200Response:
				([
				(self coverAll:
					{212 to: 215})
					jsonResponseWithDictionary:
						(catalog
							cover: (245 to: 251)
							declaredAt: (119 to: 125))
					indexedAs:
						('catalog' coverAll:
							{264 to: 272}) ] valueCoveringAll:
					{217 to: 243. 253 to: 262}) ] valueCoveringAll:
				{194 to: 209} ]] valueCoveringAll:
		{33 to: 68. 94 to: 100}.! !
!Behavior method!
createCartFor: aUser authenticatedWith: aPassword
	^ [
	(self coverAll:
		{55 to: 58})
		if:
			(aUser
				cover: (64 to: 68)
				declaredAt: (16 to: 20))
		authenticatesWith:
			(aPassword
				cover: (89 to: 97)
				declaredAt: (41 to: 49))
		do: [ | cartId cartSession |
			(cartId _ [
			(self coverAll:
				{141 to: 144}) generateCartId ] valueCoveringAll:
				{146 to: 159})
				cover: (131 to: 136)
				declaredAt: (107 to: 112).
			(cartSession _ [
			(CartSession
				cover: (179 to: 189)
				declaredAt: (179 to: 189))
				ownedBy:
					(aUser
						cover: (200 to: 204)
						declaredAt: (16 to: 20))
				with:
					([
					(Cart
						cover: (213 to: 216)
						declaredAt: (213 to: 216)) acceptingItemsOf:
						(catalog
							cover: (236 to: 242)
							declaredAt: (236 to: 242)) ] valueCoveringAll:
						{218 to: 234})
				on:
					(self coverAll:
						{249 to: 252}) ] valueCoveringAll:
				{191 to: 198. 206 to: 210. 245 to: 247})
				cover: (164 to: 174)
				declaredAt: (114 to: 124).
			[
			(cartSessions
				cover: (258 to: 269)
				declaredAt: (258 to: 269))
				at:
					(cartId
						cover: (275 to: 280)
						declaredAt: (107 to: 112))
				put:
					(cartSession
						cover: (287 to: 297)
						declaredAt: (114 to: 124)) ] valueCoveringAll:
				{271 to: 273. 282 to: 285}.
			cartId
				cover: (303 to: 308)
				declaredAt: (107 to: 112) ]] valueCoveringAll:
		{60 to: 62. 70 to: 87. 99 to: 101}.! !
!Behavior method!
if: aUser authenticatesWith: aPassword do: aBlock
	^ [
	([
	(self coverAll:
		{56 to: 59})
		does:
			(aUser
				cover: (67 to: 71)
				declaredAt: (5 to: 9))
		authenticatesWith:
			(aPassword
				cover: (92 to: 100)
				declaredAt: (30 to: 38)) ] valueCoveringAll:
		{61 to: 65. 73 to: 90})
		ifTrue:
			(aBlock
				cover: (113 to: 118)
				declaredAt: (44 to: 49))
		ifFalse: [
			[
			(self coverAll:
				{133 to: 136}) signalInvalidUserAndOrPassword ] valueCoveringAll:
				{138 to: 167} ]] valueCoveringAll:
		{105 to: 111. 122 to: 129}.! !
!Behavior method!
does: aUser authenticatesWith: aPassword
	"Recordar que esto es solo un ejemplo. No se deben guardar passwords en un sistema de verdad sino un
	hash o similar - Hernan"
	| storedPassword |
	(storedPassword _ [
	(validUsersAndPasswords
		cover: (212 to: 233)
		declaredAt: (212 to: 233))
		at:
			(aUser
				cover: (239 to: 243)
				declaredAt: (7 to: 11))
		ifAbsent: [ ^ false coverAll:
				{258 to: 262} ]] valueCoveringAll:
		{235 to: 237. 245 to: 253})
		cover: (194 to: 207)
		declaredAt: (175 to: 188).
	^ [
	(aPassword
		cover: (269 to: 277)
		declaredAt: (32 to: 40)) =
		(storedPassword
			cover: (281 to: 294)
			declaredAt: (175 to: 188)) ] valueCoveringAll:
		{279 to: 279}.! !
!Behavior method!
generateCartId
	"Recuerden que esto es un ejemplo, por lo que voy a generar ids numericos consecutivos, pero en una
	implementacion real no deberian se numeros consecutivos ni nada que genere problemas de seguridad - Hernan"
	(lastId _ [
	(lastId
		cover: (234 to: 239)
		declaredAt: (234 to: 239)) +
		(1 coverAll:
			{253 to: 253}) ] valueCoveringAll:
		{251 to: 251})
		cover: (244 to: 249)
		declaredAt: (234 to: 239).
	^ lastId
		cover: (259 to: 264)
		declaredAt: (234 to: 239).! !
!Behavior method!
ownedBy: aCustomer with: aCart on: aSystemFacade
	^ [
	([
	(self coverAll:
		{55 to: 58}) new ] valueCoveringAll:
		{60 to: 62})
		initializeOwnedBy:
			(aCustomer
				cover: (83 to: 91)
				declaredAt: (10 to: 18))
		with:
			(aCart
				cover: (99 to: 103)
				declaredAt: (26 to: 30))
		on:
			(aSystemFacade
				cover: (109 to: 121)
				declaredAt: (36 to: 48)) ] valueCoveringAll:
		{64 to: 81. 93 to: 97. 105 to: 107}.! !
!Behavior method!
initializeOwnedBy: aCustomer with: aCart on: aSystemFacade
	(owner _ aCustomer
		cover: (73 to: 81)
		declaredAt: (20 to: 28))
		cover: (64 to: 68)
		declaredAt: (64 to: 68).
	(cart _ aCart
		cover: (94 to: 98)
		declaredAt: (36 to: 40))
		cover: (86 to: 89)
		declaredAt: (86 to: 89).
	(systemFacade _ aSystemFacade
		cover: (119 to: 131)
		declaredAt: (46 to: 58))
		cover: (103 to: 114)
		declaredAt: (103 to: 114).
	(lastUsedTime _ [
	(self coverAll:
		{152 to: 155}) now ] valueCoveringAll:
		{157 to: 159})
		cover: (136 to: 147)
		declaredAt: (136 to: 147).! !
!Behavior method!
now
	^ [
	(systemFacade
		cover: (10 to: 21)
		declaredAt: (10 to: 21)) now ] valueCoveringAll:
		{23 to: 25}.! !
!Behavior method!
now
	^ [
	(clock
		cover: (10 to: 14)
		declaredAt: (10 to: 14)) now ] valueCoveringAll:
		{16 to: 18}.! !
!Behavior method!
now
	^ now
		cover: (11 to: 13)
		declaredAt: (11 to: 13).! !
!Behavior method!
jsonResponseWith: aJsonEncodableObject indexedAs: aKey
	^ [
	(WebUtils
		cover: (60 to: 67)
		declaredAt: (60 to: 67)) jsonEncode:
		[ | cascadeReceiver |
		cascadeReceiver _ [
		(Dictionary
			cover: (83 to: 92)
			declaredAt: (83 to: 92)) new ] valueCoveringAll:
			{94 to: 96}.
		[
		cascadeReceiver add:
			([
			('status' coverAll:
				{104 to: 111}) ->
				(0 coverAll:
					{116 to: 116}) ] valueCoveringAll:
				{113 to: 114}) ] valueCoveringAll:
			{99 to: 102}.
		[
		cascadeReceiver add:
			([
			(aKey
				cover: (124 to: 127)
				declaredAt: (51 to: 54)) ->
				(aJsonEncodableObject
					cover: (132 to: 151)
					declaredAt: (19 to: 38)) ] valueCoveringAll:
				{129 to: 130}) ] valueCoveringAll:
			{119 to: 122}.
		[ cascadeReceiver yourself ] valueCoveringAll:
			{154 to: 161} ] value ] valueCoveringAll:
		{69 to: 79}.! !
!Behavior method!
destroy
	[
	(webServer
		cover: (14 to: 22)
		declaredAt: (14 to: 22)) ifNotNil: [
		[
		(webServer
			cover: (34 to: 42)
			declaredAt: (14 to: 22)) destroy ] valueCoveringAll:
			{44 to: 50} ]] valueCoveringAll:
		{24 to: 32}.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test01CreateCartForValidCredentials stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
signalInvalidUserAndOrPassword
	[
	(self coverAll:
		{36 to: 39}) error:
		([
		(self coverAll:
			{48 to: 51}) invalidUserAndOrPasswordErrorDescription ] valueCoveringAll:
			{53 to: 92}) ] valueCoveringAll:
		{41 to: 46}.! !
!Behavior method!
invalidUserAndOrPasswordErrorDescription
	^ 'Invalid user and/or password' coverAll:
		{47 to: 76}.! !
!Behavior method!
jsonErrorResponseBasedOn: anError
	^ [
	(WebUtils
		cover: (39 to: 46)
		declaredAt: (39 to: 46)) jsonEncode:
		[ | cascadeReceiver |
		cascadeReceiver _ [
		(Dictionary
			cover: (62 to: 71)
			declaredAt: (62 to: 71)) new ] valueCoveringAll:
			{73 to: 75}.
		[
		cascadeReceiver add:
			([
			('status' coverAll:
				{83 to: 90}) ->
				(1 coverAll:
					{95 to: 95}) ] valueCoveringAll:
				{92 to: 93}) ] valueCoveringAll:
			{78 to: 81}.
		[
		cascadeReceiver add:
			([
			('errorDescription' coverAll:
				{116 to: 133}) ->
				([
				(anError
					cover: (138 to: 144)
					declaredAt: (27 to: 33)) messageText ] valueCoveringAll:
					{146 to: 156}) ] valueCoveringAll:
				{135 to: 136}) ] valueCoveringAll:
			{111 to: 114}.
		[ cascadeReceiver yourself ] valueCoveringAll:
			{171 to: 178} ] value ] valueCoveringAll:
		{48 to: 58}.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test02CreateCartForInvalidCredentials stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
add: anAmount of: aBook toCartIdentifiedAs: aCartId
	[
	(self coverAll:
		{57 to: 60})
		withCartSessionIdentifiedAs:
			(aCartId
				cover: (91 to: 97)
				declaredAt: (45 to: 51))
		do: [ :cartSession |
			[
			(cartSession
				cover: (120 to: 130)
				declaredAt: (106 to: 116))
				addToCart:
					(anAmount
						cover: (143 to: 150)
						declaredAt: (6 to: 13))
				of:
					(aBook
						cover: (156 to: 160)
						declaredAt: (19 to: 23)) ] valueCoveringAll:
				{132 to: 141. 152 to: 154} ]] valueCoveringAll:
		{62 to: 89. 99 to: 101}.! !
!Behavior method!
withCartSessionIdentifiedAs: aCartId do: aBlock
	| cartSession |
	(cartSession _ [
	(cartSessions
		cover: (84 to: 95)
		declaredAt: (84 to: 95))
		at:
			(aCartId
				cover: (101 to: 107)
				declaredAt: (30 to: 36))
		ifAbsent: [
			[
			(self coverAll:
				{120 to: 123}) signalInvalidCartId ] valueCoveringAll:
				{125 to: 143} ]] valueCoveringAll:
		{97 to: 99. 109 to: 117})
		cover: (69 to: 79)
		declaredAt: (53 to: 63).
	^ [
	(cartSession
		cover: (150 to: 160)
		declaredAt: (53 to: 63)) do:
		(aBlock
			cover: (166 to: 171)
			declaredAt: (42 to: 47)) ] valueCoveringAll:
		{162 to: 164}.! !
!Behavior method!
do: aBlock
	| now |
	(now _ [
	(self coverAll:
		{35 to: 38}) now ] valueCoveringAll:
		{40 to: 42})
		cover: (28 to: 30)
		declaredAt: (18 to: 20).
	[
	(self coverAll:
		{47 to: 50}) assertIsNotExpirtedAt:
		(now
			cover: (75 to: 77)
			declaredAt: (18 to: 20)) ] valueCoveringAll:
		{52 to: 73}.
	^ [
	[
	[
	(aBlock
		cover: (88 to: 93)
		declaredAt: (5 to: 10)) value:
		(self coverAll:
			{102 to: 105}) ] valueCoveringAll:
		{95 to: 100} ] ensure: [
		(lastUsedTime _ now
			cover: (135 to: 137)
			declaredAt: (18 to: 20))
			cover: (119 to: 130)
			declaredAt: (119 to: 130) ]] valueCoveringAll:
		{109 to: 115}.! !
!Behavior method!
assertIsNotExpirtedAt: aTime
	[
	([
	(self coverAll:
		{35 to: 38}) isExpiredAt:
		(aTime
			cover: (53 to: 57)
			declaredAt: (24 to: 28)) ] valueCoveringAll:
		{40 to: 51}) ifTrue: [
		[
		(self coverAll:
			{70 to: 73}) signalCartSessionExpired ] valueCoveringAll:
			{75 to: 98} ]] valueCoveringAll:
		{60 to: 66}.! !
!Behavior method!
isExpiredAt: aTime
	^ [
	([
	(lastUsedTime
		cover: (27 to: 38)
		declaredAt: (27 to: 38)) +
		([
		(systemFacade
			cover: (42 to: 53)
			declaredAt: (42 to: 53)) sessionDuration ] valueCoveringAll:
			{55 to: 69}) ] valueCoveringAll:
		{40 to: 40}) <
		(aTime
			cover: (74 to: 78)
			declaredAt: (14 to: 18)) ] valueCoveringAll:
		{72 to: 72}.! !
!Behavior method!
sessionDuration
	^ [
	(30 coverAll:
		{22 to: 23}) minutes ] valueCoveringAll:
		{25 to: 31}.! !
!Behavior method!
addToCart: anAmount of: aBook
	^ [
	(cart
		cover: (36 to: 39)
		declaredAt: (36 to: 39))
		add:
			(anAmount
				cover: (46 to: 53)
				declaredAt: (12 to: 19))
		of:
			(aBook
				cover: (59 to: 63)
				declaredAt: (25 to: 29)) ] valueCoveringAll:
		{41 to: 44. 55 to: 57}.! !
!Behavior method!
jsonSuccessfulResponse
	^ [
	(WebUtils
		cover: (30 to: 37)
		declaredAt: (30 to: 37)) jsonEncode:
		[ | cascadeReceiver |
		cascadeReceiver _ [
		(Dictionary
			cover: (53 to: 62)
			declaredAt: (53 to: 62)) new ] valueCoveringAll:
			{64 to: 66}.
		[
		cascadeReceiver add:
			([
			('status' coverAll:
				{74 to: 81}) ->
				(0 coverAll:
					{86 to: 86}) ] valueCoveringAll:
				{83 to: 84}) ] valueCoveringAll:
			{69 to: 72}.
		[ cascadeReceiver yourself ] valueCoveringAll:
			{89 to: 96} ] value ] valueCoveringAll:
		{39 to: 49}.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test03AddToCartReturnsProperly stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
listCartIdentifiedAs: aCartId
	^ [
	(self coverAll:
		{37 to: 40})
		withCartSessionIdentifiedAs:
			(aCartId
				cover: (71 to: 77)
				declaredAt: (23 to: 29))
		do: [ :cartSession |
			[
			(cartSession
				cover: (100 to: 110)
				declaredAt: (86 to: 96)) cartContent ] valueCoveringAll:
				{112 to: 122} ]] valueCoveringAll:
		{42 to: 69. 79 to: 81}.! !
!Behavior method!
cartContent
	^ [
	(cart
		cover: (18 to: 21)
		declaredAt: (18 to: 21)) content ] valueCoveringAll:
		{23 to: 29}.! !
!Behavior method!
content
	^ [
	(items
		cover: (14 to: 18)
		declaredAt: (14 to: 18)) copy ] valueCoveringAll:
		{20 to: 23}.! !
!Behavior method!
convertBagToDictionary: aBag
	| cartContentsDictionary |
	(cartContentsDictionary _ [
	(Dictionary
		cover: (85 to: 94)
		declaredAt: (85 to: 94)) new ] valueCoveringAll:
		{96 to: 98})
		cover: (60 to: 81)
		declaredAt: (34 to: 55).
	[
	(aBag
		cover: (102 to: 105)
		declaredAt: (25 to: 28)) do: [ :anItem |
		[
		(cartContentsDictionary
			cover: (121 to: 142)
			declaredAt: (34 to: 55)) add:
			([
			(anItem
				cover: (149 to: 154)
				declaredAt: (112 to: 117)) ->
				([
				(aBag
					cover: (160 to: 163)
					declaredAt: (25 to: 28)) occurrencesOf:
					(anItem
						cover: (180 to: 185)
						declaredAt: (112 to: 117)) ] valueCoveringAll:
					{165 to: 178}) ] valueCoveringAll:
				{156 to: 157}) ] valueCoveringAll:
			{144 to: 147} ]] valueCoveringAll:
		{107 to: 109}.
	^ cartContentsDictionary
		cover: (194 to: 215)
		declaredAt: (34 to: 55).! !
!Behavior method!
jsonResponseWithDictionary: aDictionary indexedAs: aKey
	[
	(aDictionary
		cover: (59 to: 69)
		declaredAt: (29 to: 39)) ifEmpty: [
		[
		(aDictionary
			cover: (82 to: 92)
			declaredAt: (29 to: 39)) add:
			([
			('' coverAll:
				{99 to: 100}) ->
				(0 coverAll:
					{105 to: 105}) ] valueCoveringAll:
				{102 to: 103}) ] valueCoveringAll:
			{94 to: 97} ]] valueCoveringAll:
		{71 to: 78}.
	^ [
	(WebUtils
		cover: (112 to: 119)
		declaredAt: (112 to: 119)) jsonEncode:
		[ | cascadeReceiver |
		cascadeReceiver _ [
		(Dictionary
			cover: (135 to: 144)
			declaredAt: (135 to: 144)) new ] valueCoveringAll:
			{146 to: 148}.
		[
		cascadeReceiver add:
			([
			('status' coverAll:
				{156 to: 163}) ->
				(0 coverAll:
					{168 to: 168}) ] valueCoveringAll:
				{165 to: 166}) ] valueCoveringAll:
			{151 to: 154}.
		[
		cascadeReceiver add:
			([
			(aKey
				cover: (176 to: 179)
				declaredAt: (52 to: 55)) ->
				(aDictionary
					cover: (184 to: 194)
					declaredAt: (29 to: 39)) ] valueCoveringAll:
				{181 to: 182}) ] valueCoveringAll:
			{171 to: 174}.
		[ cascadeReceiver yourself ] valueCoveringAll:
			{198 to: 205} ] value ] valueCoveringAll:
		{121 to: 131}.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test04ListCartReturnsProperly stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
notExpiredCreditCardNumber
	^ '1111222233334444' coverAll:
		{34 to: 51}.! !
!Behavior method!
notExpiredCreditCardOwner
	^ 'Juan Perez' coverAll:
		{32 to: 43}.! !
!Behavior method!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear
	^ [
	(self coverAll:
		{133 to: 136})
		withCartSessionIdentifiedAs:
			(aCartId
				cover: (169 to: 175)
				declaredAt: (27 to: 33))
		do: [ :cartSession |
			[
			(cartSession
				cover: (200 to: 210)
				declaredAt: (186 to: 196))
				checkOutCartWithCreditCardNumbered:
					(aCreditCartNumber
						cover: (251 to: 267)
						declaredAt: (59 to: 75))
				ownedBy:
					(anOwner
						cover: (281 to: 287)
						declaredAt: (86 to: 92))
				expiringOn:
					(anExpirationMonthOfYear
						cover: (304 to: 326)
						declaredAt: (106 to: 128)) ] valueCoveringAll:
				{215 to: 249. 272 to: 279. 292 to: 302} ]] valueCoveringAll:
		{140 to: 167. 179 to: 181}.! !
!Behavior method!
checkOutCartWithCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear
	^ [
	([
	(Cashier
		cover: (112 to: 118)
		declaredAt: (112 to: 118))
		toCheckout:
			(cart
				cover: (134 to: 137)
				declaredAt: (134 to: 137))
		ownedBy:
			(owner
				cover: (150 to: 154)
				declaredAt: (150 to: 154))
		charging:
			([
			(CreditCard
				cover: (169 to: 178)
				declaredAt: (169 to: 178)) expiringOn:
				(anExpirationMonthOfYear
					cover: (192 to: 214)
					declaredAt: (84 to: 106)) ] valueCoveringAll:
				{180 to: 190})
		throught:
			([
			(systemFacade
				cover: (229 to: 240)
				declaredAt: (229 to: 240)) merchantProcessor ] valueCoveringAll:
				{242 to: 258})
		on:
			([
			(self coverAll:
				{266 to: 269}) today ] valueCoveringAll:
				{271 to: 275})
		registeringOn:
			([
			(systemFacade
				cover: (294 to: 305)
				declaredAt: (229 to: 240)) salesBook ] valueCoveringAll:
				{307 to: 315}) ] valueCoveringAll:
		{122 to: 132. 141 to: 148. 158 to: 166. 219 to: 227. 262 to: 264. 279 to: 292}) checkOut ] valueCoveringAll:
		{318 to: 325}.! !
!Behavior method!
merchantProcessor
	^ merchantProcessor
		cover: (25 to: 41)
		declaredAt: (25 to: 41).! !
!Behavior method!
today
	^ [
	(systemFacade
		cover: (12 to: 23)
		declaredAt: (12 to: 23)) today ] valueCoveringAll:
		{25 to: 29}.! !
!Behavior method!
today
	^ [
	(clock
		cover: (12 to: 16)
		declaredAt: (12 to: 16)) today ] valueCoveringAll:
		{18 to: 22}.! !
!Behavior method!
today
	^ [
	(now
		cover: (12 to: 14)
		declaredAt: (12 to: 14)) date ] valueCoveringAll:
		{16 to: 19}.! !
!Behavior method!
salesBook
	^ salesBook
		cover: (17 to: 25)
		declaredAt: (17 to: 25).! !
!Behavior method!
convertTicketToDictionary: aTicket
	| ticketDictionary |
	(ticketDictionary _ [
	(Dictionary
		cover: (79 to: 88)
		declaredAt: (79 to: 88)) new ] valueCoveringAll:
		{90 to: 92})
		cover: (60 to: 75)
		declaredAt: (40 to: 55).
	[
	(aTicket
		cover: (96 to: 102)
		declaredAt: (28 to: 34)) lineItemsDo: [ :aLineItem |
		[
		(ticketDictionary
			cover: (131 to: 146)
			declaredAt: (40 to: 55)) add:
			([
			([
			(aLineItem
				cover: (153 to: 161)
				declaredAt: (119 to: 127)) item ] valueCoveringAll:
				{163 to: 166}) ->
				([
				(aLineItem
					cover: (171 to: 179)
					declaredAt: (119 to: 127)) total ] valueCoveringAll:
					{181 to: 185}) ] valueCoveringAll:
				{168 to: 169}) ] valueCoveringAll:
			{148 to: 151} ]] valueCoveringAll:
		{104 to: 115}.
	^ ticketDictionary
		cover: (193 to: 208)
		declaredAt: (40 to: 55).! !
!Behavior method!
lineItemsDo: aBlock
	^ [
	(lineItems
		cover: (26 to: 34)
		declaredAt: (26 to: 34)) do:
		(aBlock
			cover: (40 to: 45)
			declaredAt: (14 to: 19)) ] valueCoveringAll:
		{36 to: 38}.! !
!Behavior method!
item
	^ item
		cover: (12 to: 15)
		declaredAt: (12 to: 15).! !

!testRun: #TusLibrosRestAPIInterfaceTest #test05CheckOutReturnsProperly stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
listPurchasesOf: aUser authenticatingWith: aPassword
	^ [
	(self coverAll:
		{57 to: 60})
		if:
			(aUser
				cover: (66 to: 70)
				declaredAt: (18 to: 22))
		authenticatesWith:
			(aPassword
				cover: (91 to: 99)
				declaredAt: (44 to: 52))
		do: [ | sales |
			(sales _ [
			(self coverAll:
				{128 to: 131}) salesDoneBy:
				(aUser
					cover: (146 to: 150)
					declaredAt: (18 to: 22)) ] valueCoveringAll:
				{133 to: 144})
				cover: (119 to: 123)
				declaredAt: (109 to: 113).
			[
			(sales
				cover: (155 to: 159)
				declaredAt: (109 to: 113))
				inject:
					([
					(Dictionary
						cover: (172 to: 181)
						declaredAt: (172 to: 181)) new ] valueCoveringAll:
						{183 to: 185})
				into: [ :salesOrderedByBook :aSale |
					[
					(self coverAll:
						{231 to: 234})
						list:
							(aSale
								cover: (242 to: 246)
								declaredAt: (219 to: 223))
						on:
							(salesOrderedByBook
								cover: (252 to: 269)
								declaredAt: (199 to: 216)) ] valueCoveringAll:
						{236 to: 240. 248 to: 250}.
					salesOrderedByBook
						cover: (276 to: 293)
						declaredAt: (199 to: 216) ]] valueCoveringAll:
				{164 to: 170. 190 to: 194} ]] valueCoveringAll:
		{62 to: 64. 72 to: 89. 101 to: 103}.! !
!Behavior method!
salesDoneBy: aUser
	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	^ [
	(salesBook
		cover: (122 to: 130)
		declaredAt: (122 to: 130)) select: [ :aSale |
		[
		(aSale
			cover: (151 to: 155)
			declaredAt: (143 to: 147)) wasDoneBy:
			(aUser
				cover: (168 to: 172)
				declaredAt: (14 to: 18)) ] valueCoveringAll:
			{157 to: 166} ]] valueCoveringAll:
		{132 to: 138}.! !
!Behavior method!
wasDoneBy: aCustomer
	^ [
	(customer
		cover: (27 to: 34)
		declaredAt: (27 to: 34)) =
		(aCustomer
			cover: (38 to: 46)
			declaredAt: (12 to: 20)) ] valueCoveringAll:
		{36 to: 36}.! !
!Behavior method!
list: aSale on: salesOrderedByBook
	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	[
	(aSale
		cover: (133 to: 137)
		declaredAt: (7 to: 11)) lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		(oldTotal _ [
		(salesOrderedByBook
			cover: (203 to: 220)
			declaredAt: (17 to: 34))
			at:
				([
				(aLineItem
					cover: (226 to: 234)
					declaredAt: (155 to: 163)) item ] valueCoveringAll:
					{236 to: 239})
			ifAbsentPut: [
				0 coverAll:
					{256 to: 256} ]] valueCoveringAll:
			{222 to: 224. 241 to: 252})
			cover: (191 to: 198)
			declaredAt: (169 to: 176).
		(newTotal _ [
		(oldTotal
			cover: (275 to: 282)
			declaredAt: (169 to: 176)) +
			([
			(aLineItem
				cover: (286 to: 294)
				declaredAt: (155 to: 163)) total ] valueCoveringAll:
				{296 to: 300}) ] valueCoveringAll:
			{284 to: 284})
			cover: (263 to: 270)
			declaredAt: (178 to: 185).
		[
		(salesOrderedByBook
			cover: (305 to: 322)
			declaredAt: (17 to: 34))
			at:
				([
				(aLineItem
					cover: (328 to: 336)
					declaredAt: (155 to: 163)) item ] valueCoveringAll:
					{338 to: 341})
			put:
				(newTotal
					cover: (348 to: 355)
					declaredAt: (178 to: 185)) ] valueCoveringAll:
			{324 to: 326. 343 to: 346} ]] valueCoveringAll:
		{139 to: 150}.! !
!Behavior method!
lineItemsDo: aBlock
	^ [
	(ticket
		cover: (26 to: 31)
		declaredAt: (26 to: 31)) lineItemsDo:
		(aBlock
			cover: (46 to: 51)
			declaredAt: (14 to: 19)) ] valueCoveringAll:
		{33 to: 44}.! !

!testRun: #TusLibrosRestAPIInterfaceTest #test06listPurchasesReturnsProperly stamp: 'AF 11/29/2021 13:27:05'!
PASSED!
!Behavior method!
fetchCatalog
	^ catalog
		cover: (17 to: 23)
		declaredAt: (17 to: 23).! !

!testRun: #TusLibrosRestAPIInterfaceTest #test07fetchCatalogReturnsProperly stamp: 'AF 11/29/2021 13:27:05'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'AF 11/29/2021 13:27:06'!
PASSED!
!Behavior method!
signalInvalidCartId
	[
	(self coverAll:
		{25 to: 28}) error:
		([
		(self coverAll:
			{37 to: 40}) invalidCartIdErrorDescription ] valueCoveringAll:
			{42 to: 70}) ] valueCoveringAll:
		{30 to: 35}.! !
!Behavior method!
invalidCartIdErrorDescription
	^ 'Invalid cart id' coverAll:
		{36 to: 52}.! !

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'AF 11/29/2021 13:27:06'!
PASSED!
!Behavior method!
invalidItemErrorMessage
	^ [
	(Cart
		cover: (30 to: 33)
		declaredAt: (30 to: 33)) invalidItemErrorMessage ] valueCoveringAll:
		{35 to: 57}.! !

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'AF 11/29/2021 13:27:06'!
PASSED!
!Behavior method!
cartCanNotBeEmptyErrorMessage
	^ [
	(Cashier
		cover: (36 to: 42)
		declaredAt: (36 to: 42)) cartCanNotBeEmptyErrorMessage ] valueCoveringAll:
		{44 to: 72}.! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'AF 11/29/2021 13:27:06'!
PASSED!
!Behavior method!
canNotChargeAnExpiredCreditCardErrorMessage
	^ [
	(Cashier
		cover: (50 to: 56)
		declaredAt: (50 to: 56)) canNotChargeAnExpiredCreditCardErrorMessage ] valueCoveringAll:
		{58 to: 100}.! !

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'AF 11/29/2021 13:27:06'!
PASSED!
!Behavior method!
advanceTime: aDuration
	(now _ [
	(now
		cover: (28 to: 30)
		declaredAt: (28 to: 30)) +
		(aDuration
			cover: (41 to: 49)
			declaredAt: (14 to: 22)) ] valueCoveringAll:
		{39 to: 39})
		cover: (35 to: 37)
		declaredAt: (28 to: 30).! !
!Behavior method!
signalCartSessionExpired
	[
	(self coverAll:
		{30 to: 33}) error:
		([
		(systemFacade
			cover: (42 to: 53)
			declaredAt: (42 to: 53)) sessionHasExpiredErrorDescription ] valueCoveringAll:
			{55 to: 87}) ] valueCoveringAll:
		{35 to: 40}.! !
!Behavior method!
sessionHasExpiredErrorDescription
	^ [
	([
	('Can not use the cart after ' coverAll:
		{40 to: 68}) ,
		([
		([
		([
		(self coverAll:
			{71 to: 74}) sessionDuration ] valueCoveringAll:
			{76 to: 90}) minutes ] valueCoveringAll:
			{92 to: 98}) printString ] valueCoveringAll:
			{100 to: 110}) ] valueCoveringAll:
		{69 to: 69}) ,
		(' minutes of inactivity' coverAll:
			{114 to: 137}) ] valueCoveringAll:
		{112 to: 112}.! !
!Behavior method!
revertTime: aDuration
	(now _ [
	(now
		cover: (27 to: 29)
		declaredAt: (27 to: 29)) +
		([
		(aDuration
			cover: (40 to: 48)
			declaredAt: (13 to: 21)) negated ] valueCoveringAll:
			{50 to: 56}) ] valueCoveringAll:
		{38 to: 38})
		cover: (34 to: 36)
		declaredAt: (27 to: 29).! !

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'AF 11/29/2021 13:27:06'!
PASSED!

----SNAPSHOT----(29 November 2021 13:28:11) CuisUniversity-4972.image priorSource: 21711419!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:30:24'!
subscribeToEvents

	self model when: #booksAddedToCart evaluate: [self updateCartContents].
	self model when: #checkOutSuccessful evaluate: [:aTicket | CheckoutWindow openWithTicket: aTicket for: self model username and: self model password.
													self delete].
	self model when: #MultipleErrors evaluate: [:anErrorLabel :aCollectionOfErrorMessages | ErrorWindow openWith: anErrorLabel 
																						    and: aCollectionOfErrorMessages].	
	self model when: #Error evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription]! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:30:24' prior: 51005120!
initializeWith: aTitle and: aUsername and: aPassword and: aCartID 
	
	
	counterModels := Dictionary new.
	counterTextMorphs := Dictionary new.
	cartItemsQuantityMorphs := Dictionary new.

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel with: aUsername and: aPassword and: aCartID).
	self morphExtent: self defaultExtent.
	self buildMorphicWindow.
	self openInWorld.
			
	self subscribeToEvents
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:32:24' prior: 51004818!
buildAddToCartRowWith: anExtent

    | checkoutButton checkoutRow |
    
        checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #addToCart label: 'Add to cart'.

        checkoutRow := LayoutMorph newRow.
        checkoutRow separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: checkoutButton.

        ^checkoutRow.

"buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:32:28' prior: 51013572!
buildAddToCartRowWith: anExtent

    | checkoutButton row |
    
        checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #addToCart label: 'Add to cart'.

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: checkoutButton.

        ^row.

"buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:32:34' prior: 51013600!
buildAddToCartRowWith: anExtent

    | button row |
    
        button := PluggableButtonMorph model: self stateGetter: nil action: #addToCart label: 'Add to cart'.

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

"buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:34:03'!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString

    | button row |
    
        button := PluggableButtonMorph model: self stateGetter: nil action: anAction label: aString .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:34:48' prior: 51004834!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart').

    
    	^bodyLayoutMorph.! !

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

!methodRemoval: CatalogWindow #buildAddToCartRowWith: stamp: 'AF 11/29/2021 13:35:24'!
buildAddToCartRowWith: anExtent

    | button row |
    
        button := PluggableButtonMorph model: self stateGetter: nil action: #addToCart label: 'Add to cart'.

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

"buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow."!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 13:36:02' prior: 51004988!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'CheckOut').

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 13:36:15' prior: 51013711!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout').

	
	^cartListColumnMorph.! !

LoginWindow open.!

!methodRemoval: CatalogWindow #buildCheckoutRowWith: stamp: 'AF 11/29/2021 13:36:59'!
buildCheckoutRowWith: anExtent
	| checkoutButton checkoutRow |
	
	checkoutButton := PluggableButtonMorph model: self model stateGetter: nil action: #checkOut  label: 'Checkout'.
	
	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 0@0;
	axisEdgeWeight: 0.5;
	morphExtent: (anExtent x) @ (anExtent y * 0.2);
 	addMorph: checkoutButton.
	
	^checkoutRow.!

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:38:29'!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString andModel: aModel 

    | button row |
    
        button := PluggableButtonMorph model: self stateGetter: nil action: anAction label: aString .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:38:29' prior: 51013730!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: model).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:38:29' prior: 51013667!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: model).

    
    	^bodyLayoutMorph.! !

!methodRemoval: CatalogWindow #buildButtonRowWith:andAction:andLabel: stamp: 'AF 11/29/2021 13:38:29'!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString

    | button row |
    
        button := PluggableButtonMorph model: self stateGetter: nil action: anAction label: aString .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 13:38:46' prior: 51013780!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:38:50' prior: 51013800!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 13:39:29' prior: 51013764!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString andModel: aModel 

    | button row |
    
        button := PluggableButtonMorph model: aModel stateGetter: nil action: anAction label: aString .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 13:53:52' prior: 51004880!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:00:28' prior: 51005116 overrides: 50965689!
defaultExtent

	^ 1000@685
	! !

LoginWindow open.!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:00:51' prior: 51013925 overrides: 50965689!
defaultExtent

	^ 1100@685
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:01:01' prior: 51013931 overrides: 50965689!
defaultExtent

	^ 1150@685
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:01:15' prior: 51013938 overrides: 50965689!
defaultExtent

	^ 1200@685
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:01:40' prior: 51013945 overrides: 50965689!
defaultExtent

	^ 1200@500
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:02:04' prior: 51013952 overrides: 50965689!
defaultExtent

	^ 1175@500
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:02:49' prior: 51004901!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.4).
	^ itemMorph! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:03:28' prior: 51005005!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'Quantity' ownerExtent: anExtent).
	^ catalogMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:04:34' prior: 51004967!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:08:13' prior: 51013992!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	quantityMorph axisEdgeWeight: 0.5.
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:08:27' prior: 51014013!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:08:57' prior: 51013959 overrides: 50965689!
defaultExtent

	^ 1100@500
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

	^ 1000@500!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:09:29' prior: 51014059 overrides: 50965689!
defaultExtent

	^ 1000@500
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:10:21' prior: 51013833!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.2)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:10:51' prior: 51014073!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.3)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:11:27' prior: 51013853!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.7)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:11:41' prior: 51014117!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.6)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:12:02' prior: 51014095!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.35)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:12:41' prior: 51014155!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:12:47' prior: 51014136!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:13:31' prior: 51013965!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x * 0.4).
	^ itemMorph! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:13:44' prior: 51014216!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x * 0.5).
	^ itemMorph! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:14:19' prior: 51014226!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x * 0.4).
	^ itemMorph! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:15:05' prior: 51014067 overrides: 50965689!
defaultExtent

	^ 1100@500
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

----SNAPSHOT----(29 November 2021 14:15:30) CuisUniversity-4972.image priorSource: 21820045!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:22:09' prior: 51004849!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCatalogTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).


	^ itemMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:24:14' prior: 51013889!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self buildCatalogListHeaderWithExtent: scrollMorph morphExtent).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.
	
	columnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	columnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:27:22'!
build2ColumnListHeaderWithExtent: anExtent withLabels: firstColumnName and: secondColumnName
	
	| listHeaderMorph |
	
	listHeaderMorph := LayoutMorph newRow.
	listHeaderMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: firstColumnName ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: secondColumnName ownerExtent: anExtent).
	
	^ listHeaderMorph.
! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:28:19' prior: 51014279!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Books Title' and: 'Price' ).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.
	
	columnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	columnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:30:20' prior: 51014328!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	catalogMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Books Title' and: 'Price' ).
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.
	
	columnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	columnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:31:49' prior: 51014199!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self build2ColumnListHeaderWithExtent: bodyLayoutMorph morphExtent withLabels: 'Books Title' and: 'Price');
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:32:06' prior: 51014365!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	"catalogMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Books Title' and: 'Price' )."
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.
	
	columnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	columnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:33:40' prior: 51014421!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	
	"buildCartListMorphWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.
	
	columnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	columnMorph addMorph: (self buildCartListHeaderWithExtent: scrollMorph morphExtent).

	
	^ scrollMorph."! !

!methodRemoval: CatalogWindow #buildCatalogListHeaderWithExtent: stamp: 'AF 11/29/2021 14:33:52'!
buildCatalogListHeaderWithExtent: anExtent
	
	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildCatalogTableItem: 'Price' ownerExtent: anExtent).
	^ catalogMorph.!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:34:52' prior: 51005020!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' ).

	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:35:28' prior: 51014400!
buildCatalogColumn

  	| bodyLayoutMorph |

 	bodyLayoutMorph := LayoutMorph newColumn.
  	bodyLayoutMorph separation: 1@1;
  	axisEdgeWeight: 0.0;
  	morphExtent: (self defaultExtent x * 0.5)@(self defaultExtent y * 0.70) ;
	addMorph: (self build2ColumnListHeaderWithExtent: bodyLayoutMorph morphExtent withLabels: 'Book Title' and: 'Price');
	addMorph: (self buildCatalogMorphWith: bodyLayoutMorph morphExtent);
	addMorph: (self buildButtonRowWith: bodyLayoutMorph morphExtent andAction: #addToCart andLabel: 'Add to cart' andModel: self).

    
    	^bodyLayoutMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:36:26' prior: 51014179!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70);
	addMorph: (self build2ColumnListHeaderWithExtent: cartListColumnMorph morphExtent withLabels: 'Book Title' and: 'Price').
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:36:42' prior: 51014545!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70);
	addMorph: (self build2ColumnListHeaderWithExtent: cartListColumnMorph morphExtent withLabels: 'Book Title' and: 'Quantity').
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:37:39' prior: 51014504!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	"rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' )."

	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:38:06' prior: 51014596!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: (anExtent x) @ (anExtent y);
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	"rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' )."

	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:38:40' prior: 51014036!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:41:24' prior: 51014616!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	"rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' )."

	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:43:37' prior: 51014568!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:43:44' prior: 51014656!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' ).

	
	^ scrollMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:46:11' prior: 51014675!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	cartListMorph borderColor: Color yellow.
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:46:25' prior: 51014713!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	cartListMorph color: Color yellow.
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:46:43' prior: 51014736!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).

	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:48:01' prior: 51014635!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color lightOrange ;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:48:30' prior: 51014781!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color lightYellow ;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:48:48' prior: 51014803!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color orange;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:49:45' prior: 51014825!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color tan;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:51:04' prior: 51014847!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color lightOrange ;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:51:31' prior: 51013871!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString andModel: aModel 

    | button row |
    
        button := PluggableButtonMorph model: aModel stateGetter: nil action: anAction label: aString .
	button color: Color lightOrange .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:51:42' prior: 51014890!
buildButtonRowWith: anExtent andAction: anAction andLabel: aString andModel: aModel 

    | button row |
    
        button := PluggableButtonMorph model: aModel stateGetter: nil action: anAction label: aString .

        row := LayoutMorph newRow.
        row separation: 25@0;
        axisEdgeWeight: 1.0;
        morphExtent: (anExtent x) @ (anExtent y * 0.2);
        addMorph: button.

        ^row.

! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:51:58' prior: 51014869!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color lightGray ;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:52:08' prior: 51014926!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color veryLightGray ;
	addMorph: (self buildCatalogTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildCatalogTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:52:50' prior: 51014460!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:54:43' prior: 51014694!
buildCartListMorphWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: rightColumnMorph.
	
	rightColumnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	
	rightColumnMorph addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' ).

	
	^ scrollMorph.
	
	"catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0.
	"! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:54:52' prior: 51014970!
buildCatalogMorphWith: anExtent
	
	| catalogMorph scrollMorph catalog |
	
	catalogMorph := LayoutMorph newColumn.
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: catalogMorph.
	
	catalogMorph separation: 0; 
	axisEdgeWeight: 0.0.
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | catalogMorph addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:56:22'!
buildScrollableListWith: anExtent

	| rightColumnMorph scrollMorph |
	
	rightColumnMorph := LayoutMorph newColumn.
	rightColumnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: rightColumnMorph.

	^ scrollMorph.
	
! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:56:39' prior: 51015032!
buildScrollableListWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.

	^ scrollMorph.
	
! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:56:43' prior: 51015045!
buildScrollableListWith: anExtent

	| columnMorph scrollMorph |
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 0; 
	axisEdgeWeight: 0.0.
	
	scrollMorph := PluggableScrollPane new.
	scrollMorph morphExtent: anExtent;
	scroller: columnMorph.

	^scrollMorph.
	
! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 14:57:42' prior: 51014989!
buildCartListMorphWith: anExtent

	| scrollMorph |
	
	scrollMorph _ self buildScrollableListWith: anExtent.

	scrollMorph scroller addMorph: (self build2ColumnListHeaderWithExtent: scrollMorph morphExtent withLabels: 'Book Title' and: 'Quantity' ).
	
	^ scrollMorph.
! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:58:27' prior: 51015012!
buildCatalogMorphWith: anExtent
	
	| scrollMorph catalog |
	
	scrollMorph _ self buildScrollableListWith: anExtent.
	
	catalog _ self model catalog.
	catalog keys do: [: aTitle | scrollMorph scroller addMorph: (self buildCatalogItemRowWithName: aTitle withPrice: (catalog at: aTitle) asString withExtent: scrollMorph morphExtent).].
	
	^ scrollMorph.
	
	! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 14:59:37'!
buildTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x * 0.4).
	^ itemMorph! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:59:37' prior: 51014262!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).


	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:59:37' prior: 51014948!
buildCartItemRowWith: aQuantity of: aBookTitle withExtent: anExtent

	| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color veryLightGray ;
	addMorph: (self buildTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph.! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:59:37' prior: 51014312!
build2ColumnListHeaderWithExtent: anExtent withLabels: firstColumnName and: secondColumnName
	
	| listHeaderMorph |
	
	listHeaderMorph := LayoutMorph newRow.
	listHeaderMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: firstColumnName ownerExtent: anExtent);
	addMorph: (self buildTableItem: secondColumnName ownerExtent: anExtent).
	
	^ listHeaderMorph.
! !
!CatalogWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 14:59:37' prior: 51013977!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildTableItem: 'Quantity' ownerExtent: anExtent).
	^ catalogMorph.! !

!methodRemoval: CatalogWindow #buildCatalogTableItem:ownerExtent: stamp: 'AF 11/29/2021 14:59:37'!
buildCatalogTableItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x * 0.4).
	^ itemMorph!

!methodRemoval: CatalogWindow #buildCartListHeaderWithExtent: stamp: 'AF 11/29/2021 15:00:25'!
buildCartListHeaderWithExtent: anExtent

	| catalogMorph |
	
	catalogMorph := LayoutMorph newRow.
	catalogMorph separation: 1@1; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildTableItem: 'Quantity' ownerExtent: anExtent).
	^ catalogMorph.!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 15:00:52' prior: 51015109!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 1@1; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).


	^ itemMorph.
	
	"| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color veryLightGray ;
	addMorph: (self buildTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph."! !
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 15:00:56' prior: 51015197!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).


	^ itemMorph.
	
	"| itemMorph quantityMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	color: Color veryLightGray ;
	addMorph: (self buildTableItem: aBookTitle ownerExtent: itemMorph morphExtent).
	
	
	quantityMorph _ (self buildTableItem: aQuantity asString ownerExtent: itemMorph morphExtent).
	
	itemMorph addMorph: quantityMorph.
	
	cartItemsQuantityMorphs add: aBookTitle -> quantityMorph.
	

	^ itemMorph."! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!
!CatalogWindow methodsFor: 'catalog' stamp: 'AF 11/29/2021 15:02:36' prior: 51015228!
buildCatalogItemRowWithName: aBookName withPrice: aPrice withExtent: anExtent 

	| itemMorph |
	itemMorph := LayoutMorph newRow.
	itemMorph separation: 0@0; 
	morphWidth: anExtent x; 
	axisEdgeWeight: 0.0;
	addMorph: (self buildTableItem: aBookName ownerExtent: itemMorph morphExtent);
	addMorph: (self buildTableItem: aPrice ownerExtent: itemMorph morphExtent);
	addMorph: (self buildCounterMorph: aBookName).


	^ itemMorph.
! !
!CatalogWindow methodsFor: 'cart' stamp: 'AF 11/29/2021 15:03:13' prior: 51014759!
buildCartListColumn

	| cartListColumnMorph |
		
	cartListColumnMorph := LayoutMorph newColumn.
	cartListColumnMorph separation: 1@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x * 0.4)@(self defaultExtent y * 0.70).
	
	cartListMorph := (self buildCartListMorphWith: cartListColumnMorph morphExtent).
	
	cartListColumnMorph addMorph: cartListMorph;
	addMorph: (self buildButtonRowWith: cartListColumnMorph morphExtent andAction: #checkOut andLabel: 'Checkout' andModel: self model).

	
	^cartListColumnMorph.! !

Object subclass: #TusLibrosRequestSender
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #TusLibrosRequestSender category: 'TusLibros-Graphics' stamp: 'AF 11/29/2021 15:11:29'!
Object subclass: #TusLibrosRequestSender
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:12:50' prior: 51005792!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse respDict raisedErrors |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		respDict _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(respDict at: 'status') = 0
			ifFalse: [
				raisedErrors add: anISBN -> (respDict at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [self triggerEvent: #MultipleErrors withArguments: { 'The following books could not be added'. raisedErrors}].
	
	self triggerEvent: #booksAddedToCart! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:13:03' prior: 51015311!
addToCart: aDictionaryOfBooksAndQuantitys

	|client notDecodedResponse responseDictionary raisedErrors |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=',cartId asString,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(responseDictionary at: 'status') = 0
			ifFalse: [
				raisedErrors add: anISBN -> (responseDictionary at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	raisedErrors ifNotEmpty: [self triggerEvent: #MultipleErrors withArguments: { 'The following books could not be added'. raisedErrors}].
	
	self triggerEvent: #booksAddedToCart! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'no messages' stamp: 'AF 11/29/2021 15:15:43'!
add: aDictionaryOfBooksAndQuantitys ToCart: aCartId

	|client notDecodedResponse responseDictionary raisedErrors |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: 'http://localhost:8080/addToCart?cartId=', aCartId,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(responseDictionary at: 'status') = 0
			ifFalse: [
				raisedErrors add: anISBN -> (responseDictionary at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	^raisedErrors .! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:16:49' prior: 51015342!
addToCart: aDictionaryOfBooksAndQuantitys

	|raisedErrors |

	raisedErrors _ TusLibrosRequestSender new add: aDictionaryOfBooksAndQuantitys ToCart: cartId asString.
	
	raisedErrors ifNotEmpty: [self triggerEvent: #MultipleErrors withArguments: { 'The following books could not be added'. raisedErrors}].
	
	self triggerEvent: #booksAddedToCart! !

CatalogWindow openWithUser: 'admin' andPass: 'admin' andCart: 2!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:17:32'!
encodeSpacesForUrl: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:19:25'!
checkOut: aCartId

	|client notDecodedResponse cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId,
					    										    '&ccn=', cnn, 
					    										  '&cced=', cced,
					    										   '&cco=', cco).
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:19:55' prior: 51015432!
checkOut: aCartId

	|client notDecodedResponse cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=', aCartId,
					    										    '&ccn=', cnn, 
					    										  '&cced=', cced,
					    										   '&cco=', cco).
	client close.
	
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	
	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:20:07' prior: 51005834!
checkOut

	|client notDecodedResponse responseDictionary cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: 'http://localhost:8080/checkOutCart?cartId=',cartId asString,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	

	! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:20:42' prior: 51015475!
checkOut

	|responseDictionary |
	
	responseDictionary _ TusLibrosRequestSender checkOut: cartId asString.
	
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	

	! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:21:40' prior: 51015505!
checkOut

	|responseDictionary |
	
	responseDictionary _ TusLibrosRequestSender new checkOut: cartId asString.
	
	(responseDictionary at: 'status') = 0
		ifTrue: [
			self triggerEvent: #checkOutSuccessful with: (responseDictionary at: 'ticket')
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].
	

	! !

!methodRemoval: CatalogWindowModel #encodeSpacesForUrl: stamp: 'AF 11/29/2021 15:22:23'!
encodeSpacesForUrl: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:23:26'!
fetchCatalog

	|client notDecodedResponse |
	
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:23:35' prior: 51015544!
fetchCatalog

	|client notDecodedResponse |
	
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/fetchCatalog').
	
	client close.
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:24:13' prior: 51005870!
fetchCatalog

	|responseDictionary errorRaised|
	
	catalog _ Dictionary new.

	responseDictionary _ TusLibrosRequestSender new fetchCatalog.
	
	(responseDictionary at: 'status') = 0
		ifTrue: [
			catalog _ responseDictionary at: 'catalog'
		] 
		ifFalse: [
			errorRaised _ (responseDictionary at: 'errorDescription'),' - It was not possible to retrieve the catalog'.
			self triggerEvent: #Error with: errorRaised.			
		].

	! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:25:57'!
listCart: aCartId

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listCart?cartId=',aCartId).
	
	client close.
	
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:27:13' prior: 51005900!
listCart

	|responseDictionary cartContents |
	
	cartContents _ Dictionary new.

	responseDictionary _ TusLibrosRequestSender new listCart: cartId asString.
	
	(responseDictionary at: 'status') = 0
		ifTrue: [
			cartContents _ responseDictionary at: 'cartContents'
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].

	
	^cartContents.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:30:22'!
url
	
	^'http://localhost:', self port asString! !

!classDefinition: #TusLibrosRequestSender category: 'TusLibros-Graphics' stamp: 'AF 11/29/2021 15:30:36'!
Object subclass: #TusLibrosRequestSender
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:30:35'!
port
	
	^port ifNil: [port:=8080].! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:31:06' prior: 51015378!
add: aDictionaryOfBooksAndQuantitys ToCart: aCartId

	|client notDecodedResponse responseDictionary raisedErrors |
	client _ WebClient new.
	raisedErrors _ Dictionary new.
	aDictionaryOfBooksAndQuantitys keysAndValuesDo: [:anISBN :aQuantity | aQuantity = 0 ifFalse:[
		|encodedISBN|
		encodedISBN _ self encodeSpacesForUrl: anISBN.
		notDecodedResponse _ (client httpGet: self url, '/addToCart?cartId=', aCartId,'&bookIsbn=', encodedISBN ,'&bookQuantity=', aQuantity asString).
		responseDictionary _ WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
		(responseDictionary at: 'status') = 0
			ifFalse: [
				raisedErrors add: anISBN -> (responseDictionary at: 'errorDescription').
			]
		]
	].
	
	client close.
	
	^raisedErrors .! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:31:41' prior: 51015453!
checkOut: aCartId

	|client notDecodedResponse cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: self url, '/checkOutCart?cartId=', aCartId,
					    										    '&ccn=', cnn, 
					    										  '&cced=', cced,
					    										   '&cco=', cco).
	client close.
	
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	
	! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:31:45' prior: 51015669!
checkOut: aCartId

	|client notDecodedResponse cced cco cnn |
	client _ WebClient new.
	
	cnn _ '1111222233334444'.
	cced _ self encodeSpacesForUrl: (Month month: DateAndTime now monthIndex year: DateAndTime now yearNumber + 1) asString.
	cco _ self encodeSpacesForUrl: 'Juan Perez'.

	notDecodedResponse _ (client httpGet: self url, '/checkOutCart?cartId=', aCartId,
			    										    '&ccn=', cnn, 
			    										  '&cced=', cced,
			    										   '&cco=', cco).
	client close.
	
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.
	
	! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:32:07' prior: 51015555!
fetchCatalog

	|client notDecodedResponse |
	
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: self url, '/fetchCatalog').
	
	client close.
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!TusLibrosRequestSender methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:32:13' prior: 51015587!
listCart: aCartId

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: self url, '/listCart?cartId=',aCartId).
	
	client close.
	
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'sending requests' stamp: 'AF 11/29/2021 15:35:11'!
createCartFor: aUser and: aPassword

	|client notDecodedResponse |
	client _ WebClient new.
	notDecodedResponse _ (client httpGet: self url,'/createCart?clientId=', aUser,'&password=', aPassword ).
	client close.
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:36:17' prior: 51006102!
authenticate

	|respDict |

	respDict _ TusLibrosRequestSender new createCartFor: self username and: self password.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (respDict at: 'errorDescription').
		].
	
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:36:40' prior: 51015750!
authenticate

	|responseDictionary |

	responseDictionary _ TusLibrosRequestSender new createCartFor: self username and: self password.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ responseDictionary at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (responseDictionary at: 'errorDescription').
		].
	
	! !
!LoginWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:36:43' prior: 51015767!
authenticate

	|responseDictionary |

	responseDictionary _ TusLibrosRequestSender new createCartFor: self username and: self password.
	
	(responseDictionary at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ responseDictionary at: 'cartId'.
			
			self triggerEvent: #authenticationSuccess  withArguments: {username copy. password copy. cartId.}
			
		] 
		ifFalse: [
			
			self triggerEvent: #authenticationFailure with: (responseDictionary at: 'errorDescription').
		].
	
	! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 15:37:39) CuisUniversity-4972.image priorSource: 21843457!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'sending requests' stamp: 'AF 11/29/2021 15:40:12'!
listPurchasesOf: aUsername and: aPassword

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: 'http://localhost:8080/listPurchases?clientId=', aUsername ,'&password=', aPassword).
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!TusLibrosRequestSender methodsFor: 'sending requests' stamp: 'AF 11/29/2021 15:40:28' prior: 51015816!
listPurchasesOf: aUsername and: aPassword

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: self url, '/listPurchases?clientId=', aUsername ,'&password=', aPassword).
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!TusLibrosRequestSender methodsFor: 'sending requests' stamp: 'AF 11/29/2021 15:40:38' prior: 51015829!
listPurchasesOf: aUsername and: aPassword

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: self url, '/listPurchases?clientId=', aUsername ,'&password=', aPassword).
	
	client close
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !
!PurchaseHistoryWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:41:50' prior: 51006172!
listPurchases

	|responseDictionary |
	
	purchases _ Dictionary new.
	
	responseDictionary _ TusLibrosRequestSender new listPurchasesOf: username and: password.
	(responseDictionary at: 'status') = 0
		ifTrue: [
			purchases _ responseDictionary at: 'purchases'
		] 
		ifFalse: [
			self triggerEvent: #Error with: (responseDictionary at: 'errorDescription')
		].


	! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!TusLibrosRequestSender methodsFor: 'sending requests' stamp: 'AF 11/29/2021 15:42:50' prior: 51015842!
listPurchasesOf: aUsername and: aPassword

	|client notDecodedResponse |
	client _ WebClient new.
	
	notDecodedResponse _ (client httpGet: self url, '/listPurchases?clientId=', aUsername ,'&password=', aPassword).
	
	client close.
	^WebUtils jsonMapFrom: (notDecodedResponse content) readStream.! !

----SNAPSHOT----(29 November 2021 15:43:13) CuisUniversity-4972.image priorSource: 21893120!
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:45:00' prior: 51005965!
newPurchase

	|client respDict |

	respDict _ TusLibrosRequestSender new createCartFor: username and: password.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #newPurchase  with: cartId
			
		] 
		ifFalse: [
			
			self triggerEvent: #logout
		].
! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:45:06' prior: 51015891!
newPurchase

	|respDict |

	respDict _ TusLibrosRequestSender new createCartFor: username and: password.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #newPurchase  with: cartId
			
		] 
		ifFalse: [
			
			self triggerEvent: #logout
		].
! !
!CheckoutWindowModel methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:45:07' prior: 51015905!
newPurchase

	| respDict |

	respDict _ TusLibrosRequestSender new createCartFor: username and: password.
	(respDict at: 'status') = 0
		ifTrue: [
			|cartId|
			cartId _ respDict at: 'cartId'.
			
			self triggerEvent: #newPurchase  with: cartId
			
		] 
		ifFalse: [
			
			self triggerEvent: #logout
		].
! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:48:37' prior: 51005391!
ErrorRowFor: anISBN text: err
    
    | morph |
    morph _ LayoutMorph  newRow.
    morph separation: 0@0;
    axisEdgeWeight: 0.0;
    addMorph: (LabelMorph contents: (anISBN, ': ', err)).
    ^ morph! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:48:44' prior: 51015931!
ErrorRowFor: anISBN text: anError
    
    | morph |
    morph _ LayoutMorph  newRow.
    morph separation: 0@0;
    axisEdgeWeight: 0.0;
    addMorph: (LabelMorph contents: (anISBN, ': ', anError)).
    ^ morph! !
!ErrorWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:48:52' prior: 51015941!
ErrorRowFor: anISBN text: anErrorMessage
    
    | morph |
    morph _ LayoutMorph  newRow.
    morph separation: 0@0;
    axisEdgeWeight: 0.0;
    addMorph: (LabelMorph contents: (anISBN, ': ', anErrorMessage)).
    ^ morph! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:52:32' prior: 51005224!
buildButtons


| checkoutButton checkoutRow checkoutButton2|

checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #logout  label: 'Logout'.
checkoutButton2 := PluggableButtonMorph model: self model stateGetter: nil action: #newPurchase  label: 'New Purchase'.

checkoutRow := LayoutMorph newRow.
checkoutRow separation: 50@0;
axisEdgeWeight: 0.5;
morphExtent: self defaultExtent;
addMorph: checkoutButton;
addMorph: checkoutButton2.

^checkoutRow.
	! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:52:39' prior: 51015962!
buildButtons

	| checkoutButton checkoutRow checkoutButton2|

	checkoutButton := PluggableButtonMorph model: self stateGetter: nil action: #logout  label: 'Logout'.
	checkoutButton2 := PluggableButtonMorph model: self model stateGetter: nil action: #newPurchase  label: 'New Purchase'.

	checkoutRow := LayoutMorph newRow.
	checkoutRow separation: 50@0;
	axisEdgeWeight: 0.5;
	morphExtent: self defaultExtent;
	addMorph: checkoutButton;
	addMorph: checkoutButton2.

	^checkoutRow.
	! !

----SNAPSHOT----(29 November 2021 15:53:49) CuisUniversity-4972.image priorSource: 21895562!
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:54:56' prior: 51005667!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^itemMorph
	
	! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:56:55' prior: 51005689!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
	
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model purchases associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:59:33'!
buildListMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:59:33' prior: 51005256 overrides: 50965593!
buildMorphicWindow
       
	
	self layoutMorph beColumn;
	separation: 10;
 	axisEdgeWeight: 0.0;
 	morphExtent: self defaultExtent;
	addMorph:  (LabelMorph contents: 'Checkout');
	addMorph: (self buildListMorphWith: self defaultExtent );
	addMorph:  (LabelMorph contents: 'Total spent: $', self model ticketTotal);
	addMorph: self buildButtons.
	
! !

!methodRemoval: CheckoutWindow #buildTicketMorphWith: stamp: 'AF 11/29/2021 15:59:33'!
buildTicketMorphWith: anExtent

    	| ticketListMorph scrollMorph |
    
    	ticketListMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: ticketListMorph.
    
    	ticketListMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	ticketListMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | ticketListMorph addMorph: (self buildTicketListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 15:59:43' prior: 51016036!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildTicketHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildTicketListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:00:37' prior: 51005270!
buildTicketHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:00:51'!
buildListHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:00:51' prior: 51016101!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildTicketListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !

!methodRemoval: CheckoutWindow #buildTicketHeaderWithExtent: stamp: 'AF 11/29/2021 16:00:51'!
buildTicketHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildTicketItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildTicketItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.!

!methodRemoval: CheckoutWindow #buildCheckoutHeader stamp: 'AF 11/29/2021 16:01:31'!
buildCheckoutHeader
	| firstRowLayoutMorph |
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25@1;
	axisEdgeWeight: 0.0;
	morphExtent: (self defaultExtent x)@1;
	addMorph:  (LabelMorph contents: 'test').
	
	^firstRowLayoutMorph.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:01:51'!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:01:51' prior: 51016139!
buildListHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:01:51' prior: 51005293!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !

!methodRemoval: CheckoutWindow #buildTicketItem:ownerExtent: stamp: 'AF 11/29/2021 16:01:51'!
buildTicketItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:02:31'!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:02:31' prior: 51016153!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !

!methodRemoval: CheckoutWindow #buildTicketListRowWith:and:andExtent: stamp: 'AF 11/29/2021 16:02:31'!
buildTicketListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 16:02:39) CuisUniversity-4972.image priorSource: 21899109!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

Panel subclass: #SummaryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #SummaryWindow category: 'TusLibros-Graphics' stamp: 'AF 11/29/2021 16:03:35'!
Panel subclass: #SummaryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!
!SummaryWindow methodsFor: 'no messages' stamp: 'AF 11/29/2021 16:03:45'!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:03:53'!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:04:00'!
buildListHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:04:06'!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph! !
!CheckoutWindow methodsFor: 'initialization' stamp: 'AF 11/29/2021 16:05:22'!
subscribeToEvents

	self model when: #newPurchase evaluate: [:aCartId | CatalogWindow openWithUser: self model username andPass: self model password andCart: aCartId.
											 	self delete.].
	self model when: #logout evaluate: [self logout ]! !
!CheckoutWindow methodsFor: 'initialization' stamp: 'AF 11/29/2021 16:05:22' prior: 51005337!
initializeWith: aTicket for: aUsername and: aPassword  

 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Thanks for your purchase!!'.
	self model: (CheckoutWindowModel with: aTicket for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.


	self subscribeToEvents.! !
!PurchaseHistoryWindow methodsFor: 'initialization' stamp: 'AF 11/29/2021 16:05:35'!
subscribeToEvents

	^ self model when: #Error evaluate: [:anErrorDescription | ErrorWindow openWith: anErrorDescription.
												self delete ]! !
!PurchaseHistoryWindow methodsFor: 'initialization' stamp: 'AF 11/29/2021 16:05:35' prior: 51005746!
initializeFor: aUsername and: aPassword
 
 	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: 'Purchase History'.
	self model: (PurchaseHistoryWindowModel for: aUsername and: aPassword ).
	self morphExtent: self defaultExtent.
 	self buildMorphicWindow.
 	self openInWorld.

	
	self subscribeToEvents! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:06:21' overrides: 50965689!
defaultExtent
	 ^ 600@500
! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:06:44' overrides: 50965593!
buildMorphicWindow
       
	
	self subclassResponsibility .
! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:06:56'!
initializeWith: aTicket for: aUsername and: aPassword  
       
	
	self subclassResponsibility .
! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:07:11'!
subscribeToEvents
	
	self subclassResponsibility .
! !

SummaryWindow subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #CheckoutWindow category: 'TusLibros-Graphics' stamp: 'AF 11/29/2021 16:07:36'!
SummaryWindow subclass: #CheckoutWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

SummaryWindow subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!classDefinition: #PurchaseHistoryWindow category: 'TusLibros-Graphics' stamp: 'AF 11/29/2021 16:07:49'!
SummaryWindow subclass: #PurchaseHistoryWindow
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Graphics'!

!methodRemoval: CheckoutWindow #buildListHeaderWithExtent: stamp: 'AF 11/29/2021 16:08:07'!
buildListHeaderWithExtent: anExtent

	    | headerMorph |
	    
	    headerMorph := LayoutMorph newRow.
	    headerMorph separation: 0@0; 
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: 'Book name' ownerExtent: anExtent);
	    addMorph: (self buildItem: 'Spent' ownerExtent: anExtent).
	    ^ headerMorph.!

!methodRemoval: CheckoutWindow #buildListMorphWith: stamp: 'AF 11/29/2021 16:08:10'!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.!

!methodRemoval: CheckoutWindow #buildListRowWith:and:andExtent: stamp: 'AF 11/29/2021 16:08:13'!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.!

!methodRemoval: CheckoutWindow #buildItem:ownerExtent: stamp: 'AF 11/29/2021 16:08:20'!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^ itemMorph!

!methodRemoval: PurchaseHistoryWindow #defaultExtent stamp: 'AF 11/29/2021 16:08:37'!
defaultExtent
	 ^ 600@500
!

!methodRemoval: CheckoutWindow #defaultExtent stamp: 'AF 11/29/2021 16:08:42'!
defaultExtent
	 ^ 600@500
!

!methodRemoval: PurchaseHistoryWindow #buildItem:ownerExtent: stamp: 'AF 11/29/2021 16:08:50'!
buildItem: aName ownerExtent: anExtent 
	
	| itemMorph |
	
	itemMorph := LabelMorph contents: aName font: FontFamily defaultFamilyAndPointSize.
	itemMorph morphWidth: (anExtent x *0.45).
	^itemMorph
	
	!

!methodRemoval: PurchaseHistoryWindow #buildListHeaderWithExtent: stamp: 'AF 11/29/2021 16:08:51'!
buildListHeaderWithExtent: anExtent 

	| headerMorph |
	    
	headerMorph := LayoutMorph newRow.
	headerMorph separation: 0@0; 
	axisEdgeWeight: 0.5;
	addMorph: (self buildItem: 'Book name' ownerExtent: anExtent);
	addMorph: (self buildItem: 'Spent' ownerExtent: anExtent).
	^ headerMorph.!

!methodRemoval: PurchaseHistoryWindow #buildListMorphWith: stamp: 'AF 11/29/2021 16:08:52'!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
	
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model purchases associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.!

!methodRemoval: PurchaseHistoryWindow #buildListRowWith:and:andExtent: stamp: 'AF 11/29/2021 16:08:54'!
buildListRowWith: aBook and: anAmountSpent andExtent: anExtent
	    | rowMorph |
	    
	    rowMorph := LayoutMorph newRow.
	    rowMorph separation: 0@0; 
	    morphExtent: anExtent;
	    axisEdgeWeight: 0.5;
	    addMorph: (self buildItem: aBook ownerExtent: anExtent);
	    addMorph: (self buildItem: anAmountSpent ownerExtent: anExtent).
	    ^ rowMorph.!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!
!CheckoutWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:11:17' overrides: 51016335!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model ticket associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!PurchaseHistoryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:11:27' overrides: 51016335!
buildListMorphWith: anExtent

    	| listMorph scrollMorph |
    
    	listMorph := LayoutMorph newColumn.
   	scrollMorph := PluggableScrollPane new.
    	scrollMorph morphExtent: (anExtent x *0.9) @ (anExtent y /2);
    	scroller: listMorph.
    
    	listMorph separation: 0@0; 
    	axisEdgeWeight: 0.5.
    	listMorph addMorph: (self buildListHeaderWithExtent: scrollMorph morphExtent).
	self model purchases associationsDo: [:anAssociation | listMorph addMorph: (self buildListRowWith: anAssociation key 
																				and: anAssociation value asString 
																				andExtent: scrollMorph morphExtent).].


    
    	^scrollMorph.! !
!SummaryWindow methodsFor: 'as yet unclassified' stamp: 'AF 11/29/2021 16:11:36' prior: 51016335!
buildListMorphWith: anExtent

	self subclassResponsibility.! !

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

----SNAPSHOT----(29 November 2021 16:17:17) CuisUniversity-4972.image priorSource: 21908907!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

----SNAPSHOT----(29 November 2021 16:17:22) CuisUniversity-4972.image priorSource: 21920335!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

----SNAPSHOT----(29 November 2021 16:17:54) CuisUniversity-4972.image priorSource: 21920504!
!CatalogWindow methodsFor: 'events' stamp: 'AF 11/29/2021 16:22:14'!
retrieveQuantityMorphFor: aBookQuantityAssociation

	^ cartItemsQuantityMorphs at: aBookQuantityAssociation key ifAbsent:[
											   						cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBookQuantityAssociation key
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBookQuantityAssociation key.]! !
!CatalogWindow methodsFor: 'events' stamp: 'AF 11/29/2021 16:22:14' prior: 51005166!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.
	cartContents at: '' ifAbsent:[
	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (self retrieveQuantityMorphFor: aBookQuantityAssociation).
											   quantityMorph contents: aBookQuantityAssociation value asString.
											   counterModel _ (counterModels at: aBookQuantityAssociation key ) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]
						 ]! !
!CatalogWindow methodsFor: 'events' stamp: 'AF 11/29/2021 16:22:58' prior: 51016674!
retrieveQuantityMorphFor: aBook

	^ cartItemsQuantityMorphs at: aBook ifAbsent:[cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																						     of: aBook
																			   		 withExtent: cartListMorph morphExtent).
											    						cartItemsQuantityMorphs at: aBook.]! !
!CatalogWindow methodsFor: 'events' stamp: 'AF 11/29/2021 16:23:19' prior: 51016710!
retrieveQuantityMorphFor: aBook

	^ cartItemsQuantityMorphs at: aBook ifAbsent:[cartListMorph scroller addMorph: (self buildCartItemRowWith: 0
																				         of: aBook
																	   		     withExtent: cartListMorph morphExtent).
										cartItemsQuantityMorphs at: aBook.]! !
!CatalogWindow methodsFor: 'events' stamp: 'AF 11/29/2021 16:23:40' prior: 51016690!
updateCartContents

	| cartContents |
	cartContents _ self model listCart.
	cartContents at: '' ifAbsent:[
	cartContents associationsDo: [:aBookQuantityAssociation | |counterModel quantityMorph|
											   quantityMorph _ (self retrieveQuantityMorphFor: aBookQuantityAssociation key).
											   quantityMorph contents: aBookQuantityAssociation value asString.
											   counterModel _ (counterModels at: aBookQuantityAssociation key ) value: '0'.
											   self updateCounterTextMorphBasedOn: counterModel 
								 ]
						 ]! !

----SNAPSHOT----(29 November 2021 16:24:19) CuisUniversity-4972.image priorSource: 21920668!

TusLibrosRestAPIInterface allInstancesDo: [:instance | instance destroy]!

TusLibrosRestAPIInterfaceTest new startTestServerAndLoginInterface.!

----SNAPSHOT----(29 November 2021 16:24:49) CuisUniversity-4972.image priorSource: 21923328!